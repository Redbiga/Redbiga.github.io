

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
   <meta name="referrer" content="no-referrer">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar1.png">
  <link rel="icon" href="/img/avatar1.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="山麋一笑">
  <meta name="keywords" content="">
  
    <meta name="description" content="1.创建第一个项目：1.引入依赖：&lt;!--    所有springboot项目都必须继承自 spring-boot-starter-parent ,如果报	--&gt;     &lt;parent&gt;         &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;         &lt;artifactId&amp;g">
<meta property="og:type" content="article">
<meta property="og:title" content="Springboot学习笔记">
<meta property="og:url" content="http://www.bojiboqi.fun/2024/01/26/Springboot_/index.html">
<meta property="og:site_name" content="山麋一笑">
<meta property="og:description" content="1.创建第一个项目：1.引入依赖：&lt;!--    所有springboot项目都必须继承自 spring-boot-starter-parent ,如果报	--&gt;     &lt;parent&gt;         &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;         &lt;artifactId&amp;g">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689254342403-1c7d5be2-59f7-4d6a-8fa3-8cdcff5aa805.png#averageHue=%233b1f02&clientId=uc9135780-ac3d-4&from=paste&height=262&id=u4bd0926f&originHeight=327&originWidth=581&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=29111&status=done&style=none&taskId=u817b6fc9-a2b3-41c6-beca-6e10804204b&title=&width=464.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689254431253-f1db82c5-2aff-4240-bbea-b4abbaeb24aa.png#averageHue=%23fbfaf8&clientId=uc9135780-ac3d-4&from=paste&height=269&id=u27e3853e&originHeight=336&originWidth=720&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=38821&status=done&style=none&taskId=ua69cfde8-d2bd-4782-ab37-348c54090d6&title=&width=576">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689258459738-3f6e1e17-aff8-45a2-9c3e-e5e00b943868.png#averageHue=%2312151c&clientId=uc9135780-ac3d-4&from=paste&height=410&id=u0c91b9c1&originHeight=512&originWidth=890&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=95403&status=done&style=none&taskId=ua520442b-66a3-465a-bfe4-8badcfef6af&title=&width=712">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689257659269-0968fa4d-b7a3-45a8-9fde-d2d34eb062bf.png#averageHue=%23dcb88c&clientId=uc9135780-ac3d-4&from=paste&height=343&id=u81f02c80&originHeight=429&originWidth=864&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=35824&status=done&style=none&taskId=u601e8e76-00f7-4aec-86cf-eb00c95aad8&title=&width=691.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689259030746-d45575cd-4785-4951-aea6-41a141d23f5c.png#averageHue=%23267d49&clientId=uc9135780-ac3d-4&from=paste&height=202&id=x93dY&originHeight=252&originWidth=1193&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=55265&status=done&style=none&taskId=u319fb788-593b-49b5-a964-acbd641d340&title=&width=954.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689338993030-dddbdbb3-8d2a-4fb6-99df-400c6bffe713.png#averageHue=%23f6f9f6&clientId=u50cc7f0e-9aa6-4&from=paste&height=117&id=u6123668b&originHeight=146&originWidth=414&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=22183&status=done&style=none&taskId=u609bdd38-2b1f-48b5-86cc-fdde5105864&title=&width=331.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689341306219-26dac878-fe79-4a28-9b71-acf8d3693b8c.png#averageHue=%23f7fcfb&clientId=u50cc7f0e-9aa6-4&from=paste&height=21&id=u5063fa94&originHeight=26&originWidth=468&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=15894&status=done&style=none&taskId=u791ed171-4320-4022-8d64-0e763d147b7&title=&width=374.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1679970508234-3c6b8ecc-6372-4eb5-8c67-563054d1a72d.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_37,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23b9b985&from=url&id=Xvkxy&originHeight=583&originWidth=1281&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689294105675-0b73afd6-0887-4d7c-9d56-9e988a84a0ae.png#averageHue=%23fbfaf9&clientId=uc9135780-ac3d-4&from=paste&height=255&id=uc7eaf023&originHeight=319&originWidth=357&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=56709&status=done&style=none&taskId=u8e460c2b-84b7-458e-8da8-d7cc2244fd0&title=&width=285.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1680232037132-d2fa8085-3847-46f2-ac62-14a6188492aa.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_29,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23b5c5db&from=url&id=ZTIkc&originHeight=251&originWidth=1029&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681093891854-26205c88-4c20-4b63-a2c3-02574778072f.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_36,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23faf8f6&from=url&id=zLAUH&originHeight=497&originWidth=1267&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681217799861-dde49224-a767-489b-80b7-7d8d503e33cf.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_23,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23faf9f7&from=url&id=gZ4iS&originHeight=420&originWidth=797&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681220124448-e8611612-97bc-4823-9b00-20dd9d579abf.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_17,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f9f8f8&from=url&id=tIIrj&originHeight=306&originWidth=594&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681220145378-86fabd90-a78c-4f60-9efa-eb2960915832.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_16,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f6f5f5&from=url&id=mh0xz&originHeight=256&originWidth=575&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681275459547-89d8d651-b52f-4d47-bff9-6db123624424.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_15,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f0eeeb&from=url&id=w9v5M&originHeight=282&originWidth=532&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681302411019-0c0425aa-6679-4b2b-a456-b31c151c6e83.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_15,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f1eeec&from=url&id=WrjKA&originHeight=237&originWidth=532&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681354523290-b89d7e0d-b9aa-40f5-8d22-d3d09d02b136.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_28,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f6f5f5&from=url&id=FMo0Z&originHeight=654&originWidth=999&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691304138965-1792688e-a546-44c5-b225-df80d9bc8562.png#averageHue=%23f2f1dc&clientId=u5acfc650-ecf6-4&from=paste&height=46&id=u926de390&originHeight=58&originWidth=223&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=12806&status=done&style=none&taskId=u16c89229-3bdc-4732-9eb3-5693e766448&title=&width=178.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/svg/1613913/1681723795095-828d2034-1e6c-4d98-8e47-573dd6b5463b.svg#from=url&id=ez8nQ&originHeight=842&originWidth=1047&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691307013013-0d54dd7b-2189-4f1b-b63d-f880eeadd942.png#averageHue=%23fdfdfb&clientId=u8fdb1034-8532-4&from=paste&height=370&id=u8cfa0ee8&originHeight=463&originWidth=960&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=134823&status=done&style=none&taskId=ud0d4529f-dec1-4e92-8baa-78f5b60dba9&title=&width=768">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691307230435-8c06a2a5-20ea-423f-b5e3-cc14688b812f.png#averageHue=%23f7f4e0&clientId=u8fdb1034-8532-4&from=paste&height=66&id=ubf31b11b&originHeight=83&originWidth=571&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=36513&status=done&style=none&taskId=ua92b8fb3-30aa-4271-908a-08bf7d846ed&title=&width=456.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681724501227-077073b7-349d-414f-8916-a822eb86c772.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_26,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f5f4f3&from=url&id=PNxJP&originHeight=196&originWidth=919&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681725850466-2ecf12f4-8b66-469f-9d5d-377a33923b3c.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_19,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23ceae84&from=url&id=W0Ot4&originHeight=268&originWidth=668&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681816524680-e75cbe89-f90c-4ac4-8247-ec850308df65.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_29,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23fafaf9&from=url&id=xnTyF&originHeight=40&originWidth=1030&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691459425977-b78e1673-8a61-41ae-b1b0-d487510bd937.png#averageHue=%23383532&clientId=u8fdb1034-8532-4&from=paste&height=173&id=u65bf48e5&originHeight=216&originWidth=752&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=13871&status=done&style=none&taskId=u3dae8db9-32d1-451c-8898-afe829c3c40&title=&width=601.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/svg/28066124/1691418639180-bac5ede2-c3e2-4a60-bf81-b015e53ea599.svg#clientId=u8fdb1034-8532-4&from=paste&height=535&id=u4b284044&originHeight=669&originWidth=694&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=91719&status=done&style=none&taskId=ue9940951-a38d-4801-9025-9879191c5cd&title=&width=555.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691632824115-17aa44c2-d941-4cf4-9275-e179fff05255.png#averageHue=%23c19757&clientId=u6136e5eb-a4ad-4&from=paste&height=159&id=u91faa989&originHeight=199&originWidth=746&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=52561&status=done&style=none&taskId=ue972d580-cb68-4f6e-babc-29509d58909&title=&width=596.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691418910556-4050b5e8-46b0-4d5c-890a-2432fdb1491c.png#averageHue=%23fbfaf9&clientId=u8fdb1034-8532-4&from=paste&height=526&id=ue8811d01&originHeight=658&originWidth=938&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=51295&status=done&style=none&taskId=u8fbc1a6a-e039-4e45-87a7-d19b86d95c6&title=&width=750.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681829576654-d5e4b889-6fcf-4e65-91f1-8de8c78e98f1.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_23,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f3c9ac&from=url&id=kfTpf&originHeight=61&originWidth=792&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1682322663331-25a89875-7ce3-40ae-9be7-9ea752fbab20.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_31,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23a7bd8b&from=url&id=Uwox4&originHeight=758&originWidth=1102&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691887909080-a687294a-131b-4da8-9822-18298ade2f39.png#averageHue=%23c4d581&clientId=uac0c1727-261a-4&from=paste&height=610&id=ue472925a&originHeight=762&originWidth=1129&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=133115&status=done&style=none&taskId=ue11d8088-eb18-4a04-ae32-ed763f0e0a8&title=&width=903.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691887919553-7c5e83d8-0a5c-4cae-bfca-bd50272bbb36.png#averageHue=%23f5eee4&clientId=uac0c1727-261a-4&from=paste&height=157&id=ufc92ec7f&originHeight=196&originWidth=937&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=100464&status=done&style=none&taskId=ua7f8bbd0-7822-4907-8c9a-bd01dc2227b&title=&width=749.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1682327167479-8f634931-f8ca-48fb-9566-c914f1795ff2.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_33,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f2eeec&from=url&id=b4csj&originHeight=387&originWidth=1153&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1682341921101-aa095a84-00cc-4815-b675-f4ed81cecf3b.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_22,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23fdfcfc&from=url&id=dk2IM&originHeight=489&originWidth=780&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681829645812-0f0cad01-66d4-42fc-8111-091e33a062c6.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_32,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23cfe1c6&from=url&id=B0IdI&originHeight=602&originWidth=1113&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/svg/1613913/1682569555020-b6cbc750-3171-44c6-810f-1c59e590b792.svg#from=url&id=kMVFr&originHeight=794&originWidth=1453&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1692062258198-3076f00d-7f1c-4d16-b118-d5602186ac58.png#averageHue=%23fcfcfc&clientId=uac0c1727-261a-4&from=paste&height=75&id=ucb808ef1&originHeight=94&originWidth=1264&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=7142&status=done&style=none&taskId=u66261308-30e0-4c55-9da2-3ed8eed8757&title=&width=1011.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1692069227456-eaaf5b70-3097-4576-b385-7518d3348588.png#averageHue=%23f0f1ed&clientId=uac0c1727-261a-4&from=paste&height=274&id=u3bdf5779&originHeight=343&originWidth=651&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=89111&status=done&style=none&taskId=u3784a1e0-8b8e-4304-81c3-2a5c657fe94&title=&width=520.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1692069318112-64c8ca5e-79f7-41e5-9c62-bf61b0757143.png#averageHue=%23efefe8&clientId=uac0c1727-261a-4&from=paste&height=285&id=uff9e6b90&originHeight=356&originWidth=671&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=83511&status=done&style=none&taskId=ue0c0164f-30fd-418f-ad07-ab8dfe21483&title=&width=536.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/svg/28066124/1692064439987-d4ad84f3-0582-4676-9c49-39734e7ef6f4.svg#clientId=uac0c1727-261a-4&from=paste&height=422&id=uc0bf46e6&originHeight=527&originWidth=1009&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=187350&status=done&style=none&taskId=u62a00463-37f0-4bac-9d79-bc88a76f6e2&title=&width=807.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1692071527786-0d52ba68-3e36-4c18-b8eb-96a6ab5a7d03.png#averageHue=%23e3e2e1&clientId=uac0c1727-261a-4&from=paste&height=478&id=u8ac5de6b&originHeight=597&originWidth=1066&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=235950&status=done&style=none&taskId=u6a7c6476-c964-4a45-bda6-bab61e7b3ce&title=&width=852.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693661640773-7d47d1c1-5dc0-43aa-844b-46ebc764ac6e.png#averageHue=%236faab3&clientId=u199a9dfb-f232-4&from=paste&height=270&id=u0a4fc328&originHeight=337&originWidth=609&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=37379&status=done&style=none&taskId=u205d8096-4b14-4c4a-8abc-bbf708f17d8&title=&width=487.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693661968373-5247f323-5162-4d5b-88d6-e5a4021ff1d5.png#averageHue=%23202969&clientId=u199a9dfb-f232-4&from=paste&height=65&id=u215928cb&originHeight=81&originWidth=1155&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=105387&status=done&style=none&taskId=ubeac012b-f2a1-4f31-addf-172b56a0f42&title=&width=924">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693662068364-ed63640f-d323-413e-b3ca-8822b1ab1c30.png#averageHue=%23f6f5f4&clientId=u199a9dfb-f232-4&from=paste&height=286&id=uad59c2ba&originHeight=358&originWidth=806&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=38541&status=done&style=none&taskId=u6fedb865-c35a-4f6e-bafa-ebce95595a8&title=&width=644.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693662555584-0f50aa80-013f-4ef2-b825-2cc4e08f0746.png#averageHue=%231f2869&clientId=u199a9dfb-f232-4&from=paste&height=54&id=u3c41def4&originHeight=68&originWidth=1285&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=95065&status=done&style=none&taskId=uf2b7db52-7049-40c2-8a43-6e9f0820f09&title=&width=1028">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693664468867-2975cbcf-a97d-48d0-83a8-dfff635bd638.png#averageHue=%23223071&clientId=u199a9dfb-f232-4&from=paste&height=233&id=uc54b05ff&originHeight=291&originWidth=1427&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=497796&status=done&style=none&taskId=uf5b39572-2572-4c63-b16e-7e914595699&title=&width=1141.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693664502030-7539f9e6-9251-4553-9953-92cc83e59f6f.png#averageHue=%23e5e4e3&clientId=u199a9dfb-f232-4&from=paste&height=72&id=u98dda7c1&originHeight=90&originWidth=353&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=4561&status=done&style=none&taskId=u58eca5aa-3888-4200-b270-af1659e196d&title=&width=282.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693666166503-76847856-5dbd-41c1-b985-d573593d50ee.png#averageHue=%2319191a&clientId=u199a9dfb-f232-4&from=paste&height=198&id=u4444ecb0&originHeight=247&originWidth=855&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=88985&status=done&style=none&taskId=u432223cc-3ccb-4a43-bafa-c67f0b00a05&title=&width=684">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693666351488-fcc58253-ce49-485b-a0dd-b0f91e801603.png#averageHue=%231a1a1b&clientId=u199a9dfb-f232-4&from=paste&height=387&id=u19a7bd17&originHeight=484&originWidth=951&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=212480&status=done&style=none&taskId=u8e036015-3d49-43b5-9c69-60df8df3dc8&title=&width=760.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693668015733-b27ce633-6a8d-4fbe-bb30-53fe273d574d.png#averageHue=%232c3d7e&clientId=u199a9dfb-f232-4&from=paste&height=370&id=u06e55159&originHeight=462&originWidth=1240&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=692661&status=done&style=none&taskId=uf8fbd6a9-51b2-4511-9175-91e09c11c57&title=&width=992">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693720409476-cdc02b96-0977-43bb-8468-a5e95524479e.png#averageHue=%2382bec8&clientId=ubd7ce99a-c7e7-4&from=paste&height=362&id=XUcBO&originHeight=452&originWidth=909&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=112189&status=done&style=none&taskId=u246d6b70-14f7-4ec4-86d9-7f461209255&title=&width=727.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693721336317-8222233b-4a16-424e-aa2f-c6ddb6ad2f6c.png#averageHue=%23151516&clientId=ubd7ce99a-c7e7-4&from=paste&height=190&id=u6e8c45ae&originHeight=237&originWidth=583&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=35158&status=done&style=none&taskId=u26f9ab92-c709-4582-88b0-ec1e8978e04&title=&width=466.4">
<meta property="article:published_time" content="2024-01-26T10:58:38.778Z">
<meta property="article:modified_time" content="2024-01-26T11:00:18.847Z">
<meta property="article:author" content="山麋一笑">
<meta property="article:tag" content="springboot2">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689254342403-1c7d5be2-59f7-4d6a-8fa3-8cdcff5aa805.png#averageHue=%233b1f02&clientId=uc9135780-ac3d-4&from=paste&height=262&id=u4bd0926f&originHeight=327&originWidth=581&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=29111&status=done&style=none&taskId=u817b6fc9-a2b3-41c6-beca-6e10804204b&title=&width=464.8">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Springboot学习笔记 - 山麋一笑</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/xm_custom/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.bojiboqi.fun","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"NkSNF5NG3Uup8tDgwIfBlJ9d-gzGzoHsz","app_key":"Y2GZN9C0SLdOpVG4hMb1TEJM","server_url":"https://nksnf5ng.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body><!-- hexo injector body_begin start --><div id="web_bg"></div><!-- hexo injector body_begin end -->
  
  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>山麋一笑</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于我</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default1.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Springboot学习笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-26 18:58" pubdate>
          2024年1月26日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          32k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          267 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      


<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Springboot学习笔记</h1>
            
            
              <div class="markdown-body">
                
                 <meta name="referrer" content="no-referrer">



<h1 id="1-创建第一个项目："><a href="#1-创建第一个项目：" class="headerlink" title="1.创建第一个项目："></a>1.创建第一个项目：</h1><h2 id="1-引入依赖："><a href="#1-引入依赖：" class="headerlink" title="1.引入依赖："></a>1.引入依赖：</h2><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--    所有springboot项目都必须继承自 spring-boot-starter-parent ,如果报	--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span></code></pre></div>
<p>这里可能会报错：<a target="_blank" rel="noopener" href="https://blog.csdn.net/BingTaiLi/article/details/109735778">解决Maven ‘parent.relativePath‘ of POM_BingTaiLi的博客-CSDN博客</a></p>
<h3 id="2-导入场景"><a href="#2-导入场景" class="headerlink" title="2. 导入场景"></a>2. 导入场景</h3><p>场景启动器</p>
<div class="code-wrapper"><pre><code class="hljs html">    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-comment">&lt;!--        web开发的场景启动器 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre></div>
<h3 id="3-主程序"><a href="#3-主程序" class="headerlink" title="3. 主程序"></a>3. 主程序</h3><div class="code-wrapper"><pre><code class="hljs html">@SpringBootApplication //这是一个SpringBoot应用
public class MainApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(MainApplication.class,args);
    &#125;
&#125;</code></pre></div>
<h3 id="4-业务"><a href="#4-业务" class="headerlink" title="4. 业务"></a>4. 业务</h3><div class="code-wrapper"><pre><code class="hljs html">@RestController//将返回内容写入返回体中
public class HelloController &#123;

    @GetMapping(&quot;/hello&quot;)
    public String hello()&#123;

        return &quot;Hello,Spring Boot 3!&quot;;
    &#125;

&#125;</code></pre></div>
<h3 id="5-测试"><a href="#5-测试" class="headerlink" title="5. 测试"></a>5. 测试</h3><p>默认启动访问： localhost:8080&#x2F;hello</p>
<h3 id="6-打包"><a href="#6-打包" class="headerlink" title="6. 打包"></a>6. 打包</h3><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--    SpringBoot应用打包插件--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div>
<p>mvn clean package把项目打成可执行的jar包<br>java -jar demo.jar启动项目<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689254342403-1c7d5be2-59f7-4d6a-8fa3-8cdcff5aa805.png#averageHue=%233b1f02&clientId=uc9135780-ac3d-4&from=paste&height=262&id=u4bd0926f&originHeight=327&originWidth=581&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=29111&status=done&style=none&taskId=u817b6fc9-a2b3-41c6-beca-6e10804204b&title=&width=464.8" srcset="/img/loading.gif" lazyload alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689254431253-f1db82c5-2aff-4240-bbea-b4abbaeb24aa.png#averageHue=%23fbfaf8&clientId=uc9135780-ac3d-4&from=paste&height=269&id=u27e3853e&originHeight=336&originWidth=720&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=38821&status=done&style=none&taskId=ua69cfde8-d2bd-4782-ab37-348c54090d6&title=&width=576" srcset="/img/loading.gif" lazyload alt="image.png"><br>在该路径下输入cmd，然后运行jar包（命令:jva -jar demo.jar,注意这里必须要字面-jar，因为运行的是jar包）<br>但是能够成功运行要求系统java的环境变量配置的jdk17以上。</p>
<h1 id="3、应用分析"><a href="#3、应用分析" class="headerlink" title="3、应用分析"></a>3、应用分析</h1><p>思考：<br>1、为什么导入starter-web所有相关依赖都导入进来？</p>
<ul>
<li><p>开发什么场景，导入什么<strong>场景启动器。</strong></p>
<div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-comment">&lt;!--● 官方提供的场景：命名为：spring-boot-starter-*</span>
<span class="hljs-comment">		● 第三方提供场景：命名为：*-spring-boot-starter</span>
<span class="hljs-comment">		ctrl+鼠标右键即可在IDEA查看相关场景所依赖的jar包和场景--&gt;</span></code></pre></div>
</li>
<li><p><strong>maven依赖传递原则。A-B-C： A就拥有B和C</strong></p>
</li>
<li><p>导入 场景启动器。 场景启动器 自动把这个场景的所有核心依赖全部导入进来</p>
</li>
</ul>
<p>2、为什么版本号都不用写？</p>
<ul>
<li>每个boot项目都有一个父项目spring-boot-starter-parent（它也是一个场景）</li>
<li>parent的父项目是spring-boot-dependencies（其中的<properties>标签中把所有常见的jar的依赖版本都声明好了。）</li>
<li>父项目 <strong>版本仲裁中心</strong>，把所有常见的jar的依赖版本都声明好了。</li>
<li>比如：mysql-connector-j</li>
<li><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689258459738-3f6e1e17-aff8-45a2-9c3e-e5e00b943868.png#averageHue=%2312151c&clientId=uc9135780-ac3d-4&from=paste&height=410&id=u0c91b9c1&originHeight=512&originWidth=890&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=95403&status=done&style=none&taskId=ua520442b-66a3-465a-bfe4-8badcfef6af&title=&width=712" srcset="/img/loading.gif" lazyload alt="image.png"></li>
</ul>
<p>3、自定义版本号</p>
<ul>
<li>利用maven的就近原则<ul>
<li>直接在当前项目properties标签中声明父项目用的版本属性的key</li>
<li>直接在<strong>导入依赖的时候声明版本</strong></li>
</ul>
</li>
</ul>
<p>4、第三方的jar包</p>
<ul>
<li>boot父项目没有管理的需要自行声明好<div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre></div>
<img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689257659269-0968fa4d-b7a3-45a8-9fde-d2d34eb062bf.png#averageHue=%23dcb88c&clientId=uc9135780-ac3d-4&from=paste&height=343&id=u81f02c80&originHeight=429&originWidth=864&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=35824&status=done&style=none&taskId=u601e8e76-00f7-4aec-86cf-eb00c95aad8&title=&width=691.2" srcset="/img/loading.gif" lazyload alt="image.png"></li>
</ul>
<h2 id="2-自动配置机制"><a href="#2-自动配置机制" class="headerlink" title="2. 自动配置机制"></a>2. 自动配置机制</h2><h3 id="1-初步理解"><a href="#1-初步理解" class="headerlink" title="1. 初步理解"></a>1. 初步理解</h3><ul>
<li><p><strong>自动配置</strong>的 Tomcat、SpringMVC 等</p>
<ul>
<li><strong>导入场景</strong>，容器中就会自动配置好这个场景的核心组件。</li>
<li>以前：DispatcherServlet、ViewResolver、CharacterEncodingFilter….</li>
<li>现在：自动配置好的这些组件</li>
<li>验证：<strong>容器中有了什么组件，就具有什么功能</strong><div class="code-wrapper"><pre><code class="hljs html">public static void main(String[] args) &#123;

    //java10： 局部变量类型的自动推断（可以不用声明变量的类型，直接根据右边的表达式推断）
    var ioc = SpringApplication.run(MainApplication.class, args);

    //1、获取容器中所有组件的名字
    String[] names = ioc.getBeanDefinitionNames();
    //2、挨个遍历：
    // dispatcherServlet、beanNameViewResolver、characterEncodingFilter、multipartResolver
    // SpringBoot把以前配置的核心组件现在都给我们自动配置好了。
    for (String name : names) &#123;
        System.out.println(name);
    &#125;

&#125;</code></pre></div></li>
</ul>
</li>
<li><p><strong>默认的包扫描规则</strong></p>
<ul>
<li>@SpringBootApplication 标注的类就是主程序类</li>
<li><strong>SpringBoot只会扫描主程序所在的包及其下面的子包，自动的component-scan功能</strong></li>
<li><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689259030746-d45575cd-4785-4951-aea6-41a141d23f5c.png#averageHue=%23267d49&clientId=uc9135780-ac3d-4&from=paste&height=202&id=x93dY&originHeight=252&originWidth=1193&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=55265&status=done&style=none&taskId=u319fb788-593b-49b5-a964-acbd641d340&title=&width=954.4" srcset="/img/loading.gif" lazyload alt="image.png"></li>
<li><strong>自定义扫描路径</strong><ul>
<li>@SpringBootApplication(scanBasePackages &#x3D; “com.atguigu”)&#x2F;&#x2F;scanBasePackages指定扫描的位置</li>
<li>@ComponentScan(“com.atguigu”) 直接指定扫描的路径</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>配置默认值</strong></p>
<ul>
<li><strong>配置文件</strong>的所有配置项是和某个<strong>类的对象</strong>值进行一一绑定的。</li>
<li>绑定了配置文件中每一项值的类： <strong>属性类</strong>。</li>
<li>比如：<ul>
<li>ServerProperties绑定了所有Tomcat服务器有关的配置</li>
<li>MultipartProperties绑定了所有文件上传相关的配置</li>
<li>….参照<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#appendix.application-properties.server">官方文档</a>：或者参照 绑定的 <strong>属性类</strong>。</li>
</ul>
</li>
</ul>
</li>
<li><p>按需加载自动配置</p>
<ul>
<li>导入场景spring-boot-starter-web</li>
<li>场景启动器除了会导入相关功能依赖(ctrl+鼠标右击可以查看导入的依赖），还导入一个spring-boot-starter(每个场景ctrl点进去的配置文件都有一个的spring-boot-starter），是所有starter的starter，这个starter基础核心starter</li>
<li>spring-boot-starter导入了一个包 spring-boot-autoconfigure。包里面都是各种场景的AutoConfiguration<strong>自动配置类</strong></li>
<li>虽然全场景的自动配置都在 spring-boot-autoconfigure这个包，但是不是全都开启的。<ul>
<li>导入哪个场景就开启哪个自动配置</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>总结： 导入场景启动器、触发 spring-boot-autoconfigure这个包的自动配置生效、容器中就会具有相关场景的功能</p>
<h2 id="1-常用注解"><a href="#1-常用注解" class="headerlink" title="1. 常用注解"></a>1. 常用注解</h2><p>SpringBoot摒弃XML配置方式，改为<strong>全注解驱动</strong></p>
<h3 id="1-组件注册"><a href="#1-组件注册" class="headerlink" title="1. 组件注册"></a>1. 组件注册</h3><p><strong>@Configuration</strong>、**@SpringBootConfiguration**<br><strong>@Bean</strong>、**@Scope**<br><strong>@Controller、 @Service、@Repository、@Component</strong><br><strong>@Import</strong><br>@ComponentScan<br>步骤：<br><strong>1、@Configuration 编写一个配置类</strong><br><strong>2、在配置类中，自定义方法给容器中注册组件。配合@Bean</strong><br><strong>3、或使用@Import 导入第三方的组件</strong></p>
<h3 id="2-条件注解"><a href="#2-条件注解" class="headerlink" title="2. 条件注解"></a>2. 条件注解</h3><p>如果注解指定的<strong>条件成立</strong>，则触发指定行为<br><em><strong>@ConditionalOnXxx</strong></em><br><strong>@ConditionalOnClass：如果类路径中存在这个类，则触发指定行为</strong><br><strong>@ConditionalOnMissingClass：如果类路径中不存在这个类，则触发指定行为</strong><br><strong>@ConditionalOnBean：如果容器中存在这个Bean（组件），则触发指定行为</strong><br><strong>@ConditionalOnMissingBean：如果容器中不存在这个Bean（组件），则触发指定行为</strong><br>场景：</p>
<ul>
<li>如果存在FastsqlException这个类，给容器中放一个Cat组件，名cat01，</li>
<li>否则，就给容器中放一个Dog组件，名dog01</li>
<li>如果系统中有dog01这个组件，就给容器中放一个 User组件，名zhangsan </li>
<li>否则，就放一个User，名叫lisi</li>
</ul>
<p><strong>@ConditionalOnBean（value&#x3D;组件类型，name&#x3D;组件名字）：判断容器中是否有这个类型的组件，并且名字是指定的值</strong></p>
<p>@ConditionalOnRepositoryType (org.springframework.boot.autoconfigure.data)<br>@ConditionalOnDefaultWebSecurity (org.springframework.boot.autoconfigure.security)<br>@ConditionalOnSingleCandidate (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnWebApplication (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnWarDeployment (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnJndi (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnResource (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnExpression (org.springframework.boot.autoconfigure.condition)<br><strong>@ConditionalOnClass</strong> (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnEnabledResourceChain (org.springframework.boot.autoconfigure.web)<br><strong>@ConditionalOnMissingClass</strong>(org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnNotWebApplication (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnProperty (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnCloudPlatform (org.springframework.boot.autoconfigure.condition)<br><strong>@ConditionalOnBean</strong> (org.springframework.boot.autoconfigure.condition)<br><strong>@ConditionalOnMissingBean</strong> (org.springframework.boot.autoconfigure.condition)<br>@ConditionalOnMissingFilterBean (org.springframework.boot.autoconfigure.web.servlet)<br>@Profile (org.springframework.context.annotation)<br>@ConditionalOnInitializedRestarter (org.springframework.boot.devtools.restart)<br>@ConditionalOnGraphQlSchema (org.springframework.boot.autoconfigure.graphql)<br>@ConditionalOnJava (org.springframework.boot.autoconfigure.condition)</p>
<h3 id="3-属性绑定"><a href="#3-属性绑定" class="headerlink" title="3. 属性绑定"></a>3. 属性绑定</h3><p><strong>@ConfigurationProperties： 声明组件的属性和配置文件哪些前缀开始项进行绑定</strong><br><strong>@EnableConfigurationProperties：快速注册注解：</strong></p>
<ul>
<li><strong>场景：</strong>SpringBoot默认只扫描自己主程序所在的包。如果导入第三方包，即使组件上标注了 @Component、@ConfigurationProperties 注解，也没用。因为组件都扫描不进来，此时使用这个注解就可以快<strong>速进行属性绑定并把组件注册进容器</strong></li>
</ul>
<p>将容器中任意<strong>组件（Bean）的属性值</strong>和<strong>配置文件</strong>的配置项的值<strong>进行绑定</strong></p>
<ul>
<li><strong>1、给容器中注册组件（@Component、@Bean）</strong></li>
<li><strong>2、使用@ConfigurationProperties 声明组件和配置文件的哪些配置项进行绑定</strong></li>
</ul>
<p>更多注解参照：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gW411W7wy">Spring注解驱动开发</a>【1-26集】</p>
<h2 id="待复习常用注解（视频1-26集）："><a href="#待复习常用注解（视频1-26集）：" class="headerlink" title="待复习常用注解（视频1-26集）："></a>待复习常用注解（视频1-26集）：</h2><h3 id="核心容器："><a href="#核心容器：" class="headerlink" title="核心容器："></a>核心容器：</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689338993030-dddbdbb3-8d2a-4fb6-99df-400c6bffe713.png#averageHue=%23f6f9f6&clientId=u50cc7f0e-9aa6-4&from=paste&height=117&id=u6123668b&originHeight=146&originWidth=414&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=22183&status=done&style=none&taskId=u609bdd38-2b1f-48b5-86cc-fdde5105864&title=&width=331.2" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h3 id="组件注册："><a href="#组件注册：" class="headerlink" title="组件注册："></a>组件注册：</h3><h4 id="Congfiguration"><a href="#Congfiguration" class="headerlink" title="@Congfiguration:"></a>@Congfiguration:</h4><p>基于xml的注入方式，需要根据<bean>标签逐渐赋值注入容器的。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689341306219-26dac878-fe79-4a28-9b71-acf8d3693b8c.png#averageHue=%23f7fcfb&clientId=u50cc7f0e-9aa6-4&from=paste&height=21&id=u5063fa94&originHeight=26&originWidth=468&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=15894&status=done&style=none&taskId=u791ed171-4320-4022-8d64-0e763d147b7&title=&width=374.4" srcset="/img/loading.gif" lazyload alt="image.png">都有注入容器的功能</p>
<div class="code-wrapper"><pre><code class="hljs html">package com.example.annotationstudy.config;

import org.springframework.core.io.Resource;
import org.springframework.core.type.AnnotationMetadata;
import org.springframework.core.type.ClassMetadata;
import org.springframework.core.type.classreading.MetadataReader;
import org.springframework.core.type.classreading.MetadataReaderFactory;
import org.springframework.core.type.filter.TypeFilter;

import java.io.IOException;
import java.lang.annotation.Annotation;

public class MytypeFilter implements TypeFilter
    &#123;
    @Override
//    MetadataReader读取到当前真正扫描的类，MetadataReaderFactory可以获取其他任何类的信息
    public boolean match(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory) throws IOException
    &#123;
//        获取当前正在扫描的类的注解信息
        AnnotationMetadata annotation= metadataReader.getAnnotationMetadata();
        //获取当前真正扫描类的类信息，比如它的类型是什么，实现了什么接口
         ClassMetadata classMetadata = metadataReader.getClassMetadata();
        //获取当前类资源信息(类路径）
       Resource resource =  metadataReader.getResource();
       String className =classMetadata.getClassName();
        System.out.println(&quot;---&gt;&quot;+className);
        if(className.contains(&quot;er&quot;))
        return  true;
        return false;
    &#125;
    &#125;
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs html">package com.example.annotationstudy;

import com.example.annotationstudy.config.test;
import org.junit.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

//SpringApplication.run(AnnotationStudyApplication.class, args);
public class AnnotationStudyApplication
&#123;

    public static void main(String[] args)
    &#123;
        ApplicationContext applicationContext =  new AnnotationConfigApplicationContext(test.class);
        System.out.println( applicationContext.getBean(Person.class));
        String[] nameType = applicationContext.getBeanNamesForType(Person.class);//查看Person类的Bean数组在容器中的id数组
        for (String string:nameType)
        &#123;
            System.out.println(string);
        &#125;
    &#125;
//    Person&#123;name=&#x27;1&#x27;, age=1&#125;
//     person1
@Test
public void  test01()
&#123;
    ApplicationContext applicationContext =  new AnnotationConfigApplicationContext(test.class);
    String[] nameType = applicationContext.getBeanDefinitionNames();//查看Person类的Bean数组在容器中的id数组
    for (String string:nameType)
    &#123;
        System.out.println(string);
    &#125;
&#125;
/*没有加过滤器前的结果：
test//@Configuration注入的组件,@Configuration注解有@Component修饰
bookController//@Controller注入的组件
bookDao//@Repository注入的组件
bookService//@Service注入的组件
person//  @Bean(&quot;person&quot;)注入的组件
*/
/*加了过滤器:
test
bookDao
bookService
person*/
/*自定义过滤规则的输出结果
---&gt;com.example.annotationstudy.AnnotationStudyApplication
---&gt;com.example.annotationstudy.config.MytypeFilter
---&gt;com.example.annotationstudy.controller.BookController
---&gt;com.example.annotationstudy.dao.BookDao
---&gt;com.example.annotationstudy.Person
---&gt;com.example.annotationstudy.service.bookService
org.springframework.context.annotation.internalConfigurationAnnotationProcessor
org.springframework.context.annotation.internalAutowiredAnnotationProcessor
org.springframework.context.annotation.internalCommonAnnotationProcessor
org.springframework.context.event.internalEventListenerProcessor
org.springframework.context.event.internalEventListenerFactory
        test
bookDao
        person

进程已结束,退出代码0*/


&#125;
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs html">package com.example.annotationstudy.config;

import com.example.annotationstudy.Person;
import com.example.annotationstudy.service.bookService;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.FilterType;
import org.springframework.stereotype.Controller;

//配置类===配置文件
@Configuration//告诉spring这是一个配置类
@ComponentScan(value=&quot;com.example.annotationstudy&quot;,
        includeFilters = &#123;@ComponentScan.Filter(type = FilterType.CUSTOM,classes = MytypeFilter.class)&#125;)
//将Controller注解过滤掉
//类似xml中的包扫描标签<span class="hljs-tag">&lt;<span class="hljs-name">context:component-sacn</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
//@ComponentScan value（数组类型）指定要扫描的包， Filter[] excludeFilters();指定过滤规则；
// Filter[] includeFilters()指定扫描只包含哪些注解
//FilterType.ANNOTATION按照给定的注解加载（type = FilterType.ANNOTATION,classes = Controller.class)排除/只加载Contorller注解
//FilterType.ASSIGNABLE_TYPE按照给定类型加载,type = FilterType.ASSIGNABLE_TYPE,classes = bookService.class排除/只加载bookService类型的bean
//FilterType.REGEX按照正则表达式，
//FilterType.CUSTOM;使用自定义规则；@ComponentScan.Filter(type = FilterType.CUSTOM,classes = MytypeFilter.class)
//MytypeFilter.class返回ture或false决定是否排除/加载类到容器，如果为ture就加载/排除bean到容器内，其中value指定的路径下所有的类
// 都会在MytypeFilter中进行判断，看能否加入到容器中
public class test
&#123;
//    给容器中注册一个bean,类型为方法的返回值的类型，id默认为方法名作为id,其中该注解的vaule值赋值id的优先级高于方法名
    @Bean(&quot;person&quot;)//也可以这样给bean赋值为person,最后这里注入bean的id是person;类似xml中的bean标签
    public Person person1()
    &#123;
        return new Person(&quot;1&quot;,1);
    &#125;

&#125;
</code></pre></div>

<h2 id="2-完整流程"><a href="#2-完整流程" class="headerlink" title="2. 完整流程"></a>2. 完整流程</h2><p>思考：<br><strong>1、SpringBoot怎么实现导一个starter、写一些简单配置，应用就能跑起来，我们无需关心整合</strong><br>2、为什么Tomcat的端口号可以配置在application.properties中，并且Tomcat能启动成功？<br>3、导入场景后哪些<strong>自动配置能生效</strong>？<br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1679970508234-3c6b8ecc-6372-4eb5-8c67-563054d1a72d.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_37,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23b9b985&from=url&id=Xvkxy&originHeight=583&originWidth=1281&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p>
<p><em><strong>自动配置流程细节梳理：</strong></em><br><strong>1、</strong>导入starter-web：导入了web开发场景</p>
<ul>
<li>1、场景启动器导入了相关场景的所有依赖：starter-json、starter-tomcat、springmvc</li>
<li>2、每个场景启动器都引入了一个spring-boot-starter，核心场景启动器。</li>
<li>3、<strong>核心场景启动器</strong>引入了spring-boot-autoconfigure包。</li>
<li>4、spring-boot-autoconfigure里面囊括了所有场景的所有配置。</li>
<li>5、只要这个包下的所有类都能生效，那么相当于SpringBoot官方写好的整合功能就生效了。</li>
<li>6、SpringBoot默认却扫描不到 spring-boot-autoconfigure下写好的所有<strong>配置类</strong>。（这些<strong>配置类</strong>给我们做了整合操作），<strong>默认只扫描主程序所在的包</strong>。</li>
</ul>
<p><strong>2、主程序</strong>：@SpringBootApplication</p>
<ul>
<li>1、@SpringBootApplication由三个注解组成@SpringBootConfiguration、@EnableAutoConfiguratio、@ComponentScan</li>
<li>2、SpringBoot默认只能扫描自己主程序所在的包及其下面的子包，扫描不到 spring-boot-autoconfigure包中官方写好的<strong>配置类</strong></li>
<li>3、**@EnableAutoConfiguration**：SpringBoot <strong>开启自动配置的核心</strong>。<ul>
<li><ol>
<li>是由@Import(AutoConfigurationImportSelector.class){，@Import是一个注解，允许您将其他配置类导入到应用程序上下文中}提供功能：批量给容器中导入组件。</li>
</ol>
</li>
<li><ol start="2">
<li>SpringBoot启动会默认加载 142个配置类。</li>
</ol>
</li>
<li><ol start="3">
<li>这<strong>142个配置类</strong>来自于spring-boot-autoconfigure下 META-INF&#x2F;spring&#x2F;<strong>org.springframework.boot.autoconfigure.AutoConfiguration</strong>.imports文件指定的</li>
</ol>
</li>
<li>项目启动的时候利用 @Import 批量导入组件机制把 autoconfigure 包下的142 xxxxAutoConfiguration类导入进来（<strong>自动配置类</strong>）</li>
<li>虽然导入了142个自动配置类</li>
</ul>
</li>
<li>4、按需生效：<ul>
<li>并不是这142个自动配置类都能生效</li>
<li>每一个自动配置类，都有条件注解@ConditionalOnxxx，只有条件成立，才能生效</li>
</ul>
</li>
</ul>
<p><strong>3、xxxxAutoConfiguration自动配置类</strong></p>
<ul>
<li><strong>1、给容器中使用@Bean 放一堆组件。</strong></li>
<li>2、每个<strong>自动配置类</strong>都可能有这个注解@EnableConfigurationProperties(<strong>ServerProperties</strong>.class)，用来把配置文件中配的指定前缀的属性值封装到 xxxProperties<strong>属性类</strong>中</li>
<li>3、以Tomcat为例：把服务器的所有配置都是以server开头的。配置都封装到了属性类中。</li>
<li>4、给<strong>容器</strong>中放的所有<strong>组件</strong>的一些<strong>核心参数</strong>，都来自于<strong>xxxProperties。xxxProperties都是和配置文件绑定。</strong></li>
<li><strong>只需要改配置文件的值，核心组件的底层参数都能修改</strong></li>
</ul>
<p><strong>4、</strong>写业务，全程无需关心各种整合（底层这些整合写好了，而且也生效了）</p>
<p><strong>核心流程总结：</strong><br>1、导入starter，就会导入autoconfigure包。<br>2、autoconfigure 包里面 有一个文件 META-INF&#x2F;spring&#x2F;<strong>org.springframework.boot.autoconfigure.AutoConfiguration</strong>.imports,里面指定的所有启动要加载的自动配置类<br>3、@EnableAutoConfiguration 会自动的把上面文件里面写的所有<strong>自动配置类都导入进来。xxxAutoConfiguration 是有条件注解进行按需加载</strong><br>4、xxxAutoConfiguration给容器中导入一堆组件，组件都是从 xxxProperties中提取属性值<br>5、xxxProperties又是和<strong>配置文件</strong>进行了绑定<br><strong>效果：</strong>导入starter、修改配置文件，就能修改底层行为。</p>
<h2 id="2-YAML配置文件"><a href="#2-YAML配置文件" class="headerlink" title="2. YAML配置文件"></a>2. YAML配置文件</h2><p><strong>痛点</strong>：SpringBoot 集中化管理配置，application.properties<br><strong>问题</strong>：配置多以后难阅读和修改，<strong>层级结构辨识度不高</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1689294105675-0b73afd6-0887-4d7c-9d56-9e988a84a0ae.png#averageHue=%23fbfaf9&clientId=uc9135780-ac3d-4&from=paste&height=255&id=uc7eaf023&originHeight=319&originWidth=357&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=56709&status=done&style=none&taskId=u8e460c2b-84b7-458e-8da8-d7cc2244fd0&title=&width=285.6" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>YAML 是 “YAML Ain’t a Markup Language”（YAML 不是一种标记语言）。在开发的这种语言时，YAML 的意思其实是：”Yet Another Markup Language”（是另一种标记语言）。</p>
<ul>
<li>设计目标，就是<strong>方便人类读写</strong></li>
<li><strong>层次分明</strong>，更适合做配置文件</li>
<li>使用.yaml或 .yml作为文件后缀</li>
</ul>
<h3 id="1-基本语法"><a href="#1-基本语法" class="headerlink" title="1. 基本语法"></a>1. 基本语法</h3><ul>
<li><strong>大小写敏感</strong></li>
<li>使用<strong>缩进表示层级关系，k: v，使用空格分割k,v</strong></li>
<li>缩进时不允许使用Tab键，只允许<strong>使用空格</strong>。换行</li>
<li>缩进的空格数目不重要，只要<strong>相同层级</strong>的元素<strong>左侧对齐</strong>即可</li>
<li><strong># 表示注释</strong>，从这个字符一直到行尾，都会被解析器忽略。</li>
</ul>
<p>支持的写法：</p>
<ul>
<li><strong>对象</strong>：<strong>键值对</strong>的集合，如：映射（map）&#x2F; 哈希（hash） &#x2F; 字典（dictionary）</li>
<li><strong>数组</strong>：一组按次序排列的值，如：序列（sequence） &#x2F; 列表（list）</li>
<li><strong>纯量</strong>：单个的、不可再分的值，如：字符串、数字、bool、日期</li>
</ul>
<h3 id="2-示例"><a href="#2-示例" class="headerlink" title="2. 示例"></a>2. 示例</h3><div class="code-wrapper"><pre><code class="hljs html">@Component
@ConfigurationProperties(prefix = &quot;person&quot;) //和配置文件person前缀的所有配置进行绑定，
//ConfigurationProperties注解可以将配置文件中的属性映射到一个Java Bean中。
@Data //自动生成JavaBean属性的getter/setter
//@NoArgsConstructor //自动生成无参构造器
//@AllArgsConstructor //自动生成全参构造器
public class Person &#123;
    private String name;
    private Integer age;
    private Date birthDay;
    private Boolean like;
    private Child child; //嵌套对象
    private List<span class="hljs-tag">&lt;<span class="hljs-name">Dog</span>&gt;</span> dogs; //数组（里面是对象）
    private Map&lt;String,Cat&gt; cats; //表示Map
&#125;

@Data
public class Dog &#123;
    private String name;
    private Integer age;
&#125;

@Data
public class Child &#123;
    private String name;
    private Integer age;
    private Date birthDay;
    private List<span class="hljs-tag">&lt;<span class="hljs-name">String</span>&gt;</span> text; //数组
&#125;

@Data
public class Cat &#123;
    private String name;
    private Integer age;
&#125;</code></pre></div>
<p>properties表示法</p>
<div class="code-wrapper"><pre><code class="hljs routeros">person.<span class="hljs-attribute">name</span>=张三
person.<span class="hljs-attribute">age</span>=18
person.<span class="hljs-attribute">birthDay</span>=2010/10/12 12:12:12
person.<span class="hljs-attribute">like</span>=<span class="hljs-literal">true</span>
person.child.<span class="hljs-attribute">name</span>=李四
person.child.<span class="hljs-attribute">age</span>=12
person.child.<span class="hljs-attribute">birthDay</span>=2018/10/12
person.child.text[0]=abc
person.child.text[1]=def
person.dogs[0].<span class="hljs-attribute">name</span>=小黑
person.dogs[0].<span class="hljs-attribute">age</span>=3
person.dogs[1].<span class="hljs-attribute">name</span>=小白
person.dogs[1].<span class="hljs-attribute">age</span>=2
person.cats.c1.<span class="hljs-attribute">name</span>=小蓝
person.cats.c1.<span class="hljs-attribute">age</span>=3
person.cats.c2.<span class="hljs-attribute">name</span>=小灰
person.cats.c2.<span class="hljs-attribute">age</span>=2</code></pre></div>
<p>yaml表示法：注意数组的写法：text和dogs两种写法，cat是map的写法。</p>
<div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">张三</span>
  <span class="hljs-attr">age:</span> <span class="hljs-number">18</span>
  <span class="hljs-attr">birthDay:</span> <span class="hljs-number">2010</span><span class="hljs-string">/10/10</span> <span class="hljs-number">12</span><span class="hljs-string">:12:12</span>
  <span class="hljs-attr">like:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">child:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">李四</span>
    <span class="hljs-attr">age:</span> <span class="hljs-number">20</span>
    <span class="hljs-attr">birthDay:</span> <span class="hljs-number">2018</span><span class="hljs-string">/10/10</span>
    <span class="hljs-attr">text:</span> [<span class="hljs-string">&quot;abc&quot;</span>,<span class="hljs-string">&quot;def&quot;</span>]
<span class="hljs-comment">#数组的2中写法，可以是text形式还可以是dogs的形式（每一个元素用一个-表示，下面的age是一个元素里</span>
<span class="hljs-comment">#面的内容，要同级并没有-表示。</span>
  <span class="hljs-attr">dogs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">小黑</span>
      <span class="hljs-attr">age:</span> <span class="hljs-number">3</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">小白</span>
      <span class="hljs-attr">age:</span> <span class="hljs-number">2</span>
  <span class="hljs-attr">cats:</span>
    <span class="hljs-attr">c1:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">小蓝</span>
      <span class="hljs-attr">age:</span> <span class="hljs-number">3</span>
    <span class="hljs-attr">c2:</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">小绿</span>,<span class="hljs-attr">age:</span> <span class="hljs-number">2</span>&#125; <span class="hljs-comment">#对象也可用&#123;&#125;表示</span></code></pre></div>
<h3 id="3-细节"><a href="#3-细节" class="headerlink" title="3. 细节"></a>3. 细节</h3><ul>
<li>birthDay 推荐写为 birth-day,@ConfigurationProperties(prefix &#x3D; “person”) &#x2F;&#x2F;和配置文件person前缀的所有配置进行绑定，</li>
<li><strong>文本</strong>：<ul>
<li><strong>单引号</strong>不会转义【\n 则为普通字符串显示】</li>
<li><strong>双引号</strong>会转义【\n会显示为<strong>换行符</strong>】</li>
</ul>
</li>
<li><strong>大文本</strong><ul>
<li>|开头，大文本写在下层，<strong>保留文本格式</strong>，<strong>换行符正确显示</strong></li>
<li><blockquote>
<p>开头，大文本写在下层，折叠换行符</p>
</blockquote>
</li>
</ul>
</li>
<li><strong>多文档合并</strong><ul>
<li>使用—可以把多个yaml文档合并在一个文档中，每个文档区依然认为内容独立</li>
</ul>
</li>
</ul>
<h3 id="4-小技巧：lombok"><a href="#4-小技巧：lombok" class="headerlink" title="4. 小技巧：lombok"></a>4. 小技巧：lombok</h3><p>简化JavaBean 开发。自动生成构造器、getter&#x2F;setter、自动生成Builder模式等</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<p>使用@Data等注解</p>
<h2 id="3-日志配置"><a href="#3-日志配置" class="headerlink" title="3. 日志配置"></a>3. 日志配置</h2><p>规范：项目开发不要编写System.out.println()，应该用<strong>日志</strong>记录信息<br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1680232037132-d2fa8085-3847-46f2-ac62-14a6188492aa.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_29,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23b5c5db&from=url&id=ZTIkc&originHeight=251&originWidth=1029&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload><br><strong>感兴趣日志框架关系与起源可参考</strong>：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gW411W76m">https://www.bilibili.com/video/BV1gW411W76m</a> 视频 21~27集</p>
<h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h3><ol>
<li>Spring使用commons-logging作为内部日志，但底层日志实现是开放的。可对接其他日志框架。<ol>
<li>spring5及以后 commons-logging被spring直接自己写了。</li>
</ol>
</li>
<li>支持 jul，log4j2,logback。SpringBoot 提供了默认的控制台输出配置，也可以配置输出为文件。</li>
<li>logback是默认使用的。</li>
<li>虽然<strong>日志框架很多</strong>，但是我们不用担心，使用 SpringBoot 的<strong>默认配置就能工作的很好</strong>。</li>
</ol>
<p><strong>SpringBoot怎么把日志默认配置好的</strong><br>1、每个starter场景，都会导入一个核心场景spring-boot-starter<br>2、核心场景引入了日志的所用功能spring-boot-starter-logging（eg:spring-boot-starter-web-&gt;spring-boot-starter-&gt;spring-boot-starter-logging)<br>3、默认使用了logback + slf4j 组合作为默认底层日志<br>4、日志是系统一启动就要用，xxxAutoConfiguration是系统启动好了以后放好的组件，后来用的。<br>5、日志是利用<strong>监听器机制</strong>配置好的。ApplicationListener。<br>6、日志所有的配置都可以通过修改配置文件实现。以logging开始的所有配置。</p>
<h3 id="2-日志格式"><a href="#2-日志格式" class="headerlink" title="2. 日志格式"></a>2. 日志格式</h3><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">2023</span>-<span class="hljs-number">03</span>-<span class="hljs-number">31</span>T13:<span class="hljs-number">56</span>:<span class="hljs-number">17</span>.<span class="hljs-number">511</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span>  INFO <span class="hljs-number">4944</span> ---<span class="hljs-meta"> [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span>
<span class="hljs-attribute">2023</span>-<span class="hljs-number">03</span>-<span class="hljs-number">31</span>T13:<span class="hljs-number">56</span>:<span class="hljs-number">17</span>.<span class="hljs-number">511</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span>  INFO <span class="hljs-number">4944</span> ---<span class="hljs-meta"> [           main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.7]</span></code></pre></div>
<p>默认输出格式：</p>
<ul>
<li>时间和日期：毫秒级精度</li>
<li>日志级别：ERROR,WARN,INFO,DEBUG, orTRACE.</li>
<li>进程 ID(可以在终端使用jps列出当前java程序的进程）</li>
<li>—： 消息分割符</li>
<li>线程名： 使用[]包含</li>
<li>Logger 名： 通常是产生日志的<strong>类名</strong></li>
<li>消息： 日志记录的内容</li>
</ul>
<p>注意： logback 没有FATAL级别，对应的是ERROR<br>默认值：参照：spring-boot包additional-spring-configuration-metadata.json文件<br>默认输出格式值：%clr(%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd’T’HH:mm:ss.SSSXXX}}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(—){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}<br>可修改为：’%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{15} &#x3D;&#x3D;&#x3D;&gt; %msg%n’</p>
<h3 id="3-记录日志"><a href="#3-记录日志" class="headerlink" title="3. 记录日志"></a>3. 记录日志</h3><div class="code-wrapper"><pre><code class="hljs mel">Logger logger = LoggerFactory.getLogger(getClass());<span class="hljs-comment">//使用日志工厂生成日志类</span>
 <span class="hljs-keyword">log</span>.info(<span class="hljs-string">&quot;info 日志..... 参数a:&#123;&#125; b:&#123;&#125;&quot;</span>,a,b);
或者使用Lombok的@Slf4j注解,在该类上使用，就可以不用日志工厂生成日志类直接使用<span class="hljs-keyword">log</span></code></pre></div>
<h3 id="4-日志级别"><a href="#4-日志级别" class="headerlink" title="4. 日志级别"></a>4. 日志级别</h3><ul>
<li>由低到高：ALL,TRACE, DEBUG, INFO, WARN, ERROR,FATAL,OFF；<ul>
<li><strong>只会打印指定级别及以上级别的日志</strong></li>
<li>ALL：打印所有日志</li>
<li>TRACE：追踪框架详细流程日志，一般不使用</li>
<li>DEBUG：开发调试细节日志</li>
<li>INFO：关键、感兴趣信息日志</li>
<li>WARN：警告但不是错误的信息日志，比如：版本过时</li>
<li>ERROR：业务错误日志，比如出现各种异常</li>
<li>FATAL：致命错误日志，比如jvm系统崩溃</li>
<li>OFF：关闭所有日志记录</li>
</ul>
</li>
<li>不指定级别的所有类，都使用root指定的级别作为默认级别</li>
<li>SpringBoot日志<strong>默认级别是 INFO</strong></li>
</ul>
<ol>
<li>在application.properties&#x2F;yaml中配置logging.level.<logger-name>&#x3D;<level>指定日志级别</li>
<li>level可取值范围：TRACE, DEBUG, INFO, WARN, ERROR, FATAL, or OFF，定义在 LogLevel类中</li>
<li>root 的logger-name叫root，可以配置logging.level.root&#x3D;warn，代表所有未指定日志级别都使用 root 的 warn 级别</li>
</ol>
<h3 id="5-日志分组"><a href="#5-日志分组" class="headerlink" title="5. 日志分组"></a>5. 日志分组</h3><p>比较有用的技巧是：<br>将相关的logger分组在一起，统一配置。SpringBoot 也支持。比如：Tomcat 相关的日志统一设置</p>
<div class="code-wrapper"><pre><code class="hljs stylus">logging<span class="hljs-selector-class">.group</span>.tomcat=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.catalina</span>,org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.coyote</span>,org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.tomcat</span>
<span class="hljs-comment">//这里是将org.apache.catalina,org.apache.coyote,org.apache.tomcat2个包当成一个组为tomcat</span>
logging<span class="hljs-selector-class">.level</span>.tomcat=trace
<span class="hljs-comment">//这里是将tomcat组的日志级别设置为trace级别</span></code></pre></div>
<p>SpringBoot 预定义两个组</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Loggers</th>
</tr>
</thead>
<tbody><tr>
<td>web</td>
<td>org.springframework.core.codec,org.springframework.http,org.springframework.web,org.springframework.boot.actuate.endpoint.web,org.springframework.boot.web.servlet.ServletContextInitializerBeans</td>
</tr>
<tr>
<td>sql</td>
<td>org.springframework.jdbc.core,org.hibernate.SQL,org.jooq.tools.LoggerListener</td>
</tr>
</tbody></table>
<h3 id="6-文件输出"><a href="#6-文件输出" class="headerlink" title="6. 文件输出"></a>6. 文件输出</h3><div class="code-wrapper"><pre><code class="hljs fortran"> #指定文件路径路径，日志文件默认叫spring.<span class="hljs-built_in">log</span>
#logging.<span class="hljs-keyword">file</span>.path=D:\\
#指定日志文件的名，只写名字就在当前项目的同位置生成相对应的日志文件。
#也可以写名字+路径，就会在指定的路径下生成相应的日志文件然后把日志写进去
logging.<span class="hljs-keyword">file</span>.<span class="hljs-keyword">name</span> 
#<span class="hljs-keyword">file</span>.<span class="hljs-keyword">name</span>和<span class="hljs-keyword">file</span>.path同时存在,只有<span class="hljs-keyword">file</span>.<span class="hljs-keyword">name</span>生效
</code></pre></div>
<p>SpringBoot 默认只把日志写在控制台，如果想额外记录到文件，可以在application.properties中添加logging.file.name or logging.file.path配置项。</p>
<table>
<thead>
<tr>
<th>logging.file.name</th>
<th>logging.file.path</th>
<th>示例</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>未指定</td>
<td>未指定</td>
<td></td>
<td>仅控制台输出</td>
</tr>
<tr>
<td><strong>指定</strong></td>
<td>未指定</td>
<td>my.log</td>
<td>写入指定文件。可以加路径</td>
</tr>
<tr>
<td>未指定</td>
<td><strong>指定</strong></td>
<td>&#x2F;var&#x2F;log</td>
<td>写入指定目录，文件名为spring.log</td>
</tr>
<tr>
<td><strong>指定</strong></td>
<td><strong>指定</strong></td>
<td></td>
<td>以logging.file.name为准</td>
</tr>
</tbody></table>
<h3 id="7-文件归档与滚动切割"><a href="#7-文件归档与滚动切割" class="headerlink" title="7. 文件归档与滚动切割"></a>7. 文件归档与滚动切割</h3><p>归档：每天的日志单独存到一个文档中。<br>切割：每个文件10MB，超过大小切割成另外一个文件。</p>
<ol>
<li>每天的日志应该独立分割出来存档。如果使用logback（SpringBoot 默认整合），可以通过application.properties&#x2F;yaml文件指定日志滚动规则。</li>
<li>如果是其他日志系统，需要自行配置（添加log4j2.xml或log4j2-spring.xml）</li>
<li>不用特意配置日志，会使用默认的日志</li>
<li>支持的滚动规则设置如下<table>
<thead>
<tr>
<th>配置项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>logging.logback.rollingpolicy.file-name-pattern</td>
<td>日志存档的文件名（类似每天产生的日志单独生成在一个文件中） 格式（默认值：${LOG_FILE}.%d{yyyy-MM-dd}.%i.gz）</td>
</tr>
<tr>
<td>logging.logback.rollingpolicy.clean-history-on-start</td>
<td>应用启动时是否清除以前存档（默认值：false）</td>
</tr>
<tr>
<td>logging.logback.rollingpolicy.max-file-size</td>
<td>存档前，每个日志文件的最大大小（默认值：10MB）</td>
</tr>
<tr>
<td>logging.logback.rollingpolicy.total-size-cap</td>
<td>日志文件被删除之前，可以容纳的最大大小（默认值：0B）。设置1GB则磁盘存储超过 1GB 日志后就会删除旧日志文件</td>
</tr>
<tr>
<td>logging.logback.rollingpolicy.max-history</td>
<td>日志文件保存的最大天数(默认值：7).</td>
</tr>
</tbody></table>
</li>
</ol>
<h3 id="8-自定义配置"><a href="#8-自定义配置" class="headerlink" title="8. 自定义配置"></a>8. 自定义配置</h3><p>通常我们配置 application.properties 就够了。当然也可以自定义。比如：</p>
<table>
<thead>
<tr>
<th>日志系统</th>
<th>自定义</th>
</tr>
</thead>
<tbody><tr>
<td>Logback</td>
<td>logback-spring.xml,logback-spring.groovy,</td>
</tr>
<tr>
<td>logback.xml, or logback.groovy</td>
<td></td>
</tr>
<tr>
<td>Log4j2</td>
<td>log4j2-spring.xmlorlog4j2.xml</td>
</tr>
<tr>
<td>JDK (Java Util Logging)</td>
<td>logging.properties</td>
</tr>
</tbody></table>
<p>如果可能，我们建议您在日志配置中使用-spring 变量（例如，logback-spring.xml 而不是 logback.xml）。如果您使用标准配置文件，spring 无法完全控制日志初始化。<br>最佳实战：自己要写配置，配置文件名加上 xx-spring.xml</p>
<h3 id="9-切换日志组合"><a href="#9-切换日志组合" class="headerlink" title="9. 切换日志组合"></a>9. 切换日志组合</h3><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<p>log4j2支持yaml和json格式的配置文件</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>依赖</th>
<th>文件名</th>
</tr>
</thead>
<tbody><tr>
<td>YAML</td>
<td>com.fasterxml.jackson.core:jackson-databind+com.fasterxml.jackson.dataformat:jackson-dataformat-yaml</td>
<td>log4j2.yaml+log4j2.yml</td>
</tr>
<tr>
<td>JSON</td>
<td>com.fasterxml.jackson.core:jackson-databind</td>
<td>log4j2.json+log4j2.jsn</td>
</tr>
</tbody></table>
<h3 id="10-最佳实战"><a href="#10-最佳实战" class="headerlink" title="10. 最佳实战"></a>10. 最佳实战</h3><ol>
<li>导入任何第三方框架，先排除它的日志包，因为Boot底层控制好了日志</li>
<li>修改 application.properties 配置文件，就可以调整日志的所有行为。如果不够，可以编写日志框架自己的配置文件放在类路径下就行，比如logback-spring.xml，log4j2-spring.xml</li>
<li>如需对接<strong>专业日志系统</strong>，也只需要把 logback 记录的<strong>日志</strong>灌倒** kafka<strong>之类的中间件，这和SpringBoot没关系，都是日志框架自己的配置，</strong>修改配置文件即可**</li>
<li><strong>业务中使用slf4j-api记录日志。不要再 sout 了</strong></li>
</ol>
<h1 id="2、SpringBoot3-Web开发"><a href="#2、SpringBoot3-Web开发" class="headerlink" title="2、SpringBoot3-Web开发"></a>2、SpringBoot3-Web开发</h1><p>SpringBoot的Web开发能力，由<strong>SpringMVC</strong>提供。</p>
<h2 id="1-Web场景"><a href="#1-Web场景" class="headerlink" title="1. Web场景"></a>1. Web场景</h2><p>1、整合web场景</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<p>2、引入了 autoconfigure功能（是spring-boot-starter-web下的spring-boot-starter里面的一个依赖）<br>3、springboot起点的时候会加载一个@EnableAutoConfiguration注解（@SpringBootApplication注解里被@EnableAutoConfiguration注解修饰）。@EnableAutoConfiguration注解使用@Import(AutoConfigurationImportSelector.class)批量导入组件，加载 META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports 文件中配置的所有组件<br>5、所有自动配置类如下</p>
<div class="code-wrapper"><pre><code class="hljs abnf">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration
org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration
<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>以下是响应式web场景和现在的没关系<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>
org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration
org.springframework.boot.autoconfigure.web.reactive.ReactiveMultipartAutoConfiguration
org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration
org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration
org.springframework.boot.autoconfigure.web.reactive.WebSessionIdResolverAutoConfiguration
org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration
org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration
org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration
<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>以上没关系<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>
org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration
org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</code></pre></div>
<p>6、绑定了配置文件的一堆配置项</p>
<ul>
<li>1、SpringMVC的所有配置 spring.mvc</li>
<li>2、Web场景通用配置 spring.web</li>
<li>3、文件上传配置 spring.servlet.multipart</li>
<li>4、服务器的配置 server: 比如：编码方式</li>
</ul>
<h2 id="2-默认效果"><a href="#2-默认效果" class="headerlink" title="2. 默认效果"></a>2. 默认效果</h2><p>默认配置：</p>
<ol>
<li>包含了 ContentNegotiatingViewResolver 和 BeanNameViewResolver 组件，<strong>方便视图解析</strong></li>
<li><strong>默认的静态资源处理机制</strong>： 静态资源放在 static 文件夹下即可直接访问</li>
<li><strong>自动注册</strong>了 <strong>Converter</strong>,GenericConverter,<strong>Formatter</strong>组件，适配常见<strong>数据类型转换</strong>和<strong>格式化需求</strong></li>
<li><strong>支持 HttpMessageConverters</strong>，可以<strong>方便返回</strong>json等<strong>数据类型（比如：</strong>@RestController 注解会自动将处理方法的返回值序列化为 JSON式的响应体，并将其发送给客户端。）</li>
<li><strong>注册 <strong>MessageCodesResolver，方便</strong>国际化</strong>及错误消息处理</li>
<li><strong>支持 静态</strong>index.html</li>
<li><strong>自动使用</strong>ConfigurableWebBindingInitializer，实现消息处理、数据绑定（比如将前段传递过来的参数和某些bean绑定)、类型转化、数据校验等功能</li>
</ol>
<p><strong>重要：</strong></p>
<ul>
<li><em>如果想保持 <em><strong><em>boot mvc 的默认配置</em></strong><em>，并且自定义更多的 mvc 配置，如：</em><strong><em>interceptors</em></strong></em>, <em><strong><em>formatters</em></strong></em>, <em><strong><em>view controllers</em></strong></em> 等。可以使用@Configuration注解添加一个 WebMvcConfigurer 类型的配置类，并不要标注 @EnableWebMvc</em></li>
<li><em>如果想保持 boot mvc 的默认配置，但要自定义核心组件实例，比如：RequestMappingHandlerMapping, RequestMappingHandlerAdapter, 或ExceptionHandlerExceptionResolver，给容器中放一个 WebMvcRegistrations 组件即可</em></li>
<li><em>如果想全面接管 Spring MVC，@Configuration 标注一个配置类，并加上 @EnableWebMvc注解，</em></li>
<li><em>实现 WebMvcConfigurer 接口</em></li>
</ul>
<h2 id="WebMvcAutoConfiguration原理"><a href="#WebMvcAutoConfiguration原理" class="headerlink" title="WebMvcAutoConfiguration原理"></a>WebMvcAutoConfiguration原理</h2><p>WebMvcAutoConfiguration 是 Spring Boot 中的一个自动配置类，它负责自动配置 Spring MVC（Model-View-Controller）的相关功能。<br>在 Spring Boot 应用程序中，当您引入了 spring-boot-starter-web  依赖时，WebMvcAutoConfiguration 将自动生效。它会根据应用程序的类路径和配置属性来自动配置 Spring MVC。它是@EnableAutoConfiguration注解使用@Import(AutoConfigurationImportSelector.class)批量导入组件中的一个组件。 </p>
<h3 id="1-生效条件"><a href="#1-生效条件" class="headerlink" title="1. 生效条件"></a>1. 生效条件</h3><div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@AutoConfiguration</span>(after = &#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,
		ValidationAutoConfiguration.class &#125;) <span class="hljs-comment">//在这些自动配置之后,</span>
<span class="hljs-variable">@ConditionalOnWebApplication</span>(type = Type.SERVLET) <span class="hljs-comment">//如果是web应用就生效，类型是SERVLETweb，其他还有、REACTIVE 响应式web</span>
<span class="hljs-variable">@ConditionalOnClass</span>(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)
<span class="hljs-variable">@ConditionalOnMissingBean</span>(WebMvcConfigurationSupport.class) <span class="hljs-comment">//容器中没有这个Bean，才生效。默认就是没有</span>
<span class="hljs-variable">@AutoConfigureOrder</span>(Ordered.HIGHEST_PRECEDENCE + <span class="hljs-number">10</span>)<span class="hljs-comment">//优先级</span>
<span class="hljs-variable">@ImportRuntimeHints</span>(WebResourcesRuntimeHints.class)
public class WebMvcAutoConfiguration &#123; 
&#125;</code></pre></div>
<h3 id="2-WebMvcAutoConfiguration产生的效果"><a href="#2-WebMvcAutoConfiguration产生的效果" class="headerlink" title="2. WebMvcAutoConfiguration产生的效果"></a>2. WebMvcAutoConfiguration产生的效果</h3><ol>
<li>放了两个Filter：<ol>
<li><p>HiddenHttpMethodFilter；页面表单提交Rest请求（GET、POST、PUT、DELETE）<a target="_blank" rel="noopener" href="https://blog.csdn.net/geloin/article/details/7444321">Spring MVC过滤器-HiddenHttpMethodFilter_Korbin Luo的博客-CSDN博客</a></p>
<div class="code-wrapper"><pre><code class="hljs typescript">某些场景下，例如 <span class="hljs-variable constant_">HTML</span> 表单只支持 <span class="hljs-variable constant_">GET</span> 和 <span class="hljs-variable constant_">POST</span> 方法，无法直接发送 <span class="hljs-variable constant_">PUT</span> 或 <span class="hljs-variable constant_">DELETE</span> 请求。
为了解决这个问题，<span class="hljs-title class_">Spring</span> <span class="hljs-title class_">Framework</span> 提供了 <span class="hljs-title class_">HiddenHttpMethodFilter</span> 过滤器。
<span class="hljs-title class_">HiddenHttpMethodFilter</span> 允许您在 <span class="hljs-variable constant_">HTML</span> 表单中使用一个隐藏字段（通常命名为 <span class="hljs-string">&quot;_method&quot;</span>）
来指定要使用的 <span class="hljs-variable constant_">HTTP</span> 方法，例如 <span class="hljs-variable constant_">PUT</span> 或 <span class="hljs-variable constant_">DELETE</span>。当表单提交时，过滤器会检查隐藏字段的值，并将请求方法转换为相应的 <span class="hljs-variable constant_">HTTP</span> 方法。
&lt;form action=<span class="hljs-string">&quot;/example&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_method&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;put&quot;</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-comment">&lt;!-- 其他表单字段 --&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
在上面的示例中，隐藏字段 _method 的值被设置为 <span class="hljs-string">&quot;put&quot;</span>，表示要使用 <span class="hljs-variable constant_">PUT</span> 方法进行请求。
在您的控制器方法中，使用 <span class="hljs-meta">@RequestMapping</span> 注解或其他合适的注解来处理相应的请求方法。
<span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">&quot;/example&quot;</span>, method = <span class="hljs-title class_">RequestMethod</span>.<span class="hljs-property">PUT</span>)
<span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">updateExample</span>(<span class="hljs-params"></span>) &#123;
    <span class="hljs-comment">// 处理 PUT 请求</span>
&#125;
</code></pre></div>
</li>
<li><p>FormContentFilter： 表单内容Filter，GET（数据放URL后面）、POST（数据放请求体）请求可以携带数据，PUT、DELETE 的请求体数据会被忽略.为了让put和delete的请求体内容不会被忽略，可以加一个FormContentFilter。</p>
</li>
</ol>
</li>
<li>给容器中放了WebMvcConfigurer组件（WebMvcAutoConfigurationAdapter）；给SpringMVC添加各种定制功能<div class="code-wrapper"><pre><code class="hljs less">	<span class="hljs-variable">@Configuration</span>(proxyBeanMethods = false)
	<span class="hljs-variable">@Import</span>(EnableWebMvcConfiguration.class) <span class="hljs-comment">//额外导入了其他配置</span>
	<span class="hljs-variable">@EnableConfigurationProperties</span>(&#123; WebMvcProperties.class, WebProperties.class &#125;)
	<span class="hljs-variable">@Order</span>(<span class="hljs-number">0</span>)
	public static class WebMvcAutoConfigurationAdapter implements WebMvcConfigurer, 
ServletContextAware&#123;
        
    &#125;</code></pre></div>

<ol>
<li>所有的功能最终会和配置文件进行绑定</li>
<li>WebMvcProperties： spring.mvc配置文件</li>
<li>WebProperties： spring.web配置文件</li>
</ol>
</li>
</ol>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@ConfigurationProperties</span>(
prefix = <span class="hljs-string">&quot;spring.mvc&quot;</span>
)<span class="hljs-comment">//@ConfigurationProperties 注解的 prefix 属性被设置为 &quot;spring.mvc&quot;，表示要绑定以</span>
<span class="hljs-string">&quot;spring.mvc&quot;</span> 开头的配置属性。
使用 <span class="hljs-variable">@ConfigurationProperties</span> 注解可以将配置文件中的属性值与 Java 类中的字段或方法关联起来，
从而方便地获取、设置和管理配置属性。</code></pre></div>
<h3 id="WebMvcConfigurer接口"><a href="#WebMvcConfigurer接口" class="headerlink" title="WebMvcConfigurer接口"></a>WebMvcConfigurer接口</h3><p>WebMvcAutoConfiguration中的WebMvcAutoConfigurationAdapter属性实现了该接口。<br>提供了配置SpringMVC底层的所有组件入口<br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681093891854-26205c88-4c20-4b63-a2c3-02574778072f.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_36,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23faf8f6&from=url&id=zLAUH&originHeight=497&originWidth=1267&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-静态资源"><a href="#2-静态资源" class="headerlink" title="2. 静态资源"></a>2. 静态资源</h3><h4 id="1-默认规则"><a href="#1-默认规则" class="headerlink" title="1. 默认规则"></a>1. 默认规则</h4><div class="code-wrapper"><pre><code class="hljs kotlin"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> void addResourceHandlers(ResourceHandlerRegistry registry) &#123;
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.resourceProperties.isAddMappings()) &#123;
        logger.debug(<span class="hljs-string">&quot;Default resource handling disabled&quot;</span>);
        <span class="hljs-keyword">return</span>;
    &#125;
    <span class="hljs-comment">//1、</span>
    addResourceHandler(registry, <span class="hljs-keyword">this</span>.mvcProperties.getWebjarsPathPattern(),
            <span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);
    addResourceHandler(registry, <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;
        registration.addResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations());
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.servletContext != <span class="hljs-literal">null</span>) &#123;
            ServletContextResource resource = new ServletContextResource(<span class="hljs-keyword">this</span>.servletContext, SERVLET_LOCATION);
            registration.addResourceLocations(resource);
        &#125;
    &#125;);
&#125;
<span class="hljs-comment">//</span></code></pre></div>

<ol>
<li>规则一：访问： &#x2F;webjars&#x2F;**路径就去 classpath:&#x2F;META-INF&#x2F;resources&#x2F;webjars&#x2F;下找资源.<div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">/webjars/</span> 是一个特定的路径前缀，用于在Web应用程序中访问 WebJars 资源。

WebJars 是一种将前端库以 JAR 文件的形式打包并发布到 Maven 仓库的方式。它们允许您通过 Maven 
或 Gradle 等构建工具来管理和引入前端库，就像管理其他 Java 依赖项一样。

当您在 Maven 项目中引入 WebJars 依赖时，它们将被下载并存储在您的项目的 Maven 依赖目录中。
为了在 Web 应用程序中有效地访问这些资源，Spring Boot 提供了一个特殊的处理器来映射 <span class="hljs-regexp">/webjars/</span>
路径。</code></pre></div>

<ol>
<li>maven 导入依赖</li>
</ol>
</li>
<li>规则二：访问： &#x2F;**路径就去 静态资源默认的四个位置找资源<ol>
<li>classpath:&#x2F;META-INF&#x2F;resources&#x2F;</li>
<li>classpath:&#x2F;resources&#x2F;</li>
<li>classpath:&#x2F;static&#x2F;</li>
<li>classpath:&#x2F;public&#x2F;</li>
</ol>
</li>
<li>规则三：<strong>静态资源默认都有缓存规则的设置</strong><ol>
<li>所有缓存的设置，直接通过<strong>配置文件</strong>： spring.web</li>
<li>cachePeriod： 缓存周期； 多久不用找服务器要新的。 默认没有，以s为单位</li>
<li>cacheControl： <strong>HTTP缓存</strong>控制；<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching#%E6%A6%82%E8%A7%88">https://develop er.mozilla.org/zh-CN/docs/Web/HTTP/Caching</a></li>
<li><strong>useLastModified</strong>：是否使用最后一次修改。配合HTTP Cache规则</li>
</ol>
</li>
</ol>
<p>如果浏览器访问了一个静态资源 index.js，如果服务这个资源没有发生变化，下次访问的时候就可以直接让浏览器用自己缓存中的东西，而不用给服务器发请求</p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">registration</span><span class="hljs-selector-class">.setCachePeriod</span>(<span class="hljs-built_in">getSeconds</span>(this.resourceProperties.<span class="hljs-built_in">getCache</span>().<span class="hljs-built_in">getPeriod</span>()));
<span class="hljs-selector-tag">registration</span><span class="hljs-selector-class">.setCacheControl</span>(this.resourceProperties.<span class="hljs-built_in">getCache</span>().<span class="hljs-built_in">getCachecontrol</span>().<span class="hljs-built_in">toHttpCacheControl</span>());
<span class="hljs-selector-tag">registration</span><span class="hljs-selector-class">.setUseLastModified</span>(this.resourceProperties.<span class="hljs-built_in">getCache</span>().<span class="hljs-built_in">isUseLastModified</span>());</code></pre></div>
<h4 id="1-静态资源映射"><a href="#1-静态资源映射" class="headerlink" title="1. 静态资源映射"></a>1. 静态资源映射</h4><p>静态资源映射规则在WebMvcAutoConfiguration中进行了定义：</p>
<ol>
<li>&#x2F;webjars&#x2F;**的所有路径 资源都在classpath:&#x2F;META-INF&#x2F;resources&#x2F;webjars&#x2F;</li>
<li>&#x2F;**的所有路径 资源都在classpath:&#x2F;META-INF&#x2F;resources&#x2F;、classpath:&#x2F;resources&#x2F;、classpath:&#x2F;static&#x2F;、classpath:&#x2F;public&#x2F;</li>
<li>所有静态资源都定义了缓存规则。【浏览器访问过一次，就会缓存一段时间】，但此功能参数无默认值<ol>
<li>period： 缓存间隔。 默认 0S；</li>
<li>cacheControl：缓存控制。 默认无；</li>
<li>useLastModified：是否使用lastModified头。 默认 false；</li>
</ol>
</li>
</ol>
<h4 id="2-静态资源缓存"><a href="#2-静态资源缓存" class="headerlink" title="2. 静态资源缓存"></a>2. 静态资源缓存</h4><p>如前面所述</p>
<ol>
<li>所有静态资源都定义了缓存规则。【浏览器访问过一次，就会缓存一段时间】，但此功能参数无默认值<ol>
<li>period： 缓存间隔。 默认 0S；</li>
<li>cacheControl：缓存控制。 默认无；</li>
<li>useLastModified：是否使用lastModified头。 默认 false；</li>
</ol>
</li>
</ol>
<h4 id="3-欢迎页"><a href="#3-欢迎页" class="headerlink" title="3. 欢迎页"></a>3. 欢迎页</h4><p>欢迎页规则在WebMvcAutoConfiguration中进行了定义：</p>
<ol>
<li>在<strong>静态资源</strong>目录下找 index.html</li>
<li>没有就在 templates下找index模板页</li>
</ol>
<h4 id="4-Favicon"><a href="#4-Favicon" class="headerlink" title="4. Favicon"></a>4. Favicon</h4><ol>
<li>在静态资源目录下找 favicon.ico</li>
</ol>
<h4 id="5-缓存实验"><a href="#5-缓存实验" class="headerlink" title="5. 缓存实验"></a>5. 缓存实验</h4><div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">9000</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#1、spring.web：</span>
<span class="hljs-comment"># 1.配置国际化的区域信息</span>
<span class="hljs-comment"># 2.静态资源策略(开启、处理链、缓存)</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#开启静态资源映射规则</span>
<span class="hljs-attr">spring.web.resources.add-mappings</span>=<span class="hljs-string">true</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#设置缓存</span>
<span class="hljs-comment">#spring.web.resources.cache.period=3600</span>
<span class="hljs-comment">##缓存详细合并项控制，覆盖period配置：</span>
<span class="hljs-comment">## 浏览器第一次请求服务器，服务器告诉浏览器此资源缓存7200秒，7200秒以内的所有此资源访问</span>
<span class="hljs-comment">#不用发给服务器请求，7200秒以后发请求给服务器</span>
<span class="hljs-attr">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="hljs-string">7200</span>
<span class="hljs-comment">#使用资源 last-modified 时间，来对比服务器和浏览器的资源是否相同没有变化。相同返回 304,默认开启</span>
<span class="hljs-attr">spring.web.resources.cache.use-last-modified</span>=<span class="hljs-string">true</span></code></pre></div>


<h3 id="2-自定义静态资源规则"><a href="#2-自定义静态资源规则" class="headerlink" title="2. 自定义静态资源规则"></a>2. 自定义静态资源规则</h3><p>自定义静态资源路径、自定义缓存规则</p>
<h4 id="1-配置方式"><a href="#1-配置方式" class="headerlink" title="1. 配置方式"></a>1. 配置方式</h4><p>spring.mvc： 静态资源访问前缀路径<br>spring.web：</p>
<ul>
<li>静态资源目录</li>
<li>静态资源缓存策略</li>
</ul>
<h4 id="2-代码方式"><a href="#2-代码方式" class="headerlink" title="2. 代码方式"></a>2. 代码方式</h4><ul>
<li>容器中只要有一个 WebMvcConfigurer 组件。配置的底层行为都会生效</li>
<li>@EnableWebMvc &#x2F;&#x2F;禁用boot的默认配置</li>
</ul>
<h3 id="5-EnableWebMvcConfiguration-源码"><a href="#5-EnableWebMvcConfiguration-源码" class="headerlink" title="5. EnableWebMvcConfiguration 源码"></a>5. EnableWebMvcConfiguration 源码</h3><p>也是WebMvcAutoConfiguration的内部类</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//SpringBoot 给容器中放 WebMvcConfigurationSupport 组件。</span>
<span class="hljs-comment">//我们如果自己放了 WebMvcConfigurationSupport 组件，Boot的WebMvcAutoConfiguration都会失效。</span>
<span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
<span class="hljs-meta">@EnableConfigurationProperties(WebProperties.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnableWebMvcConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DelegatingWebMvcConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ResourceLoaderAware</span> 
&#123;

    
&#125;</code></pre></div>

<ol>
<li>HandlerMapping： 根据请求路径  找那个handler能处理请求</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f04816ee2495">SpringMVC工作原理之处理映射[HandlerMapping]</a><br> SpringMVC 内部是根据 HandlerMapping 将 Request 和 Controller 里面的方法对应起来的  </p>
<ol>
<li>WelcomePageHandlerMapping(webmvcAutoConfiguration里面注入所依赖的bean)： <ol>
<li>访问 &#x2F;**路径下的所有请求，都在以前四个静态资源路径下找，欢迎页也一样</li>
<li>找index.html：只要静态资源的位置有一个 index.html页面，项目启动默认访问（意思是如果静态资源里面有index.html，那么项目启动也就是根路径默认跳转到index.html）</li>
</ol>
</li>
</ol>
<h4 id="Favicon：网站图标"><a href="#Favicon：网站图标" class="headerlink" title="Favicon	：网站图标"></a>Favicon	：网站图标</h4><ol>
<li>在静态资源目录下找 favicon.ico</li>
</ol>
<p>理解：springboot启动成功后会在静态资源文件中寻找favicon.ico文件，如果存在这个文件就把网站的图标设置为这个，当然这里的favicon.ico文件名要正确。如果删除了favicon.ico文件，但是浏览器的图标仍然存在，那是因为浏览器的缓存机制缓存了该图标。</p>
<h4 id="5-缓存实验-1"><a href="#5-缓存实验-1" class="headerlink" title="5. 缓存实验"></a>5. 缓存实验</h4><p>1.跟缓存有关的配置是spring.web前缀的配置属性 。<br>2.</p>
<div class="code-wrapper"><pre><code class="hljs d"><span class="hljs-keyword">@ConfigurationProperties</span> 是一个 Spring Boot 注解，用于将配置属性绑定到 Java 类的字段上。

在 Spring Boot 应用程序中，配置属性通常存储在配置文件（如 application.properties 
或 application.yml）中。<span class="hljs-keyword">@ConfigurationProperties</span> 注解可以使用在一个类上，用于将配置文件中的
属性值绑定到该类的字段上，实现属性的自动注入。
<span class="hljs-keyword">@ConfigurationProperties</span>(<span class="hljs-string">&quot;spring.web&quot;</span>)是将以 <span class="hljs-string">&quot;spring.web&quot;</span> 为前缀的配置属性绑定到 Java 类
的字段上。
使用 <span class="hljs-keyword">@ConfigurationProperties</span> 需要进行以下步骤：
创建一个普通的 Java 类，该类的字段将用于存储配置属性的值。
在该类上添加 <span class="hljs-keyword">@ConfigurationProperties</span> 注解，并指定要绑定的配置属性的前缀。
<span class="hljs-keyword">@Configuration</span>
<span class="hljs-keyword">@ConfigurationProperties</span>(prefix = <span class="hljs-string">&quot;myapp&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> MyAppProperties &#123;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String <span class="hljs-keyword">version</span>;
    <span class="hljs-comment">// 其他属性及对应的 getter 和 setter 方法</span>
&#125;
在上述示例中，MyAppProperties 类使用 <span class="hljs-keyword">@ConfigurationProperties</span> 注解，并指定了 prefix 属性为
<span class="hljs-string">&quot;myapp&quot;</span>。这意味着该类的字段将与以 <span class="hljs-string">&quot;myapp&quot;</span> 为前缀的配置属性进行绑定。

假设在配置文件中有以下属性：
myapp.name=My App
myapp.<span class="hljs-keyword">version</span>=<span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
通过使用 <span class="hljs-keyword">@ConfigurationProperties</span> 注解，可以将 <span class="hljs-string">&quot;My App&quot;</span> 绑定到 name 字段上，
将 <span class="hljs-string">&quot;1.0.0&quot;</span> 绑定到 <span class="hljs-keyword">version</span> 字段上。</code></pre></div>
<p>3.spring.web可以配置国际化的区域信息，配置静态资源策略（开启，处理链，缓存），</p>
<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">9000</span>

<span class="hljs-comment">#1、spring.web：</span>
<span class="hljs-comment"># 1.配置国际化的区域信息</span>
<span class="hljs-comment"># 2.静态资源策略(开启、处理链、缓存)</span>

<span class="hljs-comment">#开启静态资源映射规则，默认结果为true,spring.web.resources.add-mappings和Resources类</span>
<span class="hljs-comment">#的addMappings属性对应。</span>
<span class="hljs-attr">spring.web.resources.add-mappings</span>=<span class="hljs-literal">true</span>

<span class="hljs-comment">#设置缓存,设置了缓存时间为3600s</span>
<span class="hljs-comment">#spring.web.resources.cache.period=3600</span>
<span class="hljs-comment">##缓存详细合并项控制，覆盖period配置：</span>
<span class="hljs-comment">## 浏览器第一次请求服务器，服务器告诉浏览器此资源缓存7200秒，7200秒以内的所有此资源访问不用发给服务器请求，7200秒以后发请求给服务器</span>
<span class="hljs-attr">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="hljs-number">7200</span>
<span class="hljs-comment">#使用资源 last-modified 时间，来对比服务器和浏览器的资源是否相同没有变化。相同返回 304</span>
<span class="hljs-attr">spring.web.resources.cache.use-last-modified</span>=<span class="hljs-literal">true</span></code></pre></div>
<h2 id="2-自定义静态资源规则-1"><a href="#2-自定义静态资源规则-1" class="headerlink" title="2. 自定义静态资源规则"></a>2. 自定义静态资源规则</h2><p>自定义静态资源路径、自定义缓存规则</p>
<h3 id="1-配置方式-1"><a href="#1-配置方式-1" class="headerlink" title="1. 配置方式"></a>1. 配置方式</h3><p>spring.mvc： 静态资源访问前缀路径<br>spring.web：</p>
<ul>
<li>静态资源目录</li>
<li>静态资源缓存策略<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#1、spring.web：</span>
<span class="hljs-comment"># 1.配置国际化的区域信息</span>
<span class="hljs-comment"># 2.静态资源策略(开启、处理链、缓存)</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#开启静态资源映射规则</span>
<span class="hljs-attr">spring.web.resources.add-mappings</span>=<span class="hljs-string">true</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#设置缓存</span>
<span class="hljs-attr">spring.web.resources.cache.period</span>=<span class="hljs-string">3600</span>
<span class="hljs-comment">##缓存详细合并项控制，覆盖period配置：</span>
<span class="hljs-comment">## 浏览器第一次请求服务器，服务器告诉浏览器此资源缓存7200秒，7200秒以内的所有此资源访问不用发给服务器请求，7200秒以后发请求给服务器</span>
<span class="hljs-attr">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="hljs-string">7200</span>
<span class="hljs-comment">## 共享缓存，只要是这个客户端其他用户都可以使用这个缓存</span>
<span class="hljs-attr">spring.web.resources.cache.cachecontrol.cache-public</span>=<span class="hljs-string">true</span>
<span class="hljs-comment">#使用资源 last-modified 时间，来对比服务器和浏览器的资源是否相同没有变化。相同返回 304</span>
<span class="hljs-attr">spring.web.resources.cache.use-last-modified</span>=<span class="hljs-string">true</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#自定义静态资源文件夹位置</span>
<span class="hljs-attr">spring.web.resources.static-locations</span>=<span class="hljs-string">classpath:/a/,classpath:/b/,classpath:/static/</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#2、 spring.mvc</span>
<span class="hljs-comment">## 2.1. 自定义webjars路径前缀,以后访问/wj/**路径的时候会在/wedjars/**路径下寻找 </span>
<span class="hljs-attr">spring.mvc.webjars-path-pattern</span>=<span class="hljs-string">/wj/**</span>
<span class="hljs-comment">## 2.2. 静态资源访问路径前缀常和spring.web.resources.static-locations联合使用</span>
<span class="hljs-attr">spring.mvc.static-path-pattern</span>=<span class="hljs-string">/static/**</span></code></pre></div></li>
</ul>
<h3 id="2-代码方式-1"><a href="#2-代码方式-1" class="headerlink" title="2. 代码方式"></a>2. 代码方式</h3><ul>
<li>容器中只要有一个 WebMvcConfigurer 组件。配置的底层行为都会生效</li>
<li>@EnableWebMvc &#x2F;&#x2F;禁用boot的默认配置<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">//@EnableWebMvc</span> <span class="hljs-string">//禁用boot的默认配置，添加了就会禁用boot的默认配置的规则。</span>
<span class="hljs-attr">//，没有添加就会保留以前的规则和自己新写的规则</span>
<span class="hljs-attr">@Configuration</span> <span class="hljs-string">//这是一个配置类</span>
<span class="hljs-attr">public</span> <span class="hljs-string">class MyConfig implements WebMvcConfigurer &#123;</span>


    <span class="hljs-attr">@Override</span>
    <span class="hljs-attr">public</span> <span class="hljs-string">void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span>
        <span class="hljs-attr">//保留以前规则</span>
        <span class="hljs-attr">//自己写新的规则。</span>
        <span class="hljs-attr">registry.addResourceHandler(&quot;/static/**&quot;)</span>
                <span class="hljs-attr">.addResourceLocations(&quot;classpath</span>:<span class="hljs-string">/a/&quot;,&quot;classpath:/b/&quot;)</span>
                <span class="hljs-attr">.setCacheControl(CacheControl.maxAge(1180,</span> <span class="hljs-string">TimeUnit.SECONDS));</span>
    <span class="hljs-attr">&#125;</span>
<span class="hljs-attr">&#125;</span></code></pre></div>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">@Configuration</span> <span class="hljs-string">//这是一个配置类,给容器中放一个 WebMvcConfigurer 组件，就能自定义底层</span>
<span class="hljs-attr">public</span> <span class="hljs-string">class MyConfig  /*implements WebMvcConfigurer*/ &#123;</span>


    <span class="hljs-attr">@Bean</span>
    <span class="hljs-attr">public</span> <span class="hljs-string">WebMvcConfigurer webMvcConfigurer()&#123;</span>
        <span class="hljs-attr">return</span> <span class="hljs-string">new WebMvcConfigurer() &#123;</span>
            <span class="hljs-attr">@Override</span>
            <span class="hljs-attr">public</span> <span class="hljs-string">void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span>
                <span class="hljs-attr">registry.addResourceHandler(&quot;/static/**&quot;)</span>
                        <span class="hljs-attr">.addResourceLocations(&quot;classpath</span>:<span class="hljs-string">/a/&quot;, &quot;classpath:/b/&quot;)</span>
                        <span class="hljs-attr">.setCacheControl(CacheControl.maxAge(1180,</span> <span class="hljs-string">TimeUnit.SECONDS));</span>
            <span class="hljs-attr">&#125;</span>
        <span class="hljs-attr">&#125;;</span>
    <span class="hljs-attr">&#125;</span>

<span class="hljs-attr">&#125;</span></code></pre></div></li>
</ul>
<h3 id="6-为什么容器中放一个WebMvcConfigurer就能配置底层行为"><a href="#6-为什么容器中放一个WebMvcConfigurer就能配置底层行为" class="headerlink" title="6. 为什么容器中放一个WebMvcConfigurer就能配置底层行为"></a>6. 为什么容器中放一个WebMvcConfigurer就能配置底层行为</h3><ol>
<li>WebMvcAutoConfiguration 是一个自动配置类，它里面有一个 EnableWebMvcConfiguration</li>
<li>EnableWebMvcConfiguration继承与 DelegatingWebMvcConfiguration，这两个都生效</li>
<li>DelegatingWebMvcConfiguration利用 ID 把容器中 所有 WebMvcConfigurer 注入进来</li>
<li>别人调用 <code>DelegatingWebMvcConfiguration</code> 的方法配置底层规则，而它调用所有 WebMvcConfigurer的配置底层方法。</li>
</ol>
<h2 id="3-路径匹配"><a href="#3-路径匹配" class="headerlink" title="3. 路径匹配"></a>3. 路径匹配</h2><p><strong>Spring5.3</strong> 之后加入了更多的请求路径匹配的实现策略；<br>以前只支持 AntPathMatcher 策略, 现在提供了 <strong>PathPatternParser</strong>策略。并且可以让我们指定到底使用那种策略。</p>
<h3 id="1-Ant风格路径用法"><a href="#1-Ant风格路径用法" class="headerlink" title="1. Ant风格路径用法"></a>1. Ant风格路径用法</h3><p>Ant 风格的路径模式语法具有以下规则：</p>
<ul>
<li>*：表示<strong>任意数量</strong>的字符。</li>
<li>?：表示任意<strong>一个字符</strong>。</li>
<li><strong>：表示</strong>任意数量的目录**。</li>
<li>{}：表示一个命名的模式<strong>占位符</strong>。</li>
<li>[]：表示<strong>字符集合</strong>，例如[a-z]表示小写字母。</li>
</ul>
<p>例如：</p>
<ul>
<li>*.html匹配任意名称，扩展名为.html的文件。</li>
<li>&#x2F;folder1&#x2F;<em>&#x2F;</em>.java匹配在folder1目录下的任意两级目录下的.java文件。</li>
<li>&#x2F;folder2&#x2F;**&#x2F;*.jsp匹配在folder2目录下任意目录深度的.jsp文件。</li>
<li>&#x2F;{type}&#x2F;{id}.html匹配任意文件名为{id}.html，在任意命名的{type}目录下的文件。</li>
</ul>
<p>注意：Ant 风格的路径模式语法中的特殊字符需要转义，如：</p>
<ul>
<li>要匹配文件路径中的星号，则需要转义为\*。</li>
<li>要匹配文件路径中的问号，则需要转义为\?。</li>
</ul>
<h3 id="2-模式切换"><a href="#2-模式切换" class="headerlink" title="2. 模式切换"></a>2. 模式切换</h3><h4 id="AntPathMatcher-与-PathPatternParser"><a href="#AntPathMatcher-与-PathPatternParser" class="headerlink" title="AntPathMatcher 与 PathPatternParser"></a>AntPathMatcher 与 PathPatternParser</h4><ul>
<li><p>PathPatternParser在 jmh 基准测试下，有 6<del>8 倍吞吐量提升，降低 30%</del>40%空间分配率</p>
</li>
<li><p>PathPatternParser 兼容 AntPathMatcher语法，并支持更多类型的路径模式</p>
</li>
<li><p>PathPatternParser “******” <strong>多段匹配</strong>的支持<strong>仅允许在模式末尾使用</strong></p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">@GetMapping(&quot;/a*/b?/&#123;p1</span>:<span class="hljs-string">[a-f]+&#125;&quot;)</span>
<span class="hljs-attr">public</span> <span class="hljs-string">String hello(HttpServletRequest request, </span>
                    <span class="hljs-attr">@PathVariable(&quot;p1&quot;)</span> <span class="hljs-string">String path) &#123;</span>

    <span class="hljs-attr">log.info(&quot;路径变量p1：</span> <span class="hljs-string">&#123;&#125;&quot;, path);</span>
    <span class="hljs-attr">//获取请求路径</span>
    <span class="hljs-attr">String</span> <span class="hljs-string">uri = request.getRequestURI();</span>
    <span class="hljs-attr">return</span> <span class="hljs-string">uri;</span>
<span class="hljs-attr">&#125;</span></code></pre></div>
<p>总结： </p>
</li>
<li><p>使用默认的路径匹配规则，是由 PathPatternParser 提供的</p>
</li>
<li><p>如果路径中间需要有 **，替换成ant风格路径</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># 改变路径匹配策略：</span>
<span class="hljs-comment"># ant_path_matcher 老版策略；</span>
<span class="hljs-comment"># path_pattern_parser 新版策略；</span>
<span class="hljs-attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="hljs-string">ant_path_matcher</span></code></pre></div></li>
</ul>
<h2 id="4-内容协商"><a href="#4-内容协商" class="headerlink" title="4. 内容协商"></a>4. 内容协商</h2><p>一套系统适配多端数据返回<br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681217799861-dde49224-a767-489b-80b7-7d8d503e33cf.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_23,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23faf9f7&from=url&id=gZ4iS&originHeight=420&originWidth=797&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p>
<h3 id="1-多端内容适配"><a href="#1-多端内容适配" class="headerlink" title="1. 多端内容适配"></a>1. 多端内容适配</h3><h4 id="1-默认规则-1"><a href="#1-默认规则-1" class="headerlink" title="1. 默认规则"></a>1. 默认规则</h4><ol>
<li><strong>SpringBoot 多端内容适配</strong>。<ol>
<li><strong>基于请求头内容协商</strong>：（默认开启）<ol>
<li>客户端向服务端发送请求，携带HTTP标准的<strong>Accept请求头</strong>。<ol>
<li><strong>Accept</strong>: application&#x2F;json、text&#x2F;xml、text&#x2F;yaml</li>
<li>服务端根据客户端<strong>请求头期望的数据类型</strong>进行<strong>动态返回</strong></li>
<li>**1、默认支持把对象写为json。因为默认web场景导入了jackson处理json的包;jackson-core</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<ul>
<li>2、jackson也支持把数据写为xml。导入xml相关依赖**<ol start="2">
<li><strong>基于请求参数内容协商：（需要开启）下面的?format就是要返回数据的格式。</strong><ol>
<li>发送请求 GET &#x2F;projects&#x2F;spring-boot?format&#x3D;json</li>
<li>匹配到 @GetMapping(“&#x2F;projects&#x2F;spring-boot”)</li>
<li>根据<strong>参数协商</strong>，优先返回 json 类型数据【<strong>需要开启参数匹配设置</strong>】</li>
<li>发送请求 GET &#x2F;projects&#x2F;spring-boot?format&#x3D;xml,优先返回 xml 类型数据</li>
</ol>
</li>
</ol>
</li>
</ul>
<h4 id="2-效果演示"><a href="#2-效果演示" class="headerlink" title="2. 效果演示"></a>2. 效果演示</h4><p>请求同一个接口，可以返回json和xml不同格式数据,<strong>、默认支持把对象写为json。因为默认web场景导入了jackson处理json的包;jackson-core,jackson也支持把数据写为xml。导入xml相关依赖</strong></p>
<ol>
<li><p>引入支持写出xml内容依赖</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
</li>
<li><p>标注注解</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">@JacksonXmlRootElement</span>  <span class="hljs-string">// 可以写出为xml文档</span>
<span class="hljs-attr">@Data</span>
<span class="hljs-attr">public</span> <span class="hljs-string">class Person &#123;</span>
    <span class="hljs-attr">private</span> <span class="hljs-string">Long id;</span>
    <span class="hljs-attr">private</span> <span class="hljs-string">String userName;</span>
    <span class="hljs-attr">private</span> <span class="hljs-string">String email;</span>
    <span class="hljs-attr">private</span> <span class="hljs-string">Integer age;</span>
<span class="hljs-attr">&#125;</span>
</code></pre></div>
</li>
<li><p>开启基于请求参数的内容协商</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># 开启基于请求参数的内容协商功能。 默认参数名：format。 默认此功能不开启</span>
<span class="hljs-attr">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="hljs-string">true</span>
<span class="hljs-comment"># 指定内容协商时使用的参数名。默认是 format</span>
<span class="hljs-attr">spring.mvc.contentnegotiation.parameter-name</span>=<span class="hljs-string">type</span></code></pre></div>
</li>
<li><p>效果</p>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681220124448-e8611612-97bc-4823-9b00-20dd9d579abf.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_17,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f9f8f8&from=url&id=tIIrj&originHeight=306&originWidth=594&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload><br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681220145378-86fabd90-a78c-4f60-9efa-eb2960915832.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_16,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f6f5f5&from=url&id=mh0xz&originHeight=256&originWidth=575&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-配置协商规则与支持类型"><a href="#3-配置协商规则与支持类型" class="headerlink" title="3. 配置协商规则与支持类型"></a>3. 配置协商规则与支持类型</h3><ol>
<li><p>修改<strong>内容协商方式</strong></p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#使用参数进行内容协商</span>
<span class="hljs-attr">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="hljs-string">true  </span>
<span class="hljs-comment">#自定义参数名，默认为format</span>
<span class="hljs-attr">spring.mvc.contentnegotiation.parameter-name</span>=<span class="hljs-string">myparam </span></code></pre></div>
</li>
<li><p>大多数 MediaType 都是开箱即用的。也可以<strong>自定义内容类型，如：</strong></p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">spring.mvc.contentnegotiation.media-types.yaml</span>=<span class="hljs-string">text/yaml</span></code></pre></div></li>
</ol>
<h3 id="2-自定义内容返回"><a href="#2-自定义内容返回" class="headerlink" title="2. 自定义内容返回"></a>2. 自定义内容返回</h3><h4 id="1-增加yaml返回支持"><a href="#1-增加yaml返回支持" class="headerlink" title="1. 增加yaml返回支持"></a>1. 增加yaml返回支持</h4><p>导入依赖</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">&lt;dependency&gt;</span>
    <span class="hljs-attr">&lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;</span>
    <span class="hljs-attr">&lt;artifactId&gt;jackson-dataformat-yaml&lt;/artifactId&gt;</span>
<span class="hljs-attr">&lt;/dependency&gt;</span></code></pre></div>
<p>把对象写出成YAML</p>
<div class="code-wrapper"><pre><code class="hljs properties">    <span class="hljs-attr">public</span> <span class="hljs-string">static void main(String[] args) throws JsonProcessingException &#123;</span>
        <span class="hljs-attr">Person</span> <span class="hljs-string">person = new Person();</span>
        <span class="hljs-attr">person.setId(1L);</span>
        <span class="hljs-attr">person.setUserName(&quot;张三&quot;);</span>
        <span class="hljs-attr">person.setEmail(&quot;aaa@qq.com&quot;);</span>
        <span class="hljs-attr">person.setAge(18);</span>
<span class="hljs-attr">//禁用文档的开始标记</span>
        <span class="hljs-attr">YAMLFactory</span> <span class="hljs-string">factory = new YAMLFactory().disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER);</span>
        <span class="hljs-attr">ObjectMapper</span> <span class="hljs-string">mapper = new ObjectMapper(factory);</span>

        <span class="hljs-attr">String</span> <span class="hljs-string">s = mapper.writeValueAsString(person);</span>
        <span class="hljs-attr">System.out.println(s);</span>
    <span class="hljs-attr">&#125;</span></code></pre></div>
<p>编写配置</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#新增一种媒体类型，</span>
<span class="hljs-attr">spring.mvc.contentnegotiation.media-types.yaml</span>=<span class="hljs-string">text/yaml</span></code></pre></div>
<p>增加HttpMessageConverter组件，专门负责把对象写出为yaml格式</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">@Bean</span>
<span class="hljs-attr">public</span> <span class="hljs-string">WebMvcConfigurer webMvcConfigurer()&#123;</span>
    <span class="hljs-attr">return</span> <span class="hljs-string">new WebMvcConfigurer() &#123;</span>
        <span class="hljs-attr">@Override</span> <span class="hljs-string">//配置一个能把对象转为yaml的messageConverter</span>
        <span class="hljs-attr">public</span> <span class="hljs-string">void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</span>
            <span class="hljs-attr">converters.add(new</span> <span class="hljs-string">MyYamlHttpMessageConverter());//将新增的配置格式和配置类关联起来</span>
        <span class="hljs-attr">&#125;</span>
    <span class="hljs-attr">&#125;;</span>
<span class="hljs-attr">&#125;</span></code></pre></div>
<h3 id="3-HttpMessageConverter的示例写法"><a href="#3-HttpMessageConverter的示例写法" class="headerlink" title="3. HttpMessageConverter的示例写法"></a>3. HttpMessageConverter的示例写法</h3><div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">public</span> <span class="hljs-string">class MyYamlHttpMessageConverter extends AbstractHttpMessageConverter&lt;Object&gt; &#123;</span>
<span class="hljs-attr">//或者是实现</span> <span class="hljs-string">HttpMessageConverter</span>
    <span class="hljs-attr">private</span> <span class="hljs-string">ObjectMapper objectMapper = null; //把对象转成yaml</span>

    <span class="hljs-attr">public</span> <span class="hljs-string">MyYamlHttpMessageConverter()&#123;</span>
        <span class="hljs-attr">//告诉SpringBoot这个MessageConverter支持哪种媒体类型</span>  <span class="hljs-string">//媒体类型</span>
        <span class="hljs-attr">super(new</span> <span class="hljs-string">MediaType(&quot;text&quot;, &quot;yaml&quot;, Charset.forName(&quot;UTF-8&quot;)));</span>
        <span class="hljs-attr">YAMLFactory</span> <span class="hljs-string">factory = new YAMLFactory()</span>
                <span class="hljs-attr">.disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER);</span>
        <span class="hljs-attr">this.objectMapper</span> = <span class="hljs-string">new ObjectMapper(factory);</span>
    <span class="hljs-attr">&#125;</span>

    <span class="hljs-attr">@Override</span>
    <span class="hljs-attr">protected</span> <span class="hljs-string">boolean supports(Class&lt;?&gt; clazz) &#123;</span>
        <span class="hljs-attr">//只要是对象类型，不是基本类型</span>
        <span class="hljs-attr">return</span> <span class="hljs-string">true;</span>
    <span class="hljs-attr">&#125;</span>

    <span class="hljs-attr">@Override</span>  <span class="hljs-string">//@RequestBody,读取请求对象 </span>
    <span class="hljs-attr">protected</span> <span class="hljs-string">Object readInternal(Class&lt;?&gt; clazz, HttpInputMessage inputMessage) throws IOException, HttpMessageNotReadableException &#123;</span>
        <span class="hljs-attr">return</span> <span class="hljs-string">null;</span>
    <span class="hljs-attr">&#125;</span>

    <span class="hljs-attr">@Override</span> <span class="hljs-string">//@ResponseBody 把对象怎么写出去</span>
    <span class="hljs-attr">protected</span> <span class="hljs-string">void writeInternal(Object methodReturnValue, HttpOutputMessage outputMessage) throws IOException, HttpMessageNotWritableException &#123;</span>

        <span class="hljs-attr">//try-with写法，自动关流</span>
        <span class="hljs-attr">try(OutputStream</span> <span class="hljs-string">os = outputMessage.getBody())&#123;</span>
            <span class="hljs-attr">this.objectMapper.writeValue(os,methodReturnValue);</span>
        <span class="hljs-attr">&#125;</span>

    <span class="hljs-attr">&#125;</span>
<span class="hljs-attr">&#125;</span></code></pre></div>
<h4 id="2-思考：如何增加其他"><a href="#2-思考：如何增加其他" class="headerlink" title="2. 思考：如何增加其他"></a>2. 思考：如何增加其他</h4><ul>
<li>配置媒体类型支持: <ul>
<li>spring.mvc.contentnegotiation.media-types.yaml&#x3D;text&#x2F;yaml</li>
</ul>
</li>
<li>编写对应的HttpMessageConverter，要告诉Boot这个支持的媒体类型<ul>
<li>按照3的示例</li>
</ul>
</li>
<li>把MessageConverter组件加入到底层<ul>
<li>容器中放一个<code>WebMvcConfigurer</code> 组件，并配置底层的MessageConverter</li>
</ul>
</li>
</ul>
<h2 id="3-内容协商原理-HttpMessageConverter"><a href="#3-内容协商原理-HttpMessageConverter" class="headerlink" title="3. 内容协商原理-HttpMessageConverter"></a>3. 内容协商原理-HttpMessageConverter</h2><ul>
<li>HttpMessageConverter 怎么工作？合适工作？</li>
<li>定制 HttpMessageConverter 来实现多端内容协商</li>
<li>编写WebMvcConfigurer提供的configureMessageConverters底层，修改底层的MessageConverter</li>
</ul>
<h3 id="1-ResponseBody由HttpMessageConverter处理"><a href="#1-ResponseBody由HttpMessageConverter处理" class="headerlink" title="1. @ResponseBody由HttpMessageConverter处理"></a>1. @ResponseBody由HttpMessageConverter处理</h3><p>标注了@ResponseBody的返回值 将会由支持它的 HttpMessageConverter写给浏览器</p>
<ol>
<li>如果controller方法的返回值标注了 @ResponseBody 注解<ol>
<li><p>请求进来先来到DispatcherServlet的doDispatch()进行处理</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">doDispatch()</span> <span class="hljs-string">是 Spring MVC 中的核心方法之一，用于处理请求的分发和调度。</span>

<span class="hljs-attr">在</span> <span class="hljs-string">Spring MVC 中，请求的处理流程如下：</span>

<span class="hljs-attr">1.客户端发送一个</span> <span class="hljs-string">HTTP 请求到服务器。</span>
<span class="hljs-attr">2.前端控制器（Front</span> <span class="hljs-string">Controller）接收到请求，这个控制器通常是 DispatcherServlet，它是 </span>
<span class="hljs-attr">Spring</span> <span class="hljs-string">MVC 的核心组件。</span>
<span class="hljs-attr">3.DispatcherServlet</span> <span class="hljs-string">根据请求的 URL 找到相应的处理器（Handler）。</span>
<span class="hljs-attr">4.处理器执行相应的业务逻辑并返回一个</span> <span class="hljs-string">ModelAndView 对象。(其中执行目标方法要准备参数解析器和</span>
<span class="hljs-attr">返回值解析器）</span>
<span class="hljs-attr">5.DispatcherServlet</span> <span class="hljs-string">根据 ModelAndView 对象选择合适的视图（View）进行渲染。</span>
<span class="hljs-attr">最终将渲染结果返回给客户端。（</span>
<span class="hljs-attr">在这个处理流程中，doDispatch()</span> <span class="hljs-string">方法负责实际执行第 4 步和第 5 步的操作。</span>

<span class="hljs-attr">具体而言，doDispatch()</span> <span class="hljs-string">方法会执行以下主要任务：</span>

<span class="hljs-attr">解析请求，包括解析请求的方法、路径、参数等信息。</span>
<span class="hljs-attr">根据请求的方法和路径，确定匹配的处理器（Handler）。</span>
<span class="hljs-attr">执行处理器的业务逻辑，处理请求并返回一个</span> <span class="hljs-string">ModelAndView 对象。</span>
<span class="hljs-attr">根据</span> <span class="hljs-string">ModelAndView 对象中的视图名字，选择合适的视图（View）进行渲染。</span>
<span class="hljs-attr">渲染视图，生成最终的响应结果。</span>
<span class="hljs-attr">doDispatch()</span> <span class="hljs-string">方法的具体实现会涉及到请求的映射、处理器适配器、处理器拦截器、参数解析器等等。</span>
<span class="hljs-attr">该方法是</span> <span class="hljs-string">Spring MVC 框架的核心之一，在请求的处理过程中起到了关键的作用。</span>

<span class="hljs-attr">需要注意的是，doDispatch()</span> <span class="hljs-string">方法通常由 DispatcherServlet 自动调用，开发者一般不需要直接调用</span>
<span class="hljs-attr">该方法。开发者主要关注配置合适的请求映射、编写处理器方法以及配置视图解析器等，框架会自动根据</span>
<span class="hljs-attr">配置和规则来调用</span> <span class="hljs-string">doDispatch() 方法来处理请求。</span></code></pre></div>
</li>
<li><p>找到一个 HandlerAdapter 适配器。利用适配器执行目标方法</p>
</li>
<li><p>RequestMappingHandlerAdapter来执行，调用invokeHandlerMethod（）来执行目标方法</p>
</li>
<li><p>目标方法执行之前，准备好两个东西</p>
<ol>
<li>HandlerMethodArgumentResolver：参数解析器，确定目标方法每个参数值</li>
<li>HandlerMethodReturnValueHandler：返回值处理器，确定目标方法的返回值改怎么处理</li>
</ol>
</li>
<li><p>RequestMappingHandlerAdapter 里面的invokeAndHandle()真正执行目标方法</p>
</li>
<li><p>目标方法执行完成，会返回<strong>返回值对象</strong></p>
</li>
<li><p>**找到一个合适的返回值处理器 **HandlerMethodReturnValueHandler</p>
</li>
<li><p>最终找到 RequestResponseBodyMethodProcessor能处理 标注了 @ResponseBody注解的方法</p>
</li>
<li><p>RequestResponseBodyMethodProcessor 调用writeWithMessageConverters ,利用MessageConverter把返回值写出去</p>
</li>
</ol>
</li>
</ol>
<p>上面解释：@ResponseBody由HttpMessageConverter处理</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">HttpMessageConverter</span> <span class="hljs-string">是 Spring MVC 中的一个关键接口，用于处理 HTTP 请求和响应消息的转换。</span>
<span class="hljs-attr">它负责将</span> <span class="hljs-string">Java 对象与 HTTP 请求/响应的内容进行转换，使得应用程序可以方便地处理不同类型的数据格式，</span>
<span class="hljs-attr">如</span> <span class="hljs-string">JSON、XML、表单数据等。</span></code></pre></div>

<ol>
<li>HttpMessageConverter 会<strong>先进行内容协商</strong><ol>
<li>遍历所有的MessageConverter看谁支持这种<strong>内容类型的数据</strong></li>
<li>默认MessageConverter有以下</li>
<li><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681275459547-89d8d651-b52f-4d47-bff9-6db123624424.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_15,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f0eeeb&from=url&id=w9v5M&originHeight=282&originWidth=532&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></li>
<li>最终因为要json所以MappingJackson2HttpMessageConverter支持写出json</li>
<li>jackson用ObjectMapper（是一个类）把对象写出去</li>
</ol>
</li>
</ol>
<h3 id="2-WebMvcAutoConfiguration提供几种默认HttpMessageConverters"><a href="#2-WebMvcAutoConfiguration提供几种默认HttpMessageConverters" class="headerlink" title="2. WebMvcAutoConfiguration提供几种默认HttpMessageConverters"></a>2. WebMvcAutoConfiguration提供几种默认HttpMessageConverters</h3><ul>
<li>EnableWebMvcConfiguration通过 addDefaultHttpMessageConverters添加了默认的MessageConverter；如下：<ul>
<li>ByteArrayHttpMessageConverter： 支持字节数据读写</li>
<li>StringHttpMessageConverter： 支持字符串读写</li>
<li>ResourceHttpMessageConverter：支持资源读写</li>
<li>ResourceRegionHttpMessageConverter: 支持分区资源写出</li>
<li>AllEncompassingFormHttpMessageConverter：支持表单xml&#x2F;json读写</li>
<li>MappingJackson2HttpMessageConverter： 支持请求响应体Json读写</li>
</ul>
</li>
</ul>
<p>默认8个：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681302411019-0c0425aa-6679-4b2b-a456-b31c151c6e83.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_15,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f1eeec&from=url&id=WrjKA&originHeight=237&originWidth=532&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload><br>系统提供默认的MessageConverter 功能有限，仅用于json或者普通返回数据。额外增加新的内容协商功能，必须增加新的HttpMessageConverter</p>
<h1 id="5-模板引擎"><a href="#5-模板引擎" class="headerlink" title="5. 模板引擎"></a>5. 模板引擎</h1><ul>
<li>由于 <strong>SpringBoot</strong> 使用了<strong>嵌入式 Servlet 容器</strong>。所以 <strong>JSP</strong> 默认是<strong>不能使用</strong>的。</li>
<li>如果需要<strong>服务端页面渲染</strong>，优先考虑使用 模板引擎。</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681354523290-b89d7e0d-b9aa-40f5-8d22-d3d09d02b136.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_28,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f6f5f5&from=url&id=FMo0Z&originHeight=654&originWidth=999&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload><br>模板引擎页面默认放在 src&#x2F;main&#x2F;resources&#x2F;templates<br><strong>SpringBoot</strong> 包含以下模板引擎的自动配置</p>
<ul>
<li>FreeMarker</li>
<li>Groovy</li>
<li><strong>Thymeleaf</strong></li>
<li>Mustache</li>
</ul>
<p><strong>Thymeleaf官网</strong>：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">https://www.thymeleaf.org/</a></p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">&lt;!DOCTYPE</span> <span class="hljs-string">html&gt;</span>
<span class="hljs-attr">&lt;html</span> <span class="hljs-string">xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</span>
<span class="hljs-attr">&lt;head&gt;</span>
	<span class="hljs-attr">&lt;title&gt;Good</span> <span class="hljs-string">Thymes Virtual Grocery&lt;/title&gt;</span>
	<span class="hljs-attr">&lt;meta</span> <span class="hljs-string">http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</span>
	<span class="hljs-attr">&lt;link</span> <span class="hljs-string">rel=&quot;stylesheet&quot; type=&quot;text/css&quot; media=&quot;all&quot; th:href=&quot;@&#123;/css/gtvg.css&#125;&quot; /&gt;</span>
<span class="hljs-attr">&lt;/head&gt;</span>
<span class="hljs-attr">&lt;body&gt;</span>
	<span class="hljs-attr">&lt;p</span> <span class="hljs-string">th:text=&quot;#&#123;home.welcome&#125;&quot;&gt;Welcome to our grocery store!&lt;/p&gt;</span>
<span class="hljs-attr">&lt;/body</span>
<span class="hljs-attr">&lt;/html&gt;</span></code></pre></div>
<h2 id="1-Thymeleaf整合（是前后端一体的开发）"><a href="#1-Thymeleaf整合（是前后端一体的开发）" class="headerlink" title="1. Thymeleaf整合（是前后端一体的开发）"></a>1. Thymeleaf整合（是前后端一体的开发）</h2><div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">&lt;dependency&gt;</span>
    <span class="hljs-attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span>
    <span class="hljs-attr">&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span>
<span class="hljs-attr">&lt;/dependency&gt;</span></code></pre></div>
<p>自动配置原理</p>
<ol>
<li>开启了org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration自动配置</li>
<li>属性绑定在 ThymeleafProperties类 中，对应配置文件 spring.thymeleaf 内容（也就是配置文件中以spring.thymeleaf开头的属性）</li>
<li>所有的模板页面默认在 classpath:&#x2F;templates文件夹下</li>
<li>默认效果<ol>
<li>所有的模板页面在 classpath:&#x2F;templates&#x2F;下面找</li>
<li>找后缀名为.html的页面</li>
</ol>
</li>
</ol>
<p>事例：<br>1.使用Thymeleaf来处理的项目其controller类用@Controller &#x2F;&#x2F;适配 服务端渲染 前后不分离模式开始;而前后端分离的项目用@Resttroller注解<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/east7/p/10462279.html">Spring 注解之@RestController与@Controller的区别 - 楼兰胡杨 - 博客园</a></p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@RestController</span>无法返回指定页面，而<span class="hljs-variable">@Controller</span>可以；前者可以直接返回数据，
后者需要<span class="hljs-variable">@ResponseBody</span>辅助。
如果需要返回JSON，XML或自定义mediaType内容到页面，<span class="hljs-variable">@RestController</span>自己就可以搞定，
这个注解对于返回数据比较方便，因为它会自动将对象实体转换为JSON格式。而<span class="hljs-variable">@Controller</span>需要在对应的
方法加上<span class="hljs-variable">@ResponseBody</span>注解。</code></pre></div>
<p>2.get请求其参数是写在url中的，而post请求参数是在请求体中的。<br>3.@GetMapping（）用来修饰处理get请求的方法。<br>4.&#x2F;&#x2F;模板的逻辑视图名<br>&#x2F;&#x2F;物理视图 &#x3D; 前缀 + 逻辑视图名 + 后缀<br>&#x2F;&#x2F;真实地址 &#x3D; classpath:&#x2F;templates&#x2F;welcome.html其中的前缀和后缀在ThymeleafProperties类中指定了的<br>5.其Thymeleaf还提供了一些工具类，常用#类名表示，例如：#string。这些工具类可以进行简单的运行操作。<br>6.如果html中要使用Thymeleaf语法，需要提供其命名空间	</p>
<h2 id="2-基础语法（在html中使用Thymeleaf）"><a href="#2-基础语法（在html中使用Thymeleaf）" class="headerlink" title="2. 基础语法（在html中使用Thymeleaf）"></a>2. 基础语法（在html中使用Thymeleaf）</h2><h3 id="1-核心用法"><a href="#1-核心用法" class="headerlink" title="1. 核心用法"></a>1. 核心用法</h3><p>导入命名空间：</p>
<div class="code-wrapper"><pre><code class="hljs avrasm">&lt;html lang=<span class="hljs-string">&quot;en&quot;</span> xmlns:th=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;
<span class="hljs-symbol">xmlns:</span>th属性，该属性是Thymeleaf命名空间（http://www.thymeleaf<span class="hljs-meta">.org</span>）的声明。
这个命名空间允许您在HTML代码中使用Thymeleaf特定的属性和表达式。</code></pre></div>
<p><strong>th:xxx：动态渲染指定的 html 标签属性值、或者th指令（遍历、判断等）</strong></p>
<ul>
<li><p>th:text：标签体内文本值渲染</p>
<ul>
<li>th:utext：不会转义，显示为html原本的样子。也就是文本中的html元素可以被解析</li>
</ul>
</li>
<li><p>th:属性：标签指定属性渲染</p>
</li>
<li><p>th:attr：标签任意属性渲染</p>
</li>
<li><p>th:if  （根据后端逻辑或数据的条件来控制是否在渲染过程中包含或显示某个元素。）  th:each…：其他th指令</p>
</li>
<li><p>例如：</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">&lt;p</span> <span class="hljs-string">th:text=&quot;$&#123;content&#125;&quot;&gt;原内容&lt;/p&gt;</span>
<span class="hljs-attr">&lt;a</span> <span class="hljs-string">th:href=&quot;$&#123;url&#125;&quot;&gt;登录&lt;/a&gt;</span>
<span class="hljs-attr">&lt;img</span> <span class="hljs-string">src=&quot;../../images/gtvglogo.png&quot; </span>
     <span class="hljs-attr">th</span>:<span class="hljs-string">attr=&quot;src=@&#123;/images/gtvglogo.png&#125;,title=#&#123;logo&#125;,alt=#&#123;logo&#125;&quot; /&gt;</span></code></pre></div>
<p><strong>表达式：用来动态取值</strong></p>
</li>
<li><p><strong>${}：变量取值；使用model共享给页面的值都直接用${}是用下面的方法实现的：</strong></p>
</li>
</ul>
<p>model.addAttribute(“imgUrl”<strong>,</strong>“&#x2F;4.jpg”)<strong>;imgUrl就是共享的值</strong></p>
<ul>
<li><strong>@{}：url路径；@{}是一个Thymeleaf的URL表达式，它用来在HTML文档中生成一个相对于当前应用上下文的URL路径。当然也可以直接使用{}表示，例如：src&#x3D;”{}”但是其如果在配置文件中配置了</strong>server.servlet.context-path&#x3D;&#x2F;demo那么要想配置的src路径生效需要在src的路径前添加&#x2F;demo前缀否则无法访问，如果是使用的是src&#x3D;的是@{}那么可以不用修改src仍旧可以正常访问。</li>
<li>**@{}路径中的内容会自动添加链接头部和尾部	**</li>
<li>#{}：国际化消息</li>
<li>~{}：片段引用</li>
<li>*{}：变量选择：需要配合th:object绑定对象</li>
</ul>
<p><strong>系统工具&amp;内置对象：</strong><a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#appendix-a-expression-basic-objects">详细文档</a></p>
<ul>
<li>param：请求参数对象</li>
<li>session：session对象</li>
<li>application：application对象</li>
<li>#execInfo：模板执行信息</li>
<li>#messages：国际化消息</li>
<li>#uris：uri&#x2F;url工具</li>
<li>#conversions：类型转换工具</li>
<li>#dates：日期工具，是java.util.Date对象的工具类</li>
<li>#calendars：类似#dates，只不过是java.util.Calendar对象的工具类</li>
<li>#temporals： JDK8+ <strong>java.time</strong> API 工具类</li>
<li>#numbers：数字操作工具</li>
<li>#strings：字符串操作</li>
<li>#objects：对象操作</li>
<li>#bools：bool操作</li>
<li>#arrays：array工具</li>
<li>#lists：list工具</li>
<li>#sets：set工具</li>
<li>#maps：map工具</li>
<li>#aggregates：集合聚合工具（sum、avg）</li>
<li>#ids：id生成工具</li>
</ul>
<h3 id="2-语法示例"><a href="#2-语法示例" class="headerlink" title="2. 语法示例"></a>2. 语法示例</h3><p><strong>表达式：</strong></p>
<ul>
<li>变量取值：${…}</li>
<li>url 取值：@{…}</li>
<li>国际化消息：#{…}</li>
<li>变量选择：*{…}</li>
<li>片段引用:~{…}</li>
</ul>
<p><strong>常见：</strong></p>
<ul>
<li>文本：’one text’，’another one!’,…</li>
<li>数字：0,34,3.0,12.3,…</li>
<li>布尔：true、false</li>
<li>null:null</li>
<li>变量名：one,sometext,main…</li>
</ul>
<p><strong>文本操作：</strong></p>
<ul>
<li>拼串：+</li>
<li>文本替换：| The name is ${name} |</li>
</ul>
<p><strong>布尔操作：</strong></p>
<ul>
<li>二进制运算：and,or</li>
<li>取反：!,not</li>
</ul>
<p><strong>比较运算：</strong></p>
<ul>
<li>比较：&gt;，&lt;，&lt;&#x3D;，&gt;&#x3D;（gt，lt，ge,le）</li>
<li>等值运算：&#x3D;&#x3D;,!&#x3D;（eq，ne）</li>
</ul>
<p><strong>条件运算：</strong></p>
<ul>
<li>if-then：(if)?(then)</li>
<li>if-then-else:(if)?(then):(else)</li>
<li>default:(value)?:(defaultValue)</li>
</ul>
<p><strong>特殊语法：</strong></p>
<ul>
<li>无操作：_</li>
</ul>
<p><strong>所有以上都可以嵌套组合</strong></p>
<div class="code-wrapper"><pre><code class="hljs ada"><span class="hljs-symbol">&#x27;User</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> <span class="hljs-type">&#x27; </span>+ ($&#123;user.isAdmin()&#125; ? <span class="hljs-symbol">&#x27;Administrator</span>&#x27; : ($&#123;<span class="hljs-type">user.type</span>&#125; ?: <span class="hljs-symbol">&#x27;Unknown</span>&#x27;))</code></pre></div>
<h2 id="3-属性设置"><a href="#3-属性设置" class="headerlink" title="3. 属性设置"></a>3. 属性设置</h2><ol>
<li>th:href&#x3D;”@{&#x2F;product&#x2F;list}”</li>
<li>th:attr&#x3D;”class&#x3D;${active}”</li>
<li>th:attr&#x3D;”src&#x3D;@{&#x2F;images&#x2F;gtvglogo.png},title&#x3D;${logo},alt&#x3D;#{logo}”</li>
<li>th:checked&#x3D;”${user.active}”<div class="code-wrapper"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;content&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>原内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;url&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../images/gtvglogo.png&quot;</span> </span></span>
<span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">th:attr</span>=<span class="hljs-string">&quot;src=@</span></span></span><span class="hljs-template-tag">&#123;/<span class="hljs-name">images</span>/gtvglogo.png&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">,title=#</span></span></span><span class="hljs-template-variable">&#123;logo&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">,alt=#</span></span></span><span class="hljs-template-variable">&#123;logo&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span></code></pre></div></li>
</ol>
<h2 id="4-遍历"><a href="#4-遍历" class="headerlink" title="4. 遍历"></a>4. 遍历</h2><p>语法： th:each&#x3D;”元素名,迭代状态 : ${集合}”</p>
<div class="code-wrapper"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;prod : $</span></span></span><span class="hljs-template-variable">&#123;prods&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;prod.name&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Onions<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;prod.price&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>2.41<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;prod.inStock&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">? #</span></span></span><span class="hljs-template-variable">&#123;true&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> : #</span></span></span><span class="hljs-template-variable">&#123;false&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>yes<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;prod,iterStat : $</span></span></span><span class="hljs-template-variable">&#123;prods&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">th:class</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;iterStat.odd&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">? &#x27;odd&#x27;&quot;</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;prod.name&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Onions<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;prod.price&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>2.41<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;prod.inStock&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">? #</span></span></span><span class="hljs-template-variable">&#123;true&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> : #</span></span></span><span class="hljs-template-variable">&#123;false&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>yes<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span></code></pre></div>
<p>iterStat 有以下属性：</p>
<ul>
<li>index：当前遍历元素的索引，从0开始</li>
<li>count：当前遍历元素的索引，从1开始</li>
<li>size：需要遍历元素的总数量</li>
<li>current：当前正在遍历的元素对象</li>
<li>even&#x2F;odd：是否偶数&#x2F;奇数行</li>
<li>first：是否第一个元素</li>
<li>last：是否最后一个元素<div class="code-wrapper"><pre><code class="hljs vim">&lt;<span class="hljs-keyword">th</span> scope=<span class="hljs-string">&quot;col&quot;</span>&gt;#&lt;/<span class="hljs-keyword">th</span>&gt;这里的<span class="hljs-keyword">th</span>标签表示是一个表头标签，scope属性指定表头单元格的范围，这里的范围
是一个表头占据一个单元格。</code></pre></div></li>
</ul>
<h2 id="5-判断"><a href="#5-判断" class="headerlink" title="5. 判断"></a>5. 判断</h2><h3 id="th-if"><a href="#th-if" class="headerlink" title="th:if"></a>th:if</h3><div class="code-wrapper"><pre><code class="hljs dart">&lt;td th:text=<span class="hljs-string">&quot;| <span class="hljs-subst">$&#123;person.age&#125;</span> / <span class="hljs-subst">$&#123;person.age &gt;= <span class="hljs-number">18</span>?<span class="hljs-string">&#x27;成年&#x27;</span>:<span class="hljs-string">&#x27;未成年&#x27;</span> &#125;</span>|&quot;</span>&gt;  &lt;/td&gt;</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span></span></span>
<span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;comments.html&quot;</span></span></span>
<span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@</span></span></span><span class="hljs-template-tag">&#123;/<span class="hljs-name">product</span>/comments(prodId=$&#123;prod.id&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">)&#125;&quot;</span></span></span>
<span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;not #lists.isEmpty(prod.comments)&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span></span></span>
<span class="hljs-tag"><span class="language-xml">  &gt;</span>view&lt;/a</span></code></pre></div>
<h3 id="th-switch"><a href="#th-switch" class="headerlink" title="th:switch"></a>th:switch</h3><div class="code-wrapper"><pre><code class="hljs axapta">&lt;<span class="hljs-keyword">div</span> th:<span class="hljs-keyword">switch</span>=<span class="hljs-string">&quot;$&#123;user.role&#125;&quot;</span>&gt;
  &lt;p th:<span class="hljs-keyword">case</span>=<span class="hljs-string">&quot;&#x27;admin&#x27;&quot;</span>&gt;User <span class="hljs-keyword">is</span> an administrator&lt;/p&gt;<span class="hljs-comment">//这里的admin的单引号表示其为一个字符串</span>
<span class="hljs-comment">//，和变量区分</span>

  &lt;p th:<span class="hljs-keyword">case</span>=<span class="hljs-string">&quot;#&#123;roles.manager&#125;&quot;</span>&gt;User <span class="hljs-keyword">is</span> a manager&lt;/p&gt;
  &lt;p th:<span class="hljs-keyword">case</span>=<span class="hljs-string">&quot;*&quot;</span>&gt;User <span class="hljs-keyword">is</span> some other thing&lt;/p&gt;
&lt;/<span class="hljs-keyword">div</span>&gt;</code></pre></div>

<h2 id="6-属性优先级"><a href="#6-属性优先级" class="headerlink" title="6. 属性优先级"></a>6. 属性优先级</h2><ul>
<li>片段</li>
<li>遍历</li>
<li>判断<div class="code-wrapper"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;item : $</span></span></span><span class="hljs-template-variable">&#123;items&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;item.description&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Item description here...<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>Order</th>
<th>Feature</th>
<th>Attributes</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>片段包含</td>
<td>th:insertth:replace</td>
</tr>
<tr>
<td>2</td>
<td>遍历</td>
<td>th:each</td>
</tr>
<tr>
<td>3</td>
<td>判断</td>
<td>th:ifth:unlessth:switchth:case</td>
</tr>
<tr>
<td>4</td>
<td>定义本地变量</td>
<td>th:objectth:with</td>
</tr>
<tr>
<td>5</td>
<td>通用方式属性修改</td>
<td>th:attrth:attrprependth:attrappend</td>
</tr>
<tr>
<td>6</td>
<td>指定属性修改</td>
<td>th:valueth:hrefth:src…</td>
</tr>
<tr>
<td>7</td>
<td>文本值</td>
<td>th:textth:utext</td>
</tr>
<tr>
<td>8</td>
<td>片段指定</td>
<td>th:fragment</td>
</tr>
<tr>
<td>9</td>
<td>片段移除</td>
<td>th:remove</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="7-行内写法"><a href="#7-行内写法" class="headerlink" title="7. 行内写法"></a>7. 行内写法</h2><p>[[…]] or [(…)]</p>
<div class="code-wrapper"><pre><code class="hljs lua">&lt;p&gt;Hello, <span class="hljs-string">[[$&#123;session.user.name&#125;]]</span>!&lt;/p&gt;</code></pre></div>
<h2 id="8-变量选择"><a href="#8-变量选择" class="headerlink" title="8. 变量选择"></a>8. 变量选择</h2><div class="code-wrapper"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:object</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;session.user&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Name: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;*</span></span></span><span class="hljs-template-variable">&#123;firstName&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Sebastian<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Surname: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;*</span></span></span><span class="hljs-template-variable">&#123;lastName&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Pepper<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Nationality: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;*</span></span></span><span class="hljs-template-variable">&#123;nationality&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Saturn<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></code></pre></div>
<p>等同于</p>
<div class="code-wrapper"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Name: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;session.user.firstName&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Sebastian<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Surname: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;session.user.lastName&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Pepper<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Nationality: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;session.user.nationality&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>Saturn<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
<span class="language-xml">&lt;/div</span></code></pre></div>
<h2 id="9-模板布局"><a href="#9-模板布局" class="headerlink" title="9. 模板布局"></a>9. 模板布局</h2><ul>
<li>定义模板： th:fragment</li>
<li>引用模板：~{templatename::selector}</li>
<li>插入模板：th:insert、th:replace<div class="code-wrapper"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">&quot;copy&quot;</span>&gt;</span><span class="hljs-symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:insert</span>=<span class="hljs-string">&quot;~</span></span></span><span class="hljs-template-variable">&#123;footer :: copy&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">&quot;~</span></span></span><span class="hljs-template-variable">&#123;footer :: copy&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml">  结果：</span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><span class="hljs-symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><span class="hljs-symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></code></pre></div>
<div class="code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">th</span>:<span class="hljs-keyword">insert</span>和<span class="hljs-keyword">th</span>:replace是Thymeleaf模板引擎中的两个属性，用于在模板中插入或替换其他模板片段。
<span class="hljs-keyword">th</span>:<span class="hljs-keyword">insert</span>属性用于在当前模板中插入另一个模板片段。
<span class="hljs-keyword">th</span>:replace属性用于在当前模板中替换自身的内容为另一个模板片段。</code></pre></div></li>
</ul>
<h2 id="10-devtools"><a href="#10-devtools" class="headerlink" title="10. devtools"></a>10. devtools</h2><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<p>修改页面后；ctrl+F9刷新效果（热启动）；前提是配置了devtools。<br>java代码的修改，如果devtools热启动了，可能会引起一些bug，难以排查<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691304138965-1792688e-a546-44c5-b225-df80d9bc8562.png#averageHue=%23f2f1dc&clientId=u5acfc650-ecf6-4&from=paste&height=46&id=u926de390&originHeight=58&originWidth=223&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=12806&status=done&style=none&taskId=u16c89229-3bdc-4732-9eb3-5693e766448&title=&width=178.4" srcset="/img/loading.gif" lazyload alt="image.png">（缓存机制）<br>spring.thymeleaf.check-template&#x3D;false检查模板是否存在</p>
<h1 id="6-国际化"><a href="#6-国际化" class="headerlink" title="6. 国际化"></a>6. 国际化</h1><p>国际化的自动配置参照MessageSourceAutoConfiguration<br><strong>实现步骤</strong>：</p>
<ol>
<li>Spring Boot 在类路径根下查找messages资源绑定文件（配置。文件名为：messages.properties</li>
<li>多语言可以定义多个消息文件，命名为messages_区域代码.properties。如：<ol>
<li>messages.properties：默认</li>
<li>messages_zh_CN.properties：中文环境</li>
<li>messages_en_US.properties：英语环境</li>
</ol>
</li>
<li>在<strong>程序中</strong>可以自动注入 MessageSource组件，获取国际化的配置项值</li>
<li>在<strong>页面中</strong>可以使用表达式  #{}获取国际化的配置项值<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-meta">@Autowired</span>  <span class="hljs-comment">//国际化取消息用的组件</span>
<span class="hljs-title class_">MessageSource</span> messageSource;
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/haha&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">haha</span>(<span class="hljs-params">HttpServletRequest request</span>)&#123;

    <span class="hljs-title class_">Locale</span> locale = request.<span class="hljs-title function_">getLocale</span>();
    <span class="hljs-comment">//利用代码的方式获取国际化配置文件中指定的配置项的值</span>
    <span class="hljs-title class_">String</span> login = messageSource.<span class="hljs-title function_">getMessage</span>(<span class="hljs-string">&quot;login&quot;</span>, <span class="hljs-literal">null</span>, locale);
    <span class="hljs-keyword">return</span> login;
&#125;
</code></pre></div></li>
</ol>
<h1 id="7-错误处理"><a href="#7-错误处理" class="headerlink" title="7. 错误处理"></a>7. 错误处理</h1><h2 id="1-默认机制"><a href="#1-默认机制" class="headerlink" title="1. 默认机制"></a>1. 默认机制</h2><p><strong>错误处理的自动配置</strong>都在ErrorMvcAutoConfiguration中，两大核心机制：</p>
<ul>
<li><ol>
<li>SpringBoot 会<strong>自适应处理错误</strong>，<strong>响应页面</strong>或<strong>JSON数据</strong><div class="code-wrapper"><pre><code class="hljs mipsasm">Spring <span class="hljs-keyword">Boot </span>会根据请求的类型和接受的媒体类型，自适应地处理错误，返回合适的响应格式。
如果请求是一个浏览器请求，Spring <span class="hljs-keyword">Boot </span>会返回一个 HTML 错误页面，这个页面也被称为白标错误页面。
如果请求是一个 RESTful 请求，或者接受的媒体类型是 <span class="hljs-keyword">JSON，Spring </span><span class="hljs-keyword">Boot </span>会返回一个 <span class="hljs-keyword">JSON </span>响应，
包含错误的详细信息，HTTP 状态码，和异常消息
</code></pre></div></li>
</ol>
</li>
<li><p>2.** SpringMVC的错误处理机制<strong>依然保留，</strong>MVC处理不了<strong>，才会</strong>交给boot进行处理**</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/svg/1613913/1681723795095-828d2034-1e6c-4d98-8e47-573dd6b5463b.svg#from=url&id=ez8nQ&originHeight=842&originWidth=1047&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload><br>1.springMvc处理错误：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691307013013-0d54dd7b-2189-4f1b-b63d-f880eeadd942.png#averageHue=%23fdfdfb&clientId=u8fdb1034-8532-4&from=paste&height=370&id=u8cfa0ee8&originHeight=463&originWidth=960&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=134823&status=done&style=none&taskId=ud0d4529f-dec1-4e92-8baa-78f5b60dba9&title=&width=768" srcset="/img/loading.gif" lazyload alt="image.png"><br>这里如果发生了错误，会执行@ExceptionHandler修饰的方法，这里是将handleException中的方法的返回值写到返回体中，然后返回该浏览器。<br>2.<img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691307230435-8c06a2a5-20ea-423f-b5e3-cc14688b812f.png#averageHue=%23f7f4e0&clientId=u8fdb1034-8532-4&from=paste&height=66&id=ubf31b11b&originHeight=83&originWidth=571&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=36513&status=done&style=none&taskId=ua92b8fb3-30aa-4271-908a-08bf7d846ed&title=&width=456.8" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<ul>
<li><p>发生错误以后，转发给&#x2F;error路径，SpringBoot在底层写好一个 BasicErrorController的组件，专门处理这个请求</p>
<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-meta">@RequestMapping</span>(produces = <span class="hljs-title class_">MediaType</span>.<span class="hljs-property">TEXT_HTML_VALUE</span>) <span class="hljs-comment">//返回HTML</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">ModelAndView</span> <span class="hljs-title function_">errorHtml</span>(<span class="hljs-params">HttpServletRequest request, HttpServletResponse response</span>) &#123;
	<span class="hljs-title class_">HttpStatus</span> status = <span class="hljs-title function_">getStatus</span>(request);
	<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; model = <span class="hljs-title class_">Collections</span>
		.<span class="hljs-title function_">unmodifiableMap</span>(<span class="hljs-title function_">getErrorAttributes</span>(request, <span class="hljs-title function_">getErrorAttributeOptions</span>(request, <span class="hljs-title class_">MediaType</span>.<span class="hljs-property">TEXT_HTML</span>)));
	response.<span class="hljs-title function_">setStatus</span>(status.<span class="hljs-title function_">value</span>());
	<span class="hljs-title class_">ModelAndView</span> modelAndView = <span class="hljs-title function_">resolveErrorView</span>(request, response, status, model);
	<span class="hljs-keyword">return</span> (modelAndView != <span class="hljs-literal">null</span>) ? modelAndView : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>(<span class="hljs-string">&quot;error&quot;</span>, model);
&#125;

<span class="hljs-meta">@RequestMapping</span>  <span class="hljs-comment">//返回 ResponseEntity, JSON</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; <span class="hljs-title function_">error</span>(<span class="hljs-params">HttpServletRequest request</span>) &#123;
	<span class="hljs-title class_">HttpStatus</span> status = <span class="hljs-title function_">getStatus</span>(request);
	<span class="hljs-keyword">if</span> (status == <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">NO_CONTENT</span>) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>&lt;&gt;(status);
	&#125;
	<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; body = <span class="hljs-title function_">getErrorAttributes</span>(request, <span class="hljs-title function_">getErrorAttributeOptions</span>(request, <span class="hljs-title class_">MediaType</span>.<span class="hljs-property">ALL</span>));
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>&lt;&gt;(body, status);
&#125;</code></pre></div>
</li>
<li><p>错误页面是这么解析到的</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//1、解析错误的自定义视图地址	</span>
<span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> resolveErrorView(request, response, status, model);
<span class="hljs-comment">//2、如果解析不到错误页面的地址，默认的错误页就是 error</span>
<span class="hljs-keyword">return</span> (modelAndView != <span class="hljs-literal">null</span>) ? modelAndView : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>(<span class="hljs-string">&quot;error&quot;</span>, model);</code></pre></div>
<p>容器中专门有一个错误视图解析器 	</p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@Bean</span>
<span class="hljs-variable">@ConditionalOnBean</span>(DispatcherServlet.class)
<span class="hljs-variable">@ConditionalOnMissingBean</span>(ErrorViewResolver.class)
DefaultErrorViewResolver <span class="hljs-built_in">conventionErrorViewResolver</span>() &#123;
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DefaultErrorViewResolver</span>(this.applicationContext, this.resources);
&#125;</code></pre></div>
<p>SpringBoot解析自定义错误页的默认规则</p>
<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">ModelAndView</span> <span class="hljs-title function_">resolveErrorView</span>(<span class="hljs-params">HttpServletRequest request, HttpStatus status, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; model</span>) &#123;
	<span class="hljs-title class_">ModelAndView</span> modelAndView = <span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(status.<span class="hljs-title function_">value</span>()), model);
	<span class="hljs-keyword">if</span> (modelAndView == <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable constant_">SERIES_VIEWS</span>.<span class="hljs-title function_">containsKey</span>(status.<span class="hljs-title function_">series</span>())) &#123;
		modelAndView = <span class="hljs-title function_">resolve</span>(<span class="hljs-variable constant_">SERIES_VIEWS</span>.<span class="hljs-title function_">get</span>(status.<span class="hljs-title function_">series</span>()), model);
	&#125;
	<span class="hljs-keyword">return</span> modelAndView;
&#125;

<span class="hljs-keyword">private</span> <span class="hljs-title class_">ModelAndView</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> viewName, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; model</span>) &#123;
	<span class="hljs-title class_">String</span> errorViewName = <span class="hljs-string">&quot;error/&quot;</span> + viewName;
	<span class="hljs-title class_">TemplateAvailabilityProvider</span> provider = <span class="hljs-variable language_">this</span>.<span class="hljs-property">templateAvailabilityProviders</span>.<span class="hljs-title function_">getProvider</span>(errorViewName,
			<span class="hljs-variable language_">this</span>.<span class="hljs-property">applicationContext</span>);
	<span class="hljs-keyword">if</span> (provider != <span class="hljs-literal">null</span>) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>(errorViewName, model);
	&#125;
	<span class="hljs-keyword">return</span> <span class="hljs-title function_">resolveResource</span>(errorViewName, model);
&#125;

<span class="hljs-keyword">private</span> <span class="hljs-title class_">ModelAndView</span> <span class="hljs-title function_">resolveResource</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> viewName, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; model</span>) &#123;
	<span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> location : <span class="hljs-variable language_">this</span>.<span class="hljs-property">resources</span>.<span class="hljs-title function_">getStaticLocations</span>()) &#123;
		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-title class_">Resource</span> resource = <span class="hljs-variable language_">this</span>.<span class="hljs-property">applicationContext</span>.<span class="hljs-title function_">getResource</span>(location);
			resource = resource.<span class="hljs-title function_">createRelative</span>(viewName + <span class="hljs-string">&quot;.html&quot;</span>);
			<span class="hljs-keyword">if</span> (resource.<span class="hljs-title function_">exists</span>()) &#123;
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlResourceView</span>(resource), model);
			&#125;
		&#125;
		<span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> ex) &#123;
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
&#125;</code></pre></div>
<p>容器中有一个默认的名为 error 的 view； 提供了默认白页功能</p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@Bean</span>(name = <span class="hljs-string">&quot;error&quot;</span>)
<span class="hljs-variable">@ConditionalOnMissingBean</span>(name = <span class="hljs-string">&quot;error&quot;</span>)
public View <span class="hljs-built_in">defaultErrorView</span>() &#123;
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.defaultErrorView</span>;
&#125;</code></pre></div>
<p>封装了JSON格式的错误信息</p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@Bean</span>
<span class="hljs-variable">@ConditionalOnMissingBean</span>(value = ErrorAttributes.class, search = SearchStrategy.CURRENT)
public DefaultErrorAttributes <span class="hljs-built_in">errorAttributes</span>() &#123;
	<span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DefaultErrorAttributes</span>();
&#125;</code></pre></div>
<p>规则：</p>
</li>
</ul>
<ol>
<li><strong>解析一个错误页</strong><ol>
<li>如果发生了500、404、503、403 这些错误<ol>
<li>如果有<strong>模板引擎</strong>，默认在 classpath:&#x2F;templates&#x2F;error&#x2F;<strong>精确码.html</strong></li>
<li>如果没有模板引擎，在静态资源文件夹下找 <strong>精确码.html</strong></li>
</ol>
</li>
<li>如果匹配不到精确码.html这些精确的错误页，就去找5xx.html，4xx.html<strong>模糊匹配</strong><ol>
<li>如果有模板引擎，默认在 classpath:&#x2F;templates&#x2F;error&#x2F;5xx.html</li>
<li>如果没有模板引擎，在静态资源文件夹下找 5xx.html</li>
</ol>
</li>
</ol>
</li>
<li>如果模板引擎路径templates下有 error.html页面，就直接渲染</li>
</ol>
<h2 id="2-自定义错误响应"><a href="#2-自定义错误响应" class="headerlink" title="2. 自定义错误响应"></a>2. 自定义错误响应</h2><h3 id="1-自定义json响应"><a href="#1-自定义json响应" class="headerlink" title="1. 自定义json响应"></a>1. 自定义json响应</h3><p>使用@ControllerAdvice + @ExceptionHandler 进行统一异常处理</p>
<h3 id="2-自定义页面响应"><a href="#2-自定义页面响应" class="headerlink" title="2. 自定义页面响应"></a>2. 自定义页面响应</h3><p>根据boot的错误页面规则，自定义页面模板</p>
<h2 id="3-最佳实战"><a href="#3-最佳实战" class="headerlink" title="3. 最佳实战"></a>3. 最佳实战</h2><ul>
<li><strong>前后分离</strong><ul>
<li>后台发生的所有错误，@ControllerAdvice + @ExceptionHandler进行统一异常处理。</li>
</ul>
</li>
<li><h2 id="服务端页面渲染-不可预知的一些，HTTP码表示的服务器或客户端错误-给classpath-templates-error-下面，放常用精确的错误码页面。500-html，404-html-给classpath-templates-error-下面，放通用模糊匹配的错误码页面。-5xx-html，4xx-html-发生业务错误-核心业务，每一种错误，都应该代码控制，跳转到自己定制的错误页。-通用业务，classpath-templates-error-html页面，显示错误信息（可以通过在错误页面中添加-trance-来显示错误堆栈信息）。"><a href="#服务端页面渲染-不可预知的一些，HTTP码表示的服务器或客户端错误-给classpath-templates-error-下面，放常用精确的错误码页面。500-html，404-html-给classpath-templates-error-下面，放通用模糊匹配的错误码页面。-5xx-html，4xx-html-发生业务错误-核心业务，每一种错误，都应该代码控制，跳转到自己定制的错误页。-通用业务，classpath-templates-error-html页面，显示错误信息（可以通过在错误页面中添加-trance-来显示错误堆栈信息）。" class="headerlink" title="服务端页面渲染 - 不可预知的一些，HTTP码表示的服务器或客户端错误    - 给classpath:&#x2F;templates&#x2F;error&#x2F;下面，放常用精确的错误码页面。500.html，404.html    - 给classpath:&#x2F;templates&#x2F;error&#x2F;下面，放通用模糊匹配的错误码页面。 5xx.html，4xx.html - 发生业务错误    - 核心业务，每一种错误，都应该代码控制，跳转到自己定制的错误页。    - 通用业务，classpath:&#x2F;templates&#x2F;error.html页面，显示错误信息（可以通过在错误页面中添加[[${trance}]]来显示错误堆栈信息）。"></a><strong>服务端页面渲染</strong><br> - <strong>不可预知的一些，HTTP码表示的服务器或客户端错误</strong><br>    - 给classpath:&#x2F;templates&#x2F;error&#x2F;下面，放常用精确的错误码页面。500.html，404.html<br>    - 给classpath:&#x2F;templates&#x2F;error&#x2F;下面，放通用模糊匹配的错误码页面。 5xx.html，4xx.html<br> - <strong>发生业务错误</strong><br>    - <strong>核心业务</strong>，每一种错误，都应该代码控制，<strong>跳转到自己定制的错误页</strong>。<br>    - <strong>通用业务</strong>，classpath:&#x2F;templates&#x2F;error.html页面，<strong>显示错误信息（可以通过在错误页面中添加[[${trance}]]来显示错误堆栈信息）</strong>。</h2></li>
</ul>
<p>页面，JSON，可用的Model数据如下<br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681724501227-077073b7-349d-414f-8916-a822eb86c772.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_26,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f5f4f3&from=url&id=PNxJP&originHeight=196&originWidth=919&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p>
<h1 id="8-嵌入式容器"><a href="#8-嵌入式容器" class="headerlink" title="8. 嵌入式容器"></a>8. 嵌入式容器</h1><p><strong>Servlet容器</strong>：管理、运行<strong>Servlet组件</strong>（Servlet、Filter、Listener）的环境，一般指<strong>服务器</strong></p>
<h2 id="1-自动配置原理"><a href="#1-自动配置原理" class="headerlink" title="1. 自动配置原理"></a>1. 自动配置原理</h2><ul>
<li>SpringBoot 默认嵌入Tomcat作为Servlet容器。</li>
<li><strong>自动配置类</strong>是ServletWebServerFactoryAutoConfiguration，EmbeddedWebServerFactoryCustomizerAutoConfiguration</li>
<li>自动配置类开始分析功能。<code>xxxxAutoConfiguration</code><div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@AutoConfiguration</span>
<span class="hljs-variable">@AutoConfigureOrder</span>(Ordered.HIGHEST_PRECEDENCE)
<span class="hljs-variable">@ConditionalOnClass</span>(ServletRequest.class)<span class="hljs-comment">//@ConditionOn表示满足这些条件才将该类加载到容器中</span>
<span class="hljs-variable">@ConditionalOnWebApplication</span>(type = Type.SERVLET)
<span class="hljs-variable">@EnableConfigurationProperties</span>(ServerProperties.class)
<span class="hljs-variable">@Import</span>(&#123; ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,
		ServletWebServerFactoryConfiguration.EmbeddedTomcat.class,
		ServletWebServerFactoryConfiguration.EmbeddedJetty.class,
		ServletWebServerFactoryConfiguration.EmbeddedUndertow.class &#125;)
public class ServletWebServerFactoryAutoConfiguration &#123;
    
&#125;</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@AutoConfiguration</span>：该注解表示这是一个自动配置类，用于自动配置应用程序的某些功能或组件。

<span class="hljs-variable">@AutoConfigureOrder</span>(Ordered.HIGHEST_PRECEDENCE)：该注解指定了自动配置类的优先级，
使用 Ordered.HIGHEST_PRECEDENCE 表示具有最高优先级。优先级较高的自动配置类将在启动过程中优先
加载和应用。

<span class="hljs-variable">@ConditionalOnClass</span>(ServletRequest.class)：该注解表示只有当类路径上存在 ServletRequest 类时
，才会加载和应用该自动配置类。也就是说，只有当 Servlet 相关的类存在时，该自动配置类才会生效。

<span class="hljs-variable">@ConditionalOnWebApplication</span>(type = Type.SERVLET)：该注解表示只有当应用程序类型为 Servlet
Web 应用时，才会加载和应用该自动配置类。这意味着该自动配置类仅适用于基于 Servlet 的 Web 
应用程序，而不适用于其他类型的应用程序。web程序除了servlet外还有其他的，比如：响应式，JSP等。
关于 Servlet 的特点，以下是一些主要的特点：
平台无关性：Servlet 是基于 Java 技术的，可以在任何支持 Java 的平台上运行，无论是 Windows、
Linux 还是其他操作系统。
可移植性：Servlet 可以在不同的 Web 容器中运行，例如 Tomcat、Jetty、WebLogic 等。
这使得开发人员可以在不同的容器中部署和运行 Servlet，而不需要修改代码。

<span class="hljs-variable">@EnableConfigurationProperties</span>(ServerProperties.class)：用于启用配置属性的绑定并将其注入到
Spring 容器中。
在这种情况下，ServerProperties 类的配置属性将被绑定到该自动配置类中。
其中ServerProperties 类被<span class="hljs-variable">@ConfigurationProperties</span>(
    prefix = <span class="hljs-string">&quot;server&quot;</span>,
    ignoreUnknownFields = true
)修饰，<span class="hljs-variable">@ConfigurationProperties</span> 是一个注解，用于将配置属性绑定到一个类上。在上述代码中，
它被应用在类级别上，表示将配置属性绑定到带有 prefix 前缀的属性上，并且忽略未知的字段。
但是其ServerProperties 类在此时并未注入到容器中。

<span class="hljs-variable">@Import</span>(&#123; ... &#125;)：该注解用于导入其他的配置类或组件。在这个例子中，它导入了与 Servlet Web
服务器工厂相关的配置类，包括 Tomcat、Jetty 和 Undertow 的配置。
</code></pre></div></li>
</ul>
<ol>
<li>ServletWebServerFactoryAutoConfiguration 自动配置了嵌入式容器场景</li>
<li>绑定了ServerProperties配置类，所有和服务器有关的配置 server（也就是配置文件·中以server开头的配置属性是关于服务器的）</li>
<li>ServletWebServerFactoryAutoConfiguration 导入了 嵌入式的三大服务器 Tomcat、Jetty、Undertow</li>
</ol>
<p>1.servlet不仅支持Tomcat服务器还支持Jetty ，Netty，Undertow服务器<br>2.</p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@ConditionalOnClass</span>(&#123;Servlet.class, Tomcat.class, UpgradeProtocol.class&#125;)
    <span class="hljs-variable">@ConditionalOnMissingBean</span>(
        value = &#123;ServletWebServerFactory.class&#125;,
        search = SearchStrategy.CURRENT
    )
    static class EmbeddedTomcat &#123;
        <span class="hljs-selector-tag">EmbeddedTomcat</span>() &#123;
        &#125;
<span class="hljs-variable">@ConditionalOnClass</span>(&#123;Servlet.class, Tomcat.class, UpgradeProtocol.class&#125;)决定了web程序的服务器
类型，而避免了其他类型的服务器。</code></pre></div>

<ol>
<li><p>导入 Tomcat、Jetty、Undertow 都有条件注解。系统中有这个类才行（也就是导了包）也是这种方式决定了web程序采用的服务器类型。</p>
</li>
<li><p>默认 Tomcat配置生效。给容器中放 TomcatServletWebServerFactory</p>
</li>
<li><p>都给容器中 ServletWebServerFactory放了一个** web服务器工厂（造web服务器的）可以在ServletWebServerFactoryAutoConfiguration类中查看到注入了不同的 ServletWebServerFactory**</p>
<div class="code-wrapper"><pre><code class="hljs aspectj"><span class="hljs-meta">@Bean</span>
       TomcatServletWebServerFactory tomcatServletWebServerFactory</code></pre></div>
</li>
<li><p><strong>web服务器工厂 都有一个功能，</strong>getWebServer获取web服务器。其中TomcatServletWebServerFactory 创建了tomcat而其他服务器工厂没有创建。</p>
</li>
<li><p>TomcatServletWebServerFactory 创建了 tomcat。</p>
</li>
<li><p>ServletWebServerFactory 什么时候会创建 webServer出来。</p>
</li>
<li><p>ServletWebServerApplicationContextioc容器，启动的时候会调用创建web服务器</p>
</li>
<li><p>Spring<strong>容器刷新（启动）</strong>的时候，会预留一个时机，刷新子容器。onRefresh()</p>
</li>
<li><p>refresh() 容器刷新 十二大步的刷新子容器会调用 onRefresh()；</p>
<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onRefresh</span>(<span class="hljs-params"></span>) &#123;
	<span class="hljs-variable language_">super</span>.<span class="hljs-title function_">onRefresh</span>();
	<span class="hljs-keyword">try</span> &#123;
		<span class="hljs-title function_">createWebServer</span>();
	&#125;
	<span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Throwable</span> ex) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationContextException</span>(<span class="hljs-string">&quot;Unable to start web server&quot;</span>, ex);
	&#125;
&#125;</code></pre></div>
<p>Web场景的Spring容器启动，在onRefresh的时候，会调用创建web服务器的方法。<br>Web服务器的创建是通过WebServerFactory搞定的。容器中又会根据导了什么包条件注解，启动相关的 服务器配置，默认EmbeddedTomcat会给容器中放一个 TomcatServletWebServerFactory，导致项目启动，自动创建出Tomcat。<br>用法：<br>1.修改server下的相关配置就可以修改服务器的参数<br>2.通过给容器中放一个ServletWebServerFactory,来禁用掉springBoot默认配置的服务器工厂，实现自定义的嵌入式服务器。</p>
</li>
</ol>
<h2 id="2-自定义"><a href="#2-自定义" class="headerlink" title="2. 自定义"></a>2. 自定义</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681725850466-2ecf12f4-8b66-469f-9d5d-377a33923b3c.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_19,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23ceae84&from=url&id=W0Ot4&originHeight=268&originWidth=668&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-api.version</span>&gt;</span>3.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-api.version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Exclude the Tomcat dependency --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- Use Jetty instead --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<h2 id="3-最佳实践"><a href="#3-最佳实践" class="headerlink" title="3. 最佳实践"></a>3. 最佳实践</h2><p><strong>用法：</strong></p>
<ul>
<li>修改server下的相关配置就可以修改<strong>服务器参数</strong></li>
<li>通过给容器中放一个<strong>ServletWebServerFactory</strong>，来禁用掉SpringBoot默认放的服务器工厂，实现自定义嵌入<strong>任意服务器</strong>。</li>
</ul>
<h1 id="9-全面接管SpringMVC"><a href="#9-全面接管SpringMVC" class="headerlink" title="9. 全面接管SpringMVC"></a>9. 全面接管SpringMVC</h1><ul>
<li>SpringBoot 默认配置好了 SpringMVC 的所有常用特性。</li>
<li>如果我们需要全面接管SpringMVC的所有配置并<strong>禁用默认配置</strong>，仅需要编写一个WebMvcConfigurer配置类，并标注 @EnableWebMvc 即可</li>
<li>全手动模式<ul>
<li>@EnableWebMvc : 禁用默认配置，该注解在@Configuration上</li>
<li><strong>WebMvcConfigurer</strong>组件：定义MVC的底层行为</li>
</ul>
</li>
</ul>
<h2 id="1-WebMvcAutoConfiguration-到底自动配置了哪些规则"><a href="#1-WebMvcAutoConfiguration-到底自动配置了哪些规则" class="headerlink" title="1. WebMvcAutoConfiguration 到底自动配置了哪些规则"></a>1. WebMvcAutoConfiguration 到底自动配置了哪些规则</h2><p>SpringMVC自动配置场景给我们配置了如下所有<strong>默认行为</strong></p>
<ol>
<li>WebMvcAutoConfigurationweb场景的自动配置类<ol>
<li>支持RESTful的filter：HiddenHttpMethodFilter(HiddenHttpMethodFilter 的作用就是检查通过 POST 请求提交的表单数据中是否包含名为 _method 的隐藏字段，并将其值作为实际的 HTTP 方法进行处理。也就是新增了delete,和patch)</li>
<li>支持非POST请求，请求体携带数据：FormContentFilter(FormContentFilter 的作用是解析请求体中的表单数据，并将其转换为相应的请求参数，以便后续的处理器（Handler）能够方便地获取和使用这些参数。)</li>
<li>导入<strong>EnableWebMvcConfiguration</strong>：<ol>
<li>RequestMappingHandlerAdapter</li>
<li>WelcomePageHandlerMapping： <strong>欢迎页功能</strong>支持（模板引擎目录、静态资源目录放index.html），项目访问&#x2F; 就默认展示这个页面.</li>
<li>RequestMappingHandlerMapping：找每个请求由谁处理的映射关系</li>
<li>ExceptionHandlerExceptionResolver：默认的异常解析器 </li>
<li>LocaleResolver：国际化解析器</li>
<li>ThemeResolver：主题解析器</li>
<li>FlashMapManager：临时数据共享</li>
<li>FormattingConversionService： 数据格式化 、类型转化</li>
<li>Validator： 数据校验JSR303提供的数据校验功能</li>
<li>WebBindingInitializer：请求参数的封装与绑定</li>
<li>ContentNegotiationManager：内容协商管理器</li>
</ol>
</li>
<li><strong>WebMvcAutoConfigurationAdapter</strong>配置生效，它是一个WebMvcConfigurer，定义mvc底层组件<ol>
<li>定义好 WebMvcConfigurer<strong>底层组件默认功能；所有功能详见列表</strong></li>
<li>视图解析器：InternalResourceViewResolver</li>
<li>视图解析器：BeanNameViewResolver,<strong>视图名（controller方法的返回值字符串）</strong>就是组件名</li>
<li>内容协商解析器：ContentNegotiatingViewResolver</li>
<li>请求上下文过滤器：RequestContextFilter: 任意位置直接获取当前请求</li>
<li>静态资源链规则</li>
<li>ProblemDetailsExceptionHandler：错误详情<ol>
<li>SpringMVC内部场景异常被它捕获：</li>
</ol>
</li>
</ol>
</li>
<li>定义了MVC默认的底层行为: WebMvcConfigurer</li>
</ol>
</li>
</ol>
<h2 id="2-EnableWebMvc-禁用默认行为"><a href="#2-EnableWebMvc-禁用默认行为" class="headerlink" title="2. @EnableWebMvc 禁用默认行为"></a>2. @EnableWebMvc 禁用默认行为</h2><ol>
<li>@EnableWebMvc给容器中导入 DelegatingWebMvcConfiguration组件，</li>
</ol>
<p>他是 WebMvcConfigurationSupport</p>
<ol>
<li>WebMvcAutoConfiguration有一个核心的条件注解, @ConditionalOnMissingBean(WebMvcConfigurationSupport.class)，容器中没有WebMvcConfigurationSupport，WebMvcAutoConfiguration才生效.</li>
<li>@EnableWebMvc 导入 WebMvcConfigurationSupport 导致 WebMvcAutoConfiguration 失效。导致禁用了默认行为</li>
</ol>
<ul>
<li>@EnableWebMVC 禁用了 Mvc的自动配置</li>
<li>WebMvcConfigurer 定义SpringMVC底层组件的功能类</li>
</ul>
<p>	</p>
<h2 id="2-WebMvcConfigurer-功能"><a href="#2-WebMvcConfigurer-功能" class="headerlink" title="2. WebMvcConfigurer 功能"></a>2. WebMvcConfigurer 功能</h2><p>定义扩展SpringMVC底层功能</p>
<table>
<thead>
<tr>
<th>提供方法</th>
<th>核心参数</th>
<th>功能</th>
<th>默认</th>
</tr>
</thead>
<tbody><tr>
<td>addFormatters</td>
<td>FormatterRegistry</td>
<td><strong>格式化器</strong>：支持属性上@NumberFormat和@DatetimeFormat的数据类型转换</td>
<td>GenericConversionService</td>
</tr>
<tr>
<td>getValidator</td>
<td>无</td>
<td><strong>数据校验</strong>：校验 Controller 上使用@Valid标注的参数合法性。需要导入starter-validator</td>
<td>无</td>
</tr>
<tr>
<td>addInterceptors</td>
<td>InterceptorRegistry</td>
<td><strong>拦截器</strong>：拦截收到的所有请求</td>
<td>无</td>
</tr>
<tr>
<td>configureContentNegotiation</td>
<td>ContentNegotiationConfigurer</td>
<td><strong>内容协商</strong>：支持多种数据格式返回。需要配合支持这种类型的HttpMessageConverter</td>
<td>支持 json</td>
</tr>
<tr>
<td>configureMessageConverters</td>
<td>List&lt;HttpMessageConverter&lt;?&gt;&gt;</td>
<td><strong>消息转换器</strong>：标注@ResponseBody的返回值会利用MessageConverter直接写出去</td>
<td>8 个，支持byte，string,multipart,resource，json</td>
</tr>
<tr>
<td>addViewControllers</td>
<td>ViewControllerRegistry</td>
<td><strong>视图映射</strong>：直接将请求路径与物理视图映射。用于无 java 业务逻辑的直接视图页渲染</td>
<td>无</td>
</tr>
<tr>
<td><a href="mvc:view-controller">mvc:view-controller</a></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>configureViewResolvers</td>
<td>ViewResolverRegistry</td>
<td><strong>视图解析器</strong>：逻辑视图转为物理视图</td>
<td>ViewResolverComposite</td>
</tr>
<tr>
<td>addResourceHandlers</td>
<td>ResourceHandlerRegistry</td>
<td><strong>静态资源处理</strong>：静态资源路径映射、缓存控制</td>
<td>ResourceHandlerRegistry</td>
</tr>
<tr>
<td>configureDefaultServletHandling</td>
<td>DefaultServletHandlerConfigurer</td>
<td><strong>默认 Servlet</strong>：可以覆盖 Tomcat 的DefaultServlet。让DispatcherServlet拦截&#x2F;</td>
<td>无</td>
</tr>
<tr>
<td>configurePathMatch</td>
<td>PathMatchConfigurer</td>
<td><strong>路径匹配</strong>：自定义 URL 路径匹配。可以自动为所有路径加上指定前缀，比如 &#x2F;api</td>
<td>无</td>
</tr>
<tr>
<td>configureAsyncSupport</td>
<td>AsyncSupportConfigurer</td>
<td><strong>异步支持</strong>：</td>
<td>TaskExecutionAutoConfiguration</td>
</tr>
<tr>
<td>addCorsMappings</td>
<td>CorsRegistry</td>
<td><strong>跨域</strong>：</td>
<td>无</td>
</tr>
<tr>
<td>addArgumentResolvers</td>
<td>List<HandlerMethodArgumentResolver></td>
<td><strong>参数解析器</strong>：</td>
<td>mvc 默认提供</td>
</tr>
<tr>
<td>addReturnValueHandlers</td>
<td>List<HandlerMethodReturnValueHandler></td>
<td><strong>返回值解析器</strong>：</td>
<td>mvc 默认提供</td>
</tr>
<tr>
<td>configureHandlerExceptionResolvers</td>
<td>List<HandlerExceptionResolver></td>
<td><strong>异常处理器</strong>：</td>
<td>默认 3 个</td>
</tr>
<tr>
<td>ExceptionHandlerExceptionResolver</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ResponseStatusExceptionResolver</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DefaultHandlerExceptionResolver</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>getMessageCodesResolver</td>
<td>无</td>
<td><strong>消息码解析器</strong>：国际化使用</td>
<td>无</td>
</tr>
</tbody></table>
<h1 id="10-最佳实践"><a href="#10-最佳实践" class="headerlink" title="10. 最佳实践"></a>10. 最佳实践</h1><p>SpringBoot 已经默认配置好了<strong>Web开发</strong>场景常用功能。我们直接使用即可。</p>
<h2 id="三种方式"><a href="#三种方式" class="headerlink" title="三种方式"></a>三种方式</h2><table>
<thead>
<tr>
<th>方式</th>
<th>用法</th>
<th></th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td><strong>全自动</strong></td>
<td>直接编写控制器逻辑</td>
<td></td>
<td>全部使用<strong>自动配置默认效果</strong></td>
</tr>
<tr>
<td><strong>手自一体</strong></td>
<td>@Configuration +</td>
<td></td>
<td></td>
</tr>
<tr>
<td>配置<strong>WebMvcConfigurer</strong>+</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>配置 WebMvcRegistrations</em></td>
<td><strong>不要标注</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>@<strong>EnableWebMvc</strong></td>
<td><strong>保留自动配置效果</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>手动设置部分功能</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>定义MVC底层组件</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>全手动</strong></td>
<td>@Configuration +</td>
<td></td>
<td></td>
</tr>
<tr>
<td>配置<strong>WebMvcConfigurer</strong></td>
<td><strong>标注</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>@<strong>EnableWebMvc</strong></td>
<td><strong>禁用自动配置效果</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>全手动设置</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>总结：<br><strong>给容器中写一个配置类@Configuration实现 WebMvcConfigurer但是不要标注 @EnableWebMvc注解，实现手自一体的效果。</strong></p>
<h1 id="11-Web新特性"><a href="#11-Web新特性" class="headerlink" title="11. Web新特性"></a>11. Web新特性</h1><h2 id="1-Problemdetails"><a href="#1-Problemdetails" class="headerlink" title="1. Problemdetails"></a>1. Problemdetails</h2><p>RFC 7807: <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7807">https://www.rfc-editor.org/rfc/rfc7807</a></p>
<div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">ProblemDetails</span> 是一种在Web API中表示错误和异常信息的规范化格式。它是根据RFC <span class="hljs-number">7807</span>规范定义的，
旨在提供一种统一的方式来描述和传递错误信息。</code></pre></div>
<p><strong>错误信息</strong>返回新格式<br>原理：</p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span>(proxyBeanMethods = false)
<span class="hljs-comment">//配置过一个属性 spring.mvc.problemdetails.enabled=true才能让</span>
<span class="hljs-comment">//ProblemDetailsErrorHandlingConfiguration生效，其中spring.mvc.problemdetails.enabled</span>
<span class="hljs-comment">//默认是false的，也就是ProbleDetailsErroHandlingConfiguration默认是关闭的</span>
<span class="hljs-variable">@ConditionalOnProperty</span>(prefix = <span class="hljs-string">&quot;spring.mvc.problemdetails&quot;</span>, name = <span class="hljs-string">&quot;enabled&quot;</span>, havingValue = <span class="hljs-string">&quot;true&quot;</span>)
static class ProblemDetailsErrorHandlingConfiguration &#123;

    <span class="hljs-variable">@Bean</span>
    <span class="hljs-variable">@ConditionalOnMissingBean</span>(ResponseEntityExceptionHandler.class)
    ProblemDetailsExceptionHandler <span class="hljs-built_in">problemDetailsExceptionHandler</span>() &#123;
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ProblemDetailsExceptionHandler</span>();
    &#125;

&#125;</code></pre></div>

<ol>
<li><strong>ProblemDetailsExceptionHandler (被 @ControllerAdvice修饰的类）是一个 @ControllerAdvice集中处理系统异常,</strong></li>
<li><strong>ProblemDetailsExceptionHandler 继承</strong>ResponseEntityExceptionHandler ，而ResponseEntityExceptionHandler类有一个@ExceptionHandle注解用于修饰ResponseEntity<Object>类，其中@ExceptionHandle**处理以下异常。如果系统出现以下异常，会被SpringBoot支持以 **RFC 7807规范方式返回错误数据（但是该规范不是默认生效的）：</li>
</ol>
<p>使用@ExceptionHandler 注解时，您需要在方法中定义异常类型作为参数，并在方法体中编写相应的逻辑来处理该异常。当发生定义的异常时，Spring Boot将调用带有 @ExceptionHandler 注解的方法，并将异常传递给该方法进行处理。您可以在该方法中执行适当的操作，例如记录日志、返回自定义错误响应等。</p>
<div class="code-wrapper"><pre><code class="hljs stylus">@<span class="hljs-built_in">ExceptionHandler</span>(&#123;
		HttpRequestMethodNotSupportedException<span class="hljs-selector-class">.class</span>, <span class="hljs-comment">//请求方式不支持</span>
		HttpMediaTypeNotSupportedException<span class="hljs-selector-class">.class</span>,
		HttpMediaTypeNotAcceptableException<span class="hljs-selector-class">.class</span>,
		MissingPathVariableException<span class="hljs-selector-class">.class</span>,
		MissingServletRequestParameterException<span class="hljs-selector-class">.class</span>,
		MissingServletRequestPartException<span class="hljs-selector-class">.class</span>,
		ServletRequestBindingException<span class="hljs-selector-class">.class</span>,
		MethodArgumentNotValidException<span class="hljs-selector-class">.class</span>,
		NoHandlerFoundException<span class="hljs-selector-class">.class</span>,
		AsyncRequestTimeoutException<span class="hljs-selector-class">.class</span>,
		ErrorResponseException<span class="hljs-selector-class">.class</span>,
		ConversionNotSupportedException<span class="hljs-selector-class">.class</span>,
		TypeMismatchException<span class="hljs-selector-class">.class</span>,
		HttpMessageNotReadableException<span class="hljs-selector-class">.class</span>,
		HttpMessageNotWritableException<span class="hljs-selector-class">.class</span>,
		BindException<span class="hljs-selector-class">.class</span>
	&#125;)</code></pre></div>
<p>效果：也就是上面的ResponseEntity<Object>类处理异常的效果<br>默认响应错误的json。状态码 405</p>
<div class="code-wrapper"><pre><code class="hljs swift">&#123;
    <span class="hljs-string">&quot;timestamp&quot;</span>: <span class="hljs-string">&quot;2023-04-18T11:13:05.515+00:00&quot;</span>,
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-number">405</span>,
    <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Method Not Allowed&quot;</span>,
    <span class="hljs-string">&quot;trace&quot;</span>: <span class="hljs-string">&quot;org.springframework.web.HttpRequestMethodNotSupportedException: Request method &#x27;POST&#x27; is not supported<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.handleNoMatch(RequestMappingInfoHandlerMapping.java:265)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.lookupHandlerMethod(AbstractHandlerMethodMapping.java:441)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.getHandlerInternal(AbstractHandlerMethodMapping.java:382)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:126)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:68)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.handler.AbstractHandlerMapping.getHandler(AbstractHandlerMapping.java:505)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.DispatcherServlet.getHandler(DispatcherServlet.java:1275)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1057)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:974)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1011)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:563)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:631)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:166)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:493)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:341)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:390)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:894)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\t</span>at java.base/java.lang.Thread.run(Thread.java:833)<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>,
    <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Method &#x27;POST&#x27; is not supported.&quot;</span>,
    <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;/list&quot;</span>
&#125;</code></pre></div>
<p>开启ProblemDetails返回, 使用新的MediaType<br><strong>Content-Type: application&#x2F;problem+json+ 额外扩展返回</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681816524680-e75cbe89-f90c-4ac4-8247-ec850308df65.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_29,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23fafaf9&from=url&id=xnTyF&originHeight=40&originWidth=1030&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload>**</p>
<div class="code-wrapper"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;about:blank&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Method Not Allowed&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">405</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Method &#x27;POST&#x27; is not supported.&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;instance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/list&quot;</span>
<span class="hljs-punctuation">&#125;</span></code></pre></div>
<h2 id="2-函数式Web"><a href="#2-函数式Web" class="headerlink" title="2. 函数式Web"></a><strong>2. 函数式Web</strong></h2><p><strong>SpringMVC 5.2 以后 允许我们使用函数式的方式，定义Web的请求处理流程。</strong><br><strong>函数式接口</strong><br><strong>Web请求处理的方式：</strong></p>
<ol>
<li><strong>@Controller + @RequestMapping：耦合式 （路由、业务耦合）</strong></li>
<li><strong>函数式Web：分离式（路由、业务分离）</strong></li>
</ol>
<h3 id="1-场景"><a href="#1-场景" class="headerlink" title="1. 场景"></a>1. 场景</h3><p>场景：User RESTful - CRUD</p>
<ul>
<li>GET &#x2F;user&#x2F;1 获取1号用户</li>
<li>GET &#x2F;users 获取所有用户</li>
<li>POST &#x2F;user ** 请求体**携带JSON，新增一个用户</li>
<li>PUT &#x2F;user&#x2F;1 <strong>请求体</strong>携带JSON，修改1号用户</li>
<li>DELETE &#x2F;user&#x2F;1** 删除**1号用户</li>
</ul>
<h3 id="2-核心类"><a href="#2-核心类" class="headerlink" title="2. 核心类"></a>2. 核心类</h3><ul>
<li><strong>RouterFunction</strong></li>
<li><strong>RequestPredicate</strong></li>
<li><strong>ServerRequest</strong></li>
<li><strong>ServerResponse</strong></li>
</ul>
<h3 id="3-示例"><a href="#3-示例" class="headerlink" title="3. 示例"></a>3. 示例</h3><div class="code-wrapper"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.RequestPredicate;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.RouterFunction;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.ServerResponse;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.RequestPredicates.accept;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.RouterFunctions.route;

<span class="hljs-meta">@Configuration</span>(proxyBeanMethods = <span class="hljs-literal">false</span>)
<span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRoutingConfiguration</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> RequestPredicate ACCEPT_JSON = accept(MediaType.APPLICATION_JSON);

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RouterFunction&lt;ServerResponse&gt; routerFunction(MyUserHandler userHandler) &#123;
        <span class="hljs-keyword">return</span> route()
                .GET(<span class="hljs-string">&quot;/&#123;user&#125;&quot;</span>, ACCEPT_JSON, userHandler:<span class="hljs-type"></span>:getUser)
                .GET(<span class="hljs-string">&quot;/&#123;user&#125;/customers&quot;</span>, ACCEPT_JSON, userHandler:<span class="hljs-type"></span>:getUserCustomers)
                .DELETE(<span class="hljs-string">&quot;/&#123;user&#125;&quot;</span>, ACCEPT_JSON, userHandler:<span class="hljs-type"></span>:deleteUser)
                .build();
    &#125;

&#125;

</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">servlet</span>.<span class="hljs-property">function</span>.<span class="hljs-property">ServerRequest</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">servlet</span>.<span class="hljs-property">function</span>.<span class="hljs-property">ServerResponse</span>;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyUserHandler</span> &#123;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ServerResponse</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params">ServerRequest request</span>) &#123;
        ...
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ServerResponse</span>.<span class="hljs-title function_">ok</span>().<span class="hljs-title function_">build</span>();
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ServerResponse</span> <span class="hljs-title function_">getUserCustomers</span>(<span class="hljs-params">ServerRequest request</span>) &#123;
        ...
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ServerResponse</span>.<span class="hljs-title function_">ok</span>().<span class="hljs-title function_">build</span>();
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ServerResponse</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">ServerRequest request</span>) &#123;
        ...
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ServerResponse</span>.<span class="hljs-title function_">ok</span>().<span class="hljs-title function_">build</span>();
    &#125;

&#125;</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs pgsql">package com.atguigu.web.config;

<span class="hljs-keyword">import</span> com.atguigu.web.bean.Person;
<span class="hljs-keyword">import</span> com.atguigu.web.biz.UserBizHandler;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.<span class="hljs-keyword">Configuration</span>;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.RequestPredicates;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.RouterFunction;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.RouterFunctions;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.<span class="hljs-keyword">function</span>.ServerResponse;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * @author lfy</span>
<span class="hljs-comment"> * @Description</span>
<span class="hljs-comment"> * @create 2023-04-18 21:46</span>
<span class="hljs-comment"> */</span>

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 场景：User RESTful - CRUD</span>
<span class="hljs-comment"> * ● GET /user/1  获取1号用户</span>
<span class="hljs-comment"> * ● GET /users   获取所有用户</span>
<span class="hljs-comment"> * ● POST /user  请求体携带JSON，新增一个用户</span>
<span class="hljs-comment"> * ● PUT /user/1 请求体携带JSON，修改1号用户</span>
<span class="hljs-comment"> * ● DELETE /user/1 删除1号用户</span>
<span class="hljs-comment"> */</span>
@<span class="hljs-keyword">Configuration</span>
<span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> WebFunctionConfig &#123;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 函数式Web：</span>
<span class="hljs-comment">     * 1、给容器中放一个Bean：类型是 RouterFunction&lt;ServerResponse&gt;，集中所有路由信息</span>
<span class="hljs-comment">     * 2、每个业务准备一个自己的Handler</span>
<span class="hljs-comment">     *</span>
<span class="hljs-comment">     *</span>
<span class="hljs-comment">     * 核心四大对象</span>
<span class="hljs-comment">     * 1、RouterFunction： 定义路由信息。发什么请求，谁来处理</span>
<span class="hljs-comment">     * 2、RequestPredicate：定义请求规则：请求谓语。请求方式（GET、POST）、请求参数</span>
<span class="hljs-comment">     * 3、ServerRequest：  封装请求完整数据</span>
<span class="hljs-comment">     * 4、ServerResponse： 封装响应完整数据</span>
<span class="hljs-comment">     */</span>
    @Bean//如果修饰在方法上，那么其方法的参数是从容器中获取的
    <span class="hljs-built_in">public</span> RouterFunction&lt;ServerResponse&gt; userRoute(UserBizHandler userBizHandler<span class="hljs-comment">/*这个会被自动注入进来*/</span>)&#123;

        <span class="hljs-keyword">return</span> RouterFunctions.route() //开始定义路由信息
                .<span class="hljs-keyword">GET</span>(&quot;/user/&#123;id&#125;&quot;, RequestPredicates.accept(MediaType.<span class="hljs-keyword">ALL</span>), userBizHandler::getUser)
                .<span class="hljs-keyword">GET</span>(&quot;/users&quot;, userBizHandler::getUsers)
                .POST(&quot;/user&quot;, RequestPredicates.accept(MediaType.APPLICATION_JSON), userBizHandler::saveUser)
                .PUT(&quot;/user/&#123;id&#125;&quot;, RequestPredicates.accept(MediaType.APPLICATION_JSON), userBizHandler::updateUser)
                .<span class="hljs-keyword">DELETE</span>(&quot;/user/&#123;id&#125;&quot;, userBizHandler::deleteUser)
                .build();
    &#125;


//    @Bean
//    <span class="hljs-built_in">public</span> RouterFunction&lt;ServerResponse&gt; groupRoute(UserBizHandler userBizHandler<span class="hljs-comment">/*这个会被自动注入进来*/</span>)&#123;
//
//        <span class="hljs-keyword">return</span> RouterFunctions.route() //开始定义路由信息
//                .<span class="hljs-keyword">GET</span>(&quot;/user/&#123;id&#125;&quot;, RequestPredicates.accept(MediaType.<span class="hljs-keyword">ALL</span>), userBizHandler::getUser)
//                .<span class="hljs-keyword">GET</span>(&quot;/users&quot;, userBizHandler::getUsers)
//                .POST(&quot;/user&quot;, RequestPredicates.accept(MediaType.APPLICATION_JSON), userBizHandler::saveUser)
//                .PUT(&quot;/user/&#123;id&#125;&quot;, RequestPredicates.accept(MediaType.APPLICATION_JSON), userBizHandler::updateUser)
//                .<span class="hljs-keyword">DELETE</span>(&quot;/user/&#123;id&#125;&quot;, userBizHandler::deleteUser)
//                .build();
//    &#125;
&#125;
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.web.biz;

<span class="hljs-keyword">import</span> com.atguigu.web.bean.Person;
<span class="hljs-keyword">import</span> jakarta.servlet.ServletException;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.function.ServerRequest;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.function.ServerResponse;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> lfy</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> 专门处理User有关的业务</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2023-04-18 21:55</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBizHandler</span> &#123;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 查询指定id的用户</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> ServerResponse <span class="hljs-title function_">getUser</span><span class="hljs-params">(ServerRequest request)</span> <span class="hljs-keyword">throws</span> Exception&#123;
        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> request.pathVariable(<span class="hljs-string">&quot;id&quot;</span>);
        log.info(<span class="hljs-string">&quot;查询 【&#123;&#125;】 用户信息，数据库正在检索&quot;</span>,id);
        <span class="hljs-comment">//业务处理</span>
        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-number">1L</span>,<span class="hljs-string">&quot;哈哈&quot;</span>,<span class="hljs-string">&quot;aa@qq.com&quot;</span>,<span class="hljs-number">18</span>,<span class="hljs-string">&quot;admin&quot;</span>);
        <span class="hljs-comment">//构造响应</span>
        <span class="hljs-keyword">return</span> ServerResponse
                .ok()
                .body(person);
    &#125;


    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 获取所有用户</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> ServerResponse <span class="hljs-title function_">getUsers</span><span class="hljs-params">(ServerRequest request)</span> <span class="hljs-keyword">throws</span> Exception&#123;
        log.info(<span class="hljs-string">&quot;查询所有用户信息完成&quot;</span>);
        <span class="hljs-comment">//业务处理</span>
        List&lt;Person&gt; list = Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">&quot;哈哈&quot;</span>, <span class="hljs-string">&quot;aa@qq.com&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;admin&quot;</span>),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-number">2L</span>, <span class="hljs-string">&quot;哈哈2&quot;</span>, <span class="hljs-string">&quot;aa2@qq.com&quot;</span>, <span class="hljs-number">12</span>, <span class="hljs-string">&quot;admin2&quot;</span>));

        <span class="hljs-comment">//构造响应</span>
        <span class="hljs-keyword">return</span> ServerResponse
                .ok()
                .body(list); <span class="hljs-comment">//凡是body中的对象，就是以前@ResponseBody原理。利用HttpMessageConverter 写出为json</span>
    &#125;


    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 保存用户</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> ServerResponse <span class="hljs-title function_">saveUser</span><span class="hljs-params">(ServerRequest request)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;
        <span class="hljs-comment">//提取请求体</span>
        <span class="hljs-type">Person</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> request.body(Person.class);
        log.info(<span class="hljs-string">&quot;保存用户信息：&#123;&#125;&quot;</span>,body);
        <span class="hljs-keyword">return</span> ServerResponse.ok().build();
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 更新用户</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> ServerResponse <span class="hljs-title function_">updateUser</span><span class="hljs-params">(ServerRequest request)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;
        <span class="hljs-type">Person</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> request.body(Person.class);
        log.info(<span class="hljs-string">&quot;保存用户信息更新: &#123;&#125;&quot;</span>,body);
        <span class="hljs-keyword">return</span> ServerResponse.ok().build();
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 删除用户</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> ServerResponse <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(ServerRequest request)</span> &#123;
        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> request.pathVariable(<span class="hljs-string">&quot;id&quot;</span>);
        log.info(<span class="hljs-string">&quot;删除【&#123;&#125;】用户信息&quot;</span>,id);
        <span class="hljs-keyword">return</span> ServerResponse.ok().build();
    &#125;
&#125;
</code></pre></div>
<h1 id="3、SpringBoot3-数据访问"><a href="#3、SpringBoot3-数据访问" class="headerlink" title="3、SpringBoot3-数据访问"></a><strong>3、SpringBoot3-数据访问</strong></h1><p><strong>整合SSM场景SpringBoot 整合 Spring、SpringMVC、MyBatis 进行数据访问场景开发</strong><br>**创建SSM项目（在创建springboot的时候勾选要导入的包）：</p>
<p>**</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<h2 id="2-配置数据源"><a href="#2-配置数据源" class="headerlink" title="2. 配置数据源"></a>2. 配置数据源</h2><div class="code-wrapper"><pre><code class="hljs stylus">spring<span class="hljs-selector-class">.datasource</span>.url=jdbc:mysql:<span class="hljs-comment">//192.168.200.100:3306/demo</span>
spring<span class="hljs-selector-class">.datasource</span>.driver-class-name=com<span class="hljs-selector-class">.mysql</span><span class="hljs-selector-class">.cj</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.Driver</span>
spring<span class="hljs-selector-class">.datasource</span>.username=root
spring<span class="hljs-selector-class">.datasource</span>.password=<span class="hljs-number">123456</span>
spring<span class="hljs-selector-class">.datasource</span>.type=com<span class="hljs-selector-class">.zaxxer</span><span class="hljs-selector-class">.hikari</span>.HikariDataSource</code></pre></div>
<p>安装MyBatisX 插件，帮我们生成Mapper接口的xml文件即可。MyBatisX的使用：<br>选中接口名-&gt;点击右键-&gt;选择显示上下文操作-&gt;选择MybatisX的功能<br>或者选中接口名Altet+Enter<br>在接口下的方法使用Alter+Enter可以生成相应的sql语句 片段</p>
<h2 id="3-配置MyBatis"><a href="#3-配置MyBatis" class="headerlink" title="3. 配置MyBatis"></a>3. 配置MyBatis</h2><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-comment">#指定mapper映射文件位置</span>
<span class="hljs-attr">mybatis.mapper-locations</span>=classpath:/mapper/*.xml
<span class="hljs-comment">#参数项调整，也就是可以把数据库表中的下划线命名的属性转换为驼峰命名</span>
<span class="hljs-attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="hljs-literal">true</span></code></pre></div>
<h2 id="4-CRUD编写"><a href="#4-CRUD编写" class="headerlink" title="4. CRUD编写"></a><strong>4. CRUD编写</strong></h2><p>CRUD 是一个常用的术语，用于描述对于持久化数据的基本操作。CRUD 是 Create（创建）、Read（读取）、Update（更新）和Delete（删除）的缩写。</p>
<ul>
<li><strong>编写Bean</strong></li>
<li><strong>编写Mapper</strong></li>
<li><strong>使用mybatisx插件，快速生成MapperXML</strong></li>
<li><strong>测试CRUD</strong></li>
</ul>
<p><strong>总结：</strong><br><strong>1.</strong>@Data&#x2F;&#x2F;生成get和set方法<br><strong>2.controller类下的</strong><br>@Autowired&#x2F;&#x2F;下面的提示的来源是因为这个时候，UserMapper中的接口没有注入到容器中，是springboot启动利用@MapperScan才将该接口注入到容器中的<br>UserMapper userMapper**;<strong>3.mapper接口中的</strong><em>每个方法都在Mapper文件中有一个sql标签对应。所有参数都应该用@Param进行签名，以后使用指定的名字在SQL中取值</em><br>4.mapper.xml文件中的<mapper>标签namespace属性也就是全类名接口的全类名和namespace的值是一一对应的<br>5.使用mybatis对数据库进行操作的时候，在spriongboot启动类的前要添加MapperScan(basePackages &#x3D; “com.atguigu.boot3.ssm.mapper”)<br>_1、@MapperScan【批量扫描注解】； 告诉MyBatis，扫描哪个包下面的所有接口</p>
<ul>
<li><em>**</em>@MapperScan _**_是 MyBatis-Spring 框架提供的注解，用于扫描指定包下的 Mapper 接口，并将其注册为 Spring 的 Bean。</li>
<li>这样就可以在controller中使用自动注入</li>
<li>2、在配置文件中使用mybatis.mapper-locations，告诉MyBatis，每个接口的xml文件都在哪里_</li>
</ul>
<h2 id="5-自动配置原理"><a href="#5-自动配置原理" class="headerlink" title="5. 自动配置原理"></a><strong>5. 自动配置原理</strong></h2><p><strong>SSM整合总结：</strong></p>
<ol>
<li><strong>导入 mybatis-spring-boot-starter</strong></li>
<li><strong>配置数据源信息</strong></li>
<li><strong>配置mybatis的mapper接口扫描与xml映射文件扫描</strong></li>
<li><strong>编写bean，mapper，生成xml，编写sql 进行crud。事务等操作依然和Spring中用法一样</strong></li>
<li><strong>效果：</strong><ol>
<li><strong>所有sql写在xml中</strong></li>
<li><strong>所有mybatis配置写在application.properties下面</strong></li>
</ol>
</li>
</ol>
<ul>
<li>jdbc场景的自动配置： <ul>
<li><strong>mybatis-spring-boot-starter导入 spring-boot-starter-jdbc，jdbc是操作数据库的场景</strong></li>
<li><strong>Jdbc场景的几个自动配置()</strong><ul>
<li><strong>org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</strong><ul>
<li><strong>数据源的自动配置</strong></li>
<li><strong>所有和数据源有关的配置都绑定在DataSourceProperties类中</strong></li>
<li><strong>默认使用 HikariDataSource。</strong></li>
</ul>
</li>
<li><strong>org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration</strong><ul>
<li><strong>给容器中放了JdbcTemplate操作数据库</strong></li>
</ul>
</li>
<li><strong>org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration</strong></li>
<li><strong>org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration</strong><ul>
<li><strong>基于XA二阶提交协议的分布式事务数据源</strong></li>
</ul>
</li>
<li><strong>org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration</strong><ul>
<li><strong>支持事务</strong></li>
</ul>
</li>
</ul>
</li>
<li><strong>具有的底层能力：数据源、JdbcTemplate、事务</strong></li>
</ul>
</li>
<li>MyBatisAutoConfiguration：配置了MyBatis的整合流程<ul>
<li>mybatis-spring-boot-starter导入 mybatis-spring-boot-autoconfigure（mybatis的自动配置包），</li>
<li>默认加载两个自动配置类：<ul>
<li>org.mybatis.spring.boot.autoconfigure.MybatisLanguageDriverAutoConfiguration</li>
<li>org.mybatis.spring.boot.autoconfigure.<strong>MybatisAutoConfiguration</strong><ul>
<li><strong>必须在数据源配置好之后才配置</strong></li>
<li>给容器中SqlSessionFactory组件。创建和数据库的一次会话</li>
<li>给容器中SqlSessionTemplate组件。操作数据库</li>
</ul>
</li>
</ul>
</li>
<li><strong>MyBatis的所有配置绑定在</strong>MybatisProperties</li>
<li>每个<strong>Mapper接口</strong>的<strong>代理对象</strong>是怎么创建放到容器中。详见**@MapperScan**原理：<ul>
<li>利用@Import(MapperScannerRegistrar.class)批量给容器中注册组件。解析指定的包路径里面的每一个类，为每一个Mapper接口类，创建Bean定义信息，注册到容器中。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>如何分析哪个场景导入以后，开启了哪些自动配置类。<br>找：classpath:&#x2F;<strong>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</strong>文件中配置的所有值，就是要开启的自动配置类，但是每个类可能有条件注解，基于条件注解判断哪个自动配置类生效了。</p>
<h2 id="6-快速定位生效的配置"><a href="#6-快速定位生效的配置" class="headerlink" title="6. 快速定位生效的配置"></a>6. 快速定位生效的配置</h2><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-comment">#开启调试模式，详细打印开启了哪些自动配置</span>
<span class="hljs-attr">debug</span>=<span class="hljs-literal">true</span>
<span class="hljs-comment"># Positive（生效的自动配置）  Negative（不生效的自动配置）</span></code></pre></div>
<h2 id="7-扩展：整合其他数据源"><a href="#7-扩展：整合其他数据源" class="headerlink" title="7. 扩展：整合其他数据源"></a>7. 扩展：整合其他数据源</h2><h3 id="1-Druid-数据源"><a href="#1-Druid-数据源" class="headerlink" title="1. Druid 数据源"></a>1. Druid 数据源</h3><p>暂不支持 SpringBoot3</p>
<ul>
<li>导入druid-starter</li>
<li>写配置</li>
<li>分析自动配置了哪些东西，怎么用</li>
</ul>
<p>Druid官网：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></p>
<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-comment">#数据源基本配置</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://<span class="hljs-number">192.168</span>.<span class="hljs-number">200.100</span>:<span class="hljs-number">3306</span>/demo
<span class="hljs-attr">spring.datasource.driver-class-name</span>=com.mysql.cj.jdbc.Driver
<span class="hljs-attr">spring.datasource.username</span>=root
<span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-number">123456</span>
<span class="hljs-attr">spring.datasource.type</span>=com.alibaba.druid.pool.DruidDataSource

<span class="hljs-comment"># 配置StatFilter监控</span>
<span class="hljs-attr">spring.datasource.druid.filter.stat.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.datasource.druid.filter.stat.db-type</span>=mysql
<span class="hljs-attr">spring.datasource.druid.filter.stat.log-slow-sql</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.datasource.druid.filter.stat.slow-sql-millis</span>=<span class="hljs-number">2000</span>
<span class="hljs-comment"># 配置WallFilter防火墙</span>
<span class="hljs-attr">spring.datasource.druid.filter.wall.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.datasource.druid.filter.wall.db-type</span>=mysql
<span class="hljs-attr">spring.datasource.druid.filter.wall.config.delete-allow</span>=<span class="hljs-literal">false</span>
<span class="hljs-attr">spring.datasource.druid.filter.wall.config.drop-table-allow</span>=<span class="hljs-literal">false</span>
<span class="hljs-comment"># 配置监控页，内置监控页面的首页是 /druid/index.html</span>
<span class="hljs-attr">spring.datasource.druid.stat-view-servlet.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.datasource.druid.stat-view-servlet.login-username</span>=admin
<span class="hljs-attr">spring.datasource.druid.stat-view-servlet.login-password</span>=admin
<span class="hljs-attr">spring.datasource.druid.stat-view-servlet.allow</span>=*

<span class="hljs-comment"># 其他 Filter 配置不再演示</span>
<span class="hljs-comment"># 目前为以下 Filter 提供了配置支持，请参考文档或者根据IDE提示（spring.datasource.druid.filter.*）进行配置。</span>
<span class="hljs-comment"># StatFilter</span>
<span class="hljs-comment"># WallFilter</span>
<span class="hljs-comment"># ConfigFilter</span>
<span class="hljs-comment"># EncodingConvertFilter</span>
<span class="hljs-comment"># Slf4jLogFilter</span>
<span class="hljs-comment"># Log4jFilter</span>
<span class="hljs-comment"># Log4j2Filter</span>
<span class="hljs-comment"># CommonsLogFilter</span>
</code></pre></div>
<h2 id="附录：示例数据库-要先自己创建test数据库）"><a href="#附录：示例数据库-要先自己创建test数据库）" class="headerlink" title="附录：示例数据库(要先自己创建test数据库）"></a><strong>附录：示例数据库(要先自己创建test数据库）</strong></h2><div class="code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_user`
(
    `id`         <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>)   <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;编号&#x27;</span>,
    `login_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;用户名称&#x27;</span> <span class="hljs-keyword">COLLATE</span> <span class="hljs-string">&#x27;utf8_general_ci&#x27;</span>,
    `nick_name`  <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;用户昵称&#x27;</span> <span class="hljs-keyword">COLLATE</span> <span class="hljs-string">&#x27;utf8_general_ci&#x27;</span>,
    `passwd`     <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;用户密码&#x27;</span> <span class="hljs-keyword">COLLATE</span> <span class="hljs-string">&#x27;utf8_general_ci&#x27;</span>,
    <span class="hljs-keyword">PRIMARY KEY</span> (`id`)
);
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_user(login_name, nick_name, passwd) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;zhangsan&#x27;</span>,<span class="hljs-string">&#x27;张三&#x27;</span>,<span class="hljs-string">&#x27;123456&#x27;</span>);</code></pre></div>
<h1 id="4、SpringBoot3-基础特性"><a href="#4、SpringBoot3-基础特性" class="headerlink" title="4、SpringBoot3-基础特性"></a><strong>4、SpringBoot3-基础特性</strong></h1><ol>
<li>SpringApplication1.1. 自定义 banner类路径添加banner.txt或设置spring.banner.location就可以定制<br>这里是在配置文件中设置spring.banner.location&#x3D;classpath:banner.txt然后在banner.txt文件中填充即可。<br>banner.txt中可以存放Ascll类型的文本，当然图片生成的Ascall类型的也是可以的<br>banner推荐网站：<a target="_blank" rel="noopener" href="https://www.bootschool.net/ascii"><strong>Spring Boot banner 在线生成工具，制作下载英文 banner.txt，修改替换 banner.txt 文字实现自定义，个性化启动 banner-bootschool.net</strong></a><br>**Spring Boot 中有一个名为 “Banner” 的功能，它用于在应用程序启动时显示自定义的启动横幅。横幅是一个包含 ASCII 艺术、应用程序名称和版本号等信息的文本，它可以用于个性化应用程序的启动过程。<br>上面的横幅就是启动成功的这个：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691459425977-b78e1673-8a61-41ae-b1b0-d487510bd937.png#averageHue=%23383532&clientId=u8fdb1034-8532-4&from=paste&height=173&id=u65bf48e5&originHeight=216&originWidth=752&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=13871&status=done&style=none&taskId=u3dae8db9-32d1-451c-8898-afe829c3c40&title=&width=601.6" srcset="/img/loading.gif" lazyload alt="image.png"></li>
</ol>
<h2 id="1-2-自定义-SpringApplication"><a href="#1-2-自定义-SpringApplication" class="headerlink" title="1.2. 自定义 SpringApplication"></a>1.2. 自定义 SpringApplication</h2><div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">Banner</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> &#123;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;
        <span class="hljs-title class_">SpringApplication</span> application = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplication</span>(<span class="hljs-title class_">MyApplication</span>.<span class="hljs-property">class</span>);
        application.<span class="hljs-title function_">setBannerMode</span>(<span class="hljs-title class_">Banner</span>.<span class="hljs-property">Mode</span>.<span class="hljs-property">OFF</span>);
        application.<span class="hljs-title function_">run</span>(args);
    &#125;

&#125;</code></pre></div>
<h2 id="1-3-FluentBuilder-API"><a href="#1-3-FluentBuilder-API" class="headerlink" title="1.3. FluentBuilder API"></a>1.3. FluentBuilder API</h2><div class="code-wrapper"><pre><code class="hljs scss">new <span class="hljs-built_in">SpringApplicationBuilder</span>()
    <span class="hljs-selector-class">.sources</span>(Parent.class)
    <span class="hljs-selector-class">.child</span>(Application.class)
    <span class="hljs-selector-class">.bannerMode</span>(Banner.Mode.OFF)
    <span class="hljs-selector-class">.run</span>(args);</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs php">@SpringBootApplication <span class="hljs-comment">//主程序类</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span>  <span class="hljs-title">Boot306FeaturesApplication</span> </span>&#123;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_ invoke__">main</span>(String[] args) &#123;
        <span class="hljs-comment">//1、SpringApplication: Boot应用的核心API入口</span>
<span class="hljs-comment">//        SpringApplication.run(Boot306FeaturesApplication.class, args);</span>
<span class="hljs-comment">//        args是springboot应用启动的核心参数</span>

        <span class="hljs-comment">//===============1、自定义 SpringApplication 的底层设置，也就是把SpringApplication.run(Boot306FeaturesApplication.class, args);</span>
<span class="hljs-comment">//        分开，生成SpringApplication类,然后根据SpringApplication类来自定义启动的相关设置</span>
<span class="hljs-comment">//        SpringApplication application = new SpringApplication(Boot306FeaturesApplication.class);</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//        //程序化调整【SpringApplication的参数】</span>
<span class="hljs-comment">////        application.setDefaultProperties();</span>
<span class="hljs-comment">//        //这个配置不优先，作用是将banner的打印关闭。如果配置文件有类似的配置，配置文件优先</span>
<span class="hljs-comment">//        application.setBannerMode(Banner.Mode.OFF);</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//        //【配置文件优先级高于程序化调整的优先级】</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//        //2、SpringApplication 运行起来</span>
<span class="hljs-comment">//        application.run(args);</span>


        <span class="hljs-comment">//================2、Builder方式构建 SpringApplication； 通过FluentAPI进行设置</span>
        ConfigurableApplicationContext context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplicationBuilder</span>()
                .<span class="hljs-title function_ invoke__">main</span>(Boot306FeaturesApplication.<span class="hljs-keyword">class</span>) <span class="hljs-comment">//各种参数均可设置</span>
                .<span class="hljs-title function_ invoke__">sources</span>(Boot306FeaturesApplication.<span class="hljs-keyword">class</span>)
                .<span class="hljs-title function_ invoke__">bannerMode</span>(Banner.Mode.CONSOLE)
                .<span class="hljs-title function_ invoke__">properties</span>(<span class="hljs-string">&quot;server.port=8888&quot;</span>,<span class="hljs-string">&quot;aaa=bbb&quot;</span>) <span class="hljs-comment">//springboot所有配置项都可以在这里定义</span>
<span class="hljs-comment">//                .environment(null)</span>
<span class="hljs-comment">//                .listeners(null)</span>
                .<span class="hljs-title function_ invoke__">run</span>(args);



        <span class="hljs-keyword">try</span> &#123;
            Cat cat = context.<span class="hljs-title function_ invoke__">getBean</span>(Cat.<span class="hljs-keyword">class</span>);
            log.<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">&quot;组件cat：&#123;&#125;&quot;</span>,cat);
        &#125;<span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e)&#123;

        &#125;

        <span class="hljs-keyword">try</span> &#123;
            Dog dog = context.<span class="hljs-title function_ invoke__">getBean</span>(Dog.<span class="hljs-keyword">class</span>);
            log.<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">&quot;组件dog：&#123;&#125;&quot;</span>,dog);
        &#125;<span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e)&#123;

        &#125;



        <span class="hljs-keyword">try</span> &#123;
            Pig pig = context.<span class="hljs-title function_ invoke__">getBean</span>(Pig.<span class="hljs-keyword">class</span>);
            log.<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">&quot;组件pig：&#123;&#125;&quot;</span>,pig);
        &#125;<span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e)&#123;

        &#125;

        <span class="hljs-keyword">try</span> &#123;
            Sheep sheep = context.<span class="hljs-title function_ invoke__">getBean</span>(Sheep.<span class="hljs-keyword">class</span>);
            log.<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">&quot;组件sheep：&#123;&#125;&quot;</span>,sheep);
        &#125;<span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e)&#123;

        &#125;



    &#125;

&#125;
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-comment">#指定banner文本的路径</span>
<span class="hljs-attr">spring.banner.location</span>=classpath:banner.txt
<span class="hljs-comment">#关闭banner模式</span>
<span class="hljs-attr">spring.main.banner-mode</span>=<span class="hljs-literal">off</span></code></pre></div>
<h1 id="2-Profiles"><a href="#2-Profiles" class="headerlink" title="2. Profiles"></a>2. Profiles</h1><p>环境隔离能力；快速切换开发、测试、生产环境(最好的例子就是在开发，测试，生产所需要的数据库不一样，这个时候就需要自动切换数据库）<br>步骤：</p>
<ol>
<li><strong>标识环境</strong>：指定哪些组件、配置在哪个环境生效</li>
<li><strong>切换环境</strong>：这个环境对应的所有组件和配置就应该生效</li>
</ol>
<h2 id="2-1-使用"><a href="#2-1-使用" class="headerlink" title="2.1. 使用"></a>2.1. 使用</h2><h3 id="2-1-1-指定环境"><a href="#2-1-1-指定环境" class="headerlink" title="2.1.1 指定环境"></a><strong>2.1.1 指定环境</strong></h3><ul>
<li>Spring Profiles 提供一种<strong>隔离配置</strong>的方式，使其仅在<strong>特定环境</strong>生效；</li>
<li>任何@Component, @Configuration 或 @ConfigurationProperties 可以使用 @Profile 标记，来指定何时被加载。【<strong>容器中的组件</strong>都可以被 @Profile标记】</li>
</ul>
<h3 id="2-1-2-环境激活（也就是指定当前系统运行的特定环境）"><a href="#2-1-2-环境激活（也就是指定当前系统运行的特定环境）" class="headerlink" title="2.1.2 环境激活（也就是指定当前系统运行的特定环境）"></a><strong>2.1.2 环境激活（也就是指定当前系统运行的特定环境）</strong></h3><ol>
<li>配置激活指定环境； 配置文件</li>
</ol>
<p>spring.profiles.active&#x3D;production,hsqldb</p>
<ol>
<li>也可以使用命令行激活。–spring.profiles.active&#x3D;dev,hsqldb</li>
<li>还可以配置<strong>默认环境</strong>； 不标注@Profile 的组件永远都存在。<ol>
<li>以前默认环境叫default</li>
<li>spring.profiles.default&#x3D;test修改默认环境是test，变形激活了test环境</li>
</ol>
</li>
<li>推荐使用激活方式激活指定环境</li>
</ol>
<h3 id="2-1-3-环境包含"><a href="#2-1-3-环境包含" class="headerlink" title="2.1.3 环境包含"></a><strong>2.1.3 环境包含</strong></h3><p>注意：</p>
<ol>
<li>spring.profiles.active 和spring.profiles.default 只能用到** 无 profile 的文件<strong>中，如果在application-dev.yaml中编写就是</strong>无效的**</li>
<li>也可以额外添加生效文件，而不是激活替换。比如：<div class="code-wrapper"><pre><code class="hljs stylus">spring<span class="hljs-selector-class">.profiles</span><span class="hljs-selector-class">.include</span><span class="hljs-selector-attr">[0]</span>=common
spring<span class="hljs-selector-class">.profiles</span><span class="hljs-selector-class">.include</span><span class="hljs-selector-attr">[1]</span>=local</code></pre></div>
最佳实战：</li>
</ol>
<ul>
<li>**生效的环境 **&#x3D; <strong>激活的环境&#x2F;默认环境</strong> + <strong>包含的环境</strong></li>
<li>项目里面这么用<ul>
<li>基础的配置mybatis、log、xxx：写到<strong>包含环境中</strong></li>
<li>需要动态切换变化的 db、redis：写到<strong>激活的环境中</strong></li>
</ul>
</li>
</ul>
<h2 id="2-2-Profile-分组"><a href="#2-2-Profile-分组" class="headerlink" title="2.2. Profile 分组"></a>2.2. Profile 分组</h2><p>创建prod组，指定包含db和mq配置</p>
<div class="code-wrapper"><pre><code class="hljs stylus">spring<span class="hljs-selector-class">.profiles</span><span class="hljs-selector-class">.group</span><span class="hljs-selector-class">.prod</span><span class="hljs-selector-attr">[0]</span>=db
spring<span class="hljs-selector-class">.profiles</span><span class="hljs-selector-class">.group</span><span class="hljs-selector-class">.prod</span><span class="hljs-selector-attr">[1]</span>=mq</code></pre></div>
<p>使用–spring.profiles.active&#x3D;prod ，就会激活prod，db，mq配置文件</p>
<h2 id="2-3-Profile-配置文件"><a href="#2-3-Profile-配置文件" class="headerlink" title="2.3. Profile 配置文件"></a>2.3. Profile 配置文件</h2><ul>
<li>application-{profile}.properties可以作为<strong>指定环境的配置文件</strong>。</li>
<li>激活这个环境，<strong>配置</strong>就会生效。最终生效的所有<strong>配置</strong>是<ul>
<li>application.properties：主配置文件，任意时候都生效</li>
<li>application-{profile}.properties：指定环境配置文件，激活指定环境生效</li>
</ul>
</li>
</ul>
<p>profile优先级 &gt; application </p>
<h1 id="3-外部化配置"><a href="#3-外部化配置" class="headerlink" title="3. 外部化配置"></a>3. 外部化配置</h1><p><strong>场景</strong>：线上应用如何<strong>快速修改配置</strong>，并应<strong>用最新配置</strong>？</p>
<ul>
<li>SpringBoot 使用 <strong>配置优先级</strong> + <strong>外部配置</strong> 简化配置更新、简化运维。</li>
<li>只需要给jar应用所在的文件夹放一个application.properties最新配置文件，重启项目就能自动应用最新配置</li>
</ul>
<h2 id="3-1-配置优先级"><a href="#3-1-配置优先级" class="headerlink" title="3.1. 配置优先级"></a>3.1. 配置优先级</h2><p>Spring Boot 允许将<strong>配置外部化</strong>，以便可以在不同的环境中使用相同的应用程序代码。<br>我们可以使用各种<strong>外部配置源</strong>，包括Java Properties文件、YAML文件、环境变量和命令行参数。<br>@Value可以获取值，也可以用@ConfigurationProperties将所有属性绑定到java object中<br><strong>以下是 SpringBoot 属性源加载顺序。后面的会覆盖前面的值</strong>。由低到高，高优先级配置覆盖低优先级</p>
<ol>
<li><strong>默认属性</strong>（通过SpringApplication.setDefaultProperties指定的）</li>
<li>@PropertySource指定加载的配置（需要写在@Configuration类上才可生效）,其中指定加载 类的文件一般是配置文件</li>
<li><strong>配置文件（application.properties&#x2F;yml等）</strong></li>
<li>RandomValuePropertySource支持的random.*配置（如：@Value(“${random.int}”)）</li>
<li>OS 环境变量</li>
<li>Java 系统属性（System.getProperties()）</li>
<li>JNDI 属性（来自java:comp&#x2F;env）</li>
<li>ServletContext初始化参数</li>
<li>ServletConfig初始化参数</li>
<li>SPRING_APPLICATION_JSON属性（内置在环境变量或系统属性中的 JSON）</li>
<li><strong>命令行参数</strong></li>
<li>测试属性。(@SpringBootTest进行测试时指定的属性)</li>
<li>测试类@TestPropertySource注解</li>
<li>Devtools 设置的全局属性。($HOME&#x2F;.config&#x2F;spring-boot)</li>
</ol>
<p>结论：配置可以写到很多位置，常见的优先级顺序：</p>
<ul>
<li>命令行&gt; 配置文件&gt; springapplication配置（可以这样理解程序运行的时候，先运行springboot启动程序的默认配置，然后读取配置文件，然后是命令行运行。相当于后面的配置信息会覆盖前面的，可以这样理解但是实际上并非是这样的）</li>
</ul>
<p><strong>配置文件优先级</strong>如下：(<strong>后面覆盖前面</strong>)</p>
<ol>
<li><strong>jar 包内</strong>的application.properties&#x2F;yml</li>
<li><strong>jar 包内</strong>的application-{profile}.properties&#x2F;yml</li>
<li><strong>jar 包外</strong>的application.properties&#x2F;yml</li>
<li><strong>jar 包外</strong>的application-{profile}.properties&#x2F;yml</li>
</ol>
<p><strong>建议</strong>：<strong>用一种格式的配置文件</strong>。<strong>如果.properties和.yml同时存在,则.properties优先</strong><br>结论：包外 &gt; 包内； 同级情况：profile配置 &gt; application配置<br><strong>所有参数均可由命令行传入，使用–参数项&#x3D;参数值，将会被添加到环境变量中，并优先于配置文件。</strong><br><strong>比如java -jar app.jar –name&#x3D;”Spring”,可以使用@Value(“${name}”)获取</strong></p>
<p>演示场景：</p>
<ul>
<li>包内： application.properties server.port&#x3D;8000</li>
<li>包内： application-dev.properties server.port&#x3D;9000</li>
<li>包外：  application.properties server.port&#x3D;8001</li>
<li>包外： application-dev.properties server.port&#x3D;9001</li>
</ul>
<p>启动端口？：命令行 &gt; 9001 &gt; 8001 &gt; 9000 &gt; 8000</p>
<h2 id="3-2-外部配置"><a href="#3-2-外部配置" class="headerlink" title="3.2. 外部配置"></a>3.2. 外部配置</h2><p>SpringBoot 应用启动时会自动寻找application.properties和application.yaml位置，进行加载。顺序如下：（<strong>后面覆盖前面</strong>）</p>
<ol>
<li>类路径: 内部<ol>
<li>类根路径</li>
<li>类下&#x2F;config包</li>
</ol>
</li>
<li>当前路径（项目所在的位置）<ol>
<li>当前路径</li>
<li>当前下&#x2F;config子目录</li>
<li>&#x2F;config目录的直接子目录</li>
</ol>
</li>
</ol>
<p>最终效果：优先级由高到低，前面覆盖后面</p>
<ul>
<li>命令行 &gt; 包外config直接子目录 &gt; 包外config目录 &gt; 包外根目录 &gt; 包内目录</li>
<li>同级比较： <ul>
<li>profile配置 &gt; 默认配置</li>
<li>properties配置 &gt; yaml配置</li>
</ul>
</li>
</ul>
<p> <img src="https://cdn.nlark.com/yuque/0/2023/svg/28066124/1691418639180-bac5ede2-c3e2-4a60-bf81-b015e53ea599.svg#clientId=u8fdb1034-8532-4&from=paste&height=535&id=u4b284044&originHeight=669&originWidth=694&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=91719&status=done&style=none&taskId=ue9940951-a38d-4801-9025-9879191c5cd&title=&width=555.2" srcset="/img/loading.gif" lazyload alt="未命名绘图.svg"><br>**规律：最外层的最优先。</p>
<ul>
<li><strong>命令行 &gt; 所有</strong></li>
<li><strong>包外 &gt; 包内</strong></li>
<li><strong>config目录 &gt; 根目录</strong></li>
<li>**profile &gt; application **</li>
</ul>
<p><strong>配置不同就都生效（互补），配置相同高优先级覆盖低优先级</strong></p>
<h2 id="3-3-导入配置"><a href="#3-3-导入配置" class="headerlink" title="3.3. 导入配置"></a>3.3. 导入配置</h2><p>使用spring.config.import可以导入额外配置：<br>导入配置的优先级低于配置文件的优先级。</p>
<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">spring.config.import</span>=my.properties
<span class="hljs-attr">my.property</span>=value</code></pre></div>
<p>无论以上写法的先后顺序，my.properties的值总是优先于直接在文件中编写的my.property。</p>
<h2 id="3-4-属性占位符"><a href="#3-4-属性占位符" class="headerlink" title="3.4. 属性占位符"></a>3.4. 属性占位符</h2><p>配置文件中可以使用 ${name:default}形式取出之前配置过的值，${name:default}这里的意思是配置文件中有name值，就采用该值，没有的换就让name的值为default的值。@Value可以获取配置文件中的值，@Value(${name：hahha}) String name表示如果配置文件没有name的配置那么name的值为haha,如果有name的值就是配置文件中的值，</p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@Value</span>注解是Spring框架提供的一种方式，可以从外部的配置文件、系统属性或表达式中获取值，
并赋给Bean中的字段或参数。<span class="hljs-variable">@Value</span>注解的参数是一个字符串，可以是一个普通的字符串，也可以是一个占
位符或表达式，用$ &#123;&#125;或# &#123;&#125;包围。</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">app.name</span>=MyApp
<span class="hljs-attr">app.description</span>=<span class="hljs-variable">$&#123;app.name&#125;</span> is a Spring Boot application written by <span class="hljs-variable">$&#123;username:Unknown&#125;</span></code></pre></div>
<h1 id="4-单元测试-JUnit5"><a href="#4-单元测试-JUnit5" class="headerlink" title="4. 单元测试-JUnit5"></a><strong>4. 单元测试-JUnit5</strong></h1><h2 id="4-1-整合"><a href="#4-1-整合" class="headerlink" title="4.1. 整合"></a>4.1. 整合</h2><p>SpringBoot 提供一系列测试工具集及注解方便我们进行测试。<br>spring-boot-test提供核心测试能力，spring-boot-test-autoconfigure提供测试的一些自动配置。<br>我们只需要导入spring-boot-starter-test即可整合测试</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<p>spring-boot-starter-test默认提供了以下库供我们测试使用</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://junit.org/junit5/"><strong>JUnit 5</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/6.0.4/reference/html/testing.html#integration-testing"><strong>Spring Test</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://assertj.github.io/doc/"><strong>AssertJ</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hamcrest/JavaHamcrest"><strong>Hamcrest</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://site.mockito.org/"><strong>Mockito</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/skyscreamer/JSONassert"><strong>JSONassert</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jayway/JsonPath"><strong>JsonPath</strong></a></li>
</ul>
<h2 id="4-2-测试"><a href="#4-2-测试" class="headerlink" title="4.2. 测试"></a><strong>4.2. 测试</strong></h2><div class="code-wrapper"><pre><code class="hljs aspectj"><span class="hljs-number">1.</span><span class="hljs-meta">@SpringBootTest</span> <span class="hljs-comment">//具备测试SpringBoot应用容器中所有组件的功能,测试的时候会启动spingboot</span>

<span class="hljs-comment">//测试类也必须在主程序所在的包及其子包;这里的主程序是springbootApplication修饰的类，之所以</span>
测试类必须在主程序所在的包及其子包的原因是：SpringBoot的默认扫描规则，只扫描自己主程序所在的包以
及子包，这样测试类的注解才能被扫描到。</code></pre></div>
<h3 id="4-2-0-组件测试"><a href="#4-2-0-组件测试" class="headerlink" title="4.2.0 组件测试"></a><strong>4.2.0 组件测试</strong></h3><p><strong>直接@Autowired容器中的组件进行测试</strong><br>JUnit5的注解与JUnit4的注解有所变化<br><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations"><strong>https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations</strong></a><br>@DisplayName(“测试1”)&#x2F;&#x2F;自定义测试名字<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691632824115-17aa44c2-d941-4cf4-9275-e179fff05255.png#averageHue=%23c19757&clientId=u6136e5eb-a4ad-4&from=paste&height=159&id=u91faa989&originHeight=199&originWidth=746&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=52561&status=done&style=none&taskId=ue972d580-cb68-4f6e-babc-29509d58909&title=&width=596.8" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h3 id="4-2-1-注解"><a href="#4-2-1-注解" class="headerlink" title="4.2.1 注解"></a><strong>4.2.1 注解</strong></h3><ul>
<li>**@Test :**表示方法是测试方法。但是与JUnit4的@Test不同，他的职责非常单一不能声明任何属性，拓展的测试将会由Jupiter提供额外测试</li>
<li>**@ParameterizedTest :**表示方法是参数化测试，下方会有详细介绍</li>
<li>**@RepeatedTest :**表示方法可重复执行，下方会有详细介绍</li>
<li>**@DisplayName :**为测试类或者测试方法设置展示名称</li>
<li>**@BeforeEach :**表示在每个单元测试之前执行</li>
<li>**@AfterEach :**表示在每个单元测试之后执行</li>
<li>**@BeforeAll :**表示在所有单元测试之前执行</li>
<li>**@AfterAll :**表示在所有单元测试之后执行</li>
<li>**@Tag :**表示单元测试类别，类似于JUnit4中的@Categories</li>
<li>**@Disabled :**表示测试类或测试方法不执行，类似于JUnit4中的@Ignore</li>
<li>**@Timeout :**表示测试方法运行如果超过了指定时间将会返回错误</li>
<li>**@ExtendWith :**为测试类或测试方法提供扩展类引用<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.Assertions</span><span class="hljs-selector-class">.fail</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.Assumptions</span><span class="hljs-selector-class">.assumeTrue</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.AfterAll</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.AfterEach</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.BeforeAll</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.BeforeEach</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.Disabled</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.Test</span>;

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">StandardTests</span> &#123;

    <span class="hljs-variable">@BeforeAll</span>
    static void <span class="hljs-built_in">initAll</span>() &#123;
    &#125;

    <span class="hljs-variable">@BeforeEach</span>
    void <span class="hljs-built_in">init</span>() &#123;
    &#125;

    <span class="hljs-variable">@DisplayName</span>(<span class="hljs-string">&quot;😱&quot;</span>)
    <span class="hljs-variable">@Test</span>
    void <span class="hljs-built_in">succeedingTest</span>() &#123;
    &#125;

    <span class="hljs-variable">@Test</span>
    void <span class="hljs-built_in">failingTest</span>() &#123;
        <span class="hljs-selector-tag">fail</span>(<span class="hljs-string">&quot;a failing test&quot;</span>);
    &#125;

    @<span class="hljs-selector-tag">Test</span>
    @<span class="hljs-selector-tag">Disabled</span>(<span class="hljs-string">&quot;for demonstration purposes&quot;</span>)
    <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">skippedTest</span>() &#123;
        <span class="hljs-comment">// not executed</span>
    &#125;

    <span class="hljs-variable">@Test</span>
    void <span class="hljs-built_in">abortedTest</span>() &#123;
        <span class="hljs-selector-tag">assumeTrue</span>(<span class="hljs-string">&quot;abc&quot;</span>.<span class="hljs-built_in">contains</span>(<span class="hljs-string">&quot;Z&quot;</span>));
        <span class="hljs-selector-tag">fail</span>(<span class="hljs-string">&quot;test should have been aborted&quot;</span>);
    &#125;

    @<span class="hljs-selector-tag">AfterEach</span>
    <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">tearDown</span>() &#123;
    &#125;

    <span class="hljs-variable">@AfterAll</span>
    static void <span class="hljs-built_in">tearDownAll</span>() &#123;
    &#125;

&#125;</code></pre></div></li>
</ul>
<h3 id="4-2-2-断言"><a href="#4-2-2-断言" class="headerlink" title="4.2.2 断言"></a><strong>4.2.2 断言</strong></h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691418910556-4050b5e8-46b0-4d5c-890a-2432fdb1491c.png#averageHue=%23fbfaf9&clientId=u8fdb1034-8532-4&from=paste&height=526&id=ue8811d01&originHeight=658&originWidth=938&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=51295&status=done&style=none&taskId=u8fbc1a6a-e039-4e45-87a7-d19b86d95c6&title=&width=750.4" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h3 id="4-2-3-嵌套测试"><a href="#4-2-3-嵌套测试" class="headerlink" title="4.2.3 嵌套测试"></a><strong>4.2.3 嵌套测试</strong></h3><p>JUnit 5 可以通过 Java 中的内部类和@Nested 注解实现嵌套测试，从而可以更好的把相关的测试方法组织在一起。在内部类中可以使用@BeforeEach 和@AfterEach 注解，而且嵌套的层次没有限制</p>
<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;A stack&quot;</span>)
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestingAStackDemo</span> &#123;

    <span class="hljs-title class_">Stack</span>&lt;<span class="hljs-title class_">Object</span>&gt; stack;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;is instantiated with new Stack()&quot;</span>)
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">isInstantiatedWithNew</span>(<span class="hljs-params"></span>) &#123;
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();
    &#125;

    <span class="hljs-meta">@Nested</span>
    <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;when new&quot;</span>)
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">WhenNew</span> &#123;

        <span class="hljs-meta">@BeforeEach</span>
        <span class="hljs-built_in">void</span> <span class="hljs-title function_">createNewStack</span>(<span class="hljs-params"></span>) &#123;
            stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();
        &#125;

        <span class="hljs-meta">@Test</span>
        <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;is empty&quot;</span>)
        <span class="hljs-built_in">void</span> <span class="hljs-title function_">isEmpty</span>(<span class="hljs-params"></span>) &#123;
            <span class="hljs-title function_">assertTrue</span>(stack.<span class="hljs-title function_">isEmpty</span>());
        &#125;

        <span class="hljs-meta">@Test</span>
        <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;throws EmptyStackException when popped&quot;</span>)
        <span class="hljs-built_in">void</span> <span class="hljs-title function_">throwsExceptionWhenPopped</span>(<span class="hljs-params"></span>) &#123;
            <span class="hljs-title function_">assertThrows</span>(<span class="hljs-title class_">EmptyStackException</span>.<span class="hljs-property">class</span>, <span class="hljs-attr">stack</span>::pop);
        &#125;

        <span class="hljs-meta">@Test</span>
        <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;throws EmptyStackException when peeked&quot;</span>)
        <span class="hljs-built_in">void</span> <span class="hljs-title function_">throwsExceptionWhenPeeked</span>(<span class="hljs-params"></span>) &#123;
            <span class="hljs-title function_">assertThrows</span>(<span class="hljs-title class_">EmptyStackException</span>.<span class="hljs-property">class</span>, <span class="hljs-attr">stack</span>::peek);
        &#125;

        <span class="hljs-meta">@Nested</span>
        <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;after pushing an element&quot;</span>)
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterPushing</span> &#123;

            <span class="hljs-title class_">String</span> anElement = <span class="hljs-string">&quot;an element&quot;</span>;

            <span class="hljs-meta">@BeforeEach</span>
            <span class="hljs-built_in">void</span> <span class="hljs-title function_">pushAnElement</span>(<span class="hljs-params"></span>) &#123;
                stack.<span class="hljs-title function_">push</span>(anElement);
            &#125;

            <span class="hljs-meta">@Test</span>
            <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;it is no longer empty&quot;</span>)
            <span class="hljs-built_in">void</span> <span class="hljs-title function_">isNotEmpty</span>(<span class="hljs-params"></span>) &#123;
                <span class="hljs-title function_">assertFalse</span>(stack.<span class="hljs-title function_">isEmpty</span>());
            &#125;

            <span class="hljs-meta">@Test</span>
            <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;returns the element when popped and is empty&quot;</span>)
            <span class="hljs-built_in">void</span> <span class="hljs-title function_">returnElementWhenPopped</span>(<span class="hljs-params"></span>) &#123;
                <span class="hljs-title function_">assertEquals</span>(anElement, stack.<span class="hljs-title function_">pop</span>());
                <span class="hljs-title function_">assertTrue</span>(stack.<span class="hljs-title function_">isEmpty</span>());
            &#125;

            <span class="hljs-meta">@Test</span>
            <span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;returns the element when peeked but remains not empty&quot;</span>)
            <span class="hljs-built_in">void</span> <span class="hljs-title function_">returnElementWhenPeeked</span>(<span class="hljs-params"></span>) &#123;
                <span class="hljs-title function_">assertEquals</span>(anElement, stack.<span class="hljs-title function_">peek</span>());
                <span class="hljs-title function_">assertFalse</span>(stack.<span class="hljs-title function_">isEmpty</span>());
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>
<h3 id="4-2-4-参数化测试"><a href="#4-2-4-参数化测试" class="headerlink" title="4.2.4 参数化测试"></a><strong>4.2.4 参数化测试</strong></h3><p>参数化测试是JUnit5很重要的一个新特性，它使得用不同的参数多次运行测试成为了可能，也为我们的单元测试带来许多便利。<br>**</p>
<p>利用**@ValueSource**等注解，指定入参，我们将可以使用不同的参数进行多次单元测试，而不需要每新增一个参数就新增一个单元测试，省去了很多冗余代码。<br><strong>@ValueSource</strong>: 为参数化测试指定入参来源，支持八大基础类以及String类型,Class类型<br><strong>@NullSource</strong>: 表示为参数化测试提供一个null的入参<br><strong>@EnumSource</strong>: 表示为参数化测试提供一个枚举入参<br><strong>@CsvFileSource</strong>：表示读取指定CSV文件内容作为参数化测试入参<br><strong>@MethodSource</strong>：表示读取指定方法的返回值作为参数化测试入参(注意方法返回需要是一个流)</p>
<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-meta">@ParameterizedTest</span>
<span class="hljs-meta">@ValueSource</span>(strings = &#123;<span class="hljs-string">&quot;one&quot;</span>, <span class="hljs-string">&quot;two&quot;</span>, <span class="hljs-string">&quot;three&quot;</span>&#125;)
<span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;参数化测试1&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">parameterizedTest1</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-built_in">string</span></span>) &#123;
    <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-built_in">string</span>);
    <span class="hljs-title class_">Assertions</span>.<span class="hljs-title function_">assertTrue</span>(<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotBlank</span>(<span class="hljs-built_in">string</span>));
&#125;


<span class="hljs-meta">@ParameterizedTest</span>
<span class="hljs-meta">@MethodSource</span>(<span class="hljs-string">&quot;method&quot;</span>)    <span class="hljs-comment">//指定方法名</span>
<span class="hljs-meta">@DisplayName</span>(<span class="hljs-string">&quot;方法来源参数&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">testWithExplicitLocalMethodSource</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) &#123;
    <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(name);
    <span class="hljs-title class_">Assertions</span>.<span class="hljs-title function_">assertNotNull</span>(name);
&#125;

<span class="hljs-keyword">static</span> <span class="hljs-title class_">Stream</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Stream</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-string">&quot;banana&quot;</span>);
&#125;</code></pre></div>
<h1 id="5、SpringBoot3-核心原理"><a href="#5、SpringBoot3-核心原理" class="headerlink" title="5、SpringBoot3-核心原理"></a><strong>5、SpringBoot3-核心原理</strong></h1><h2 id="1-事件和监听器"><a href="#1-事件和监听器" class="headerlink" title="1. 事件和监听器"></a>1. 事件和监听器</h2><p><strong>1. 生命周期监听场景：监听应用的</strong>生命周期<br><strong>1. 监听器-SpringApplicationRunListener</strong><br>自定义SpringApplicationRunListener来监听事件；编写SpringApplicationRunListener实现类在 META-INF&#x2F;spring.factories 中配置 org.springframework.boot.SpringApplicationRunListener&#x3D;自己的Listener，还可以指定一个有参构造器，接受两个参数(SpringApplication application, String[] args)springboot 在spring-boot.jar中配置了默认的 Listener，如下<br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681829576654-d5e4b889-6fcf-4e65-91f1-8de8c78e98f1.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_23,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f3c9ac&from=url&id=kfTpf&originHeight=61&originWidth=792&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload>**</p>
<div class="code-wrapper"><pre><code class="hljs markdown">/**
<span class="hljs-bullet"> *</span> Listener先要从 META-INF/spring.factories 读到
<span class="hljs-bullet"> *</span>
 * 1、引导： 利用 BootstrapContext 引导整个项目启动
<span class="hljs-bullet"> *</span>      starting：              应用开始，SpringApplication的run方法一调用，只要有了 BootstrapContext 就执行
<span class="hljs-bullet"> *</span>      environmentPrepared：   环境准备好（把启动参数等绑定到环境变量中），但是ioc还没有创建；【调一次】
<span class="hljs-bullet"> *</span> 2、启动：
<span class="hljs-bullet"> *</span>      contextPrepared：       ioc容器创建并准备好，但是sources（主配置类）没加载。并关闭引导上下文；组件都没创建  【调一次】
<span class="hljs-bullet"> *</span>      contextLoaded：         ioc容器加载。主配置类加载进去了。但是ioc容器还没刷新（我们的bean没创建）。
<span class="hljs-bullet"> *</span>      =======截止以前，ioc容器里面还没造bean呢=======
<span class="hljs-bullet"> *</span>      started：               ioc容器刷新了（所有bean造好了），但是 runner 没调用。
<span class="hljs-bullet"> *</span>      ready:                  ioc容器刷新了（所有bean造好了），所有 runner 调用完了。
<span class="hljs-bullet"> *</span> 3、运行
<span class="hljs-bullet"> *</span>     以前步骤都正确执行，代表容器running。
 <span class="hljs-emphasis">*/</span></code></pre></div>
<h3 id="2-生命周期全流程"><a href="#2-生命周期全流程" class="headerlink" title="2. 生命周期全流程"></a>2. 生命周期全流程</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1682322663331-25a89875-7ce3-40ae-9be7-9ea752fbab20.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_31,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23a7bd8b&from=url&id=Uwox4&originHeight=758&originWidth=1102&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre><code class="hljs mipsasm">在Spring <span class="hljs-keyword">Boot中，Runner是一个接口，用于在Spring应用程序启动完成后执行一些特定的任务。</span>
<span class="hljs-keyword"></span>它是Spring <span class="hljs-keyword">Boot提供的一种扩展机制，允许开发人员在应用程序启动后立即执行一些代码逻辑。</span>
<span class="hljs-keyword"></span>开发人员可以通过实现Runner接口并注入到Spring应用程序中，从而在应用程序启动后执行自定义的任务。
runner是springboot底层用来感知生命周期特定阶段的一个回调。
不同于SpringApplicationRunListener,这个是用来感知全生命周期的</code></pre></div>

<h2 id="2-事件触发时机"><a href="#2-事件触发时机" class="headerlink" title="2. 事件触发时机"></a>2. 事件触发时机</h2><h3 id="1-各种回调监听器"><a href="#1-各种回调监听器" class="headerlink" title="1. 各种回调监听器"></a>1. 各种回调监听器</h3><ul>
<li>BootstrapRegistryInitializer： ** 感知特定阶段：<strong>感知</strong>引导初始化**<ul>
<li>META-INF&#x2F;spring.factories</li>
<li>创建引导上下文bootstrapContext的时候触发。</li>
<li>application.addBootstrapRegistryInitializer();</li>
<li>场景：进行密钥校对授权。</li>
</ul>
</li>
<li>ApplicationContextInitializer： ** 感知特定阶段：** 感知ioc容器初始化<ul>
<li>META-INF&#x2F;spring.factories</li>
<li>application.addInitializers();</li>
</ul>
</li>
<li><strong>ApplicationListener： 感知全阶段：基于事件机制，感知事件。 一旦到了哪个阶段可以做别的事</strong><ul>
<li>@Bean或@EventListener： 事件驱动</li>
<li>SpringApplication.addListeners(…)或 SpringApplicationBuilder.listeners(…)</li>
<li>META-INF&#x2F;spring.factories</li>
</ul>
</li>
<li><strong>SpringApplicationRunListener： 感知全阶段生命周期 + 各种阶段都能自定义操作； 功能更完善。</strong><ul>
<li>META-INF&#x2F;spring.factories</li>
</ul>
</li>
<li><strong>ApplicationRunner: 感知特定阶段：感知应用就绪Ready。卡死应用，就不会就绪</strong><ul>
<li>@Bean</li>
</ul>
</li>
<li><strong>CommandLineRunner： 感知特定阶段：感知应用就绪Ready。卡死应用，就不会就绪</strong><ul>
<li>@Bean</li>
</ul>
</li>
</ul>
<p>最佳实战：</p>
<ul>
<li>如果项目启动前做事： BootstrapRegistryInitializer 和 ApplicationContextInitializer</li>
<li>如果想要在项目启动完成后做事：<strong>ApplicationRunner和 CommandLineRunner</strong></li>
<li><strong>如果要干涉生命周期做事：SpringApplicationRunListener</strong></li>
<li><strong>如果想要用事件机制：ApplicationListener</strong></li>
<li><strong>上面的都是接口，可以通过实现接口，然后在</strong>META-INF&#x2F;spring.factories配置文件中填充实现上述接口的类，就可以实现在生命周期的特定阶段完成某项任务！</li>
</ul>
<h3 id="2-完整触发流程"><a href="#2-完整触发流程" class="headerlink" title="2. 完整触发流程"></a><strong>2. 完整触发流程</strong></h3><p><strong>9大事件</strong>触发顺序&amp;时机</p>
<ol>
<li>ApplicationStartingEvent：应用启动但未做任何事情, 除过注册listeners and initializers.</li>
<li>ApplicationEnvironmentPreparedEvent： Environment 准备好，但context 未创建.</li>
<li>ApplicationContextInitializedEvent: ApplicationContext 准备好，ApplicationContextInitializers 调用，但是任何bean未加载</li>
<li>ApplicationPreparedEvent： 容器刷新之前，bean定义信息加载</li>
<li>ApplicationStartedEvent： 容器刷新完成， runner未调用</li>
</ol>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;以下就开始插入了<strong>探针机制</strong>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<ol>
<li>AvailabilityChangeEvent： LivenessState.CORRECT应用存活； <strong>存活探针</strong></li>
<li>ApplicationReadyEvent: 任何runner被调用</li>
<li>AvailabilityChangeEvent：ReadinessState.ACCEPTING_TRAFFIC<strong>就绪探针</strong>，可以接请求</li>
<li>ApplicationFailedEvent：启动出错</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691887909080-a687294a-131b-4da8-9822-18298ade2f39.png#averageHue=%23c4d581&clientId=uac0c1727-261a-4&from=paste&height=610&id=ue472925a&originHeight=762&originWidth=1129&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=133115&status=done&style=none&taskId=ue11d8088-eb18-4a04-ae32-ed763f0e0a8&title=&width=903.2" srcset="/img/loading.gif" lazyload alt="image.png"><strong>应用事件发送顺序如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1691887919553-7c5e83d8-0a5c-4cae-bfca-bd50272bbb36.png#averageHue=%23f5eee4&clientId=uac0c1727-261a-4&from=paste&height=157&id=ufc92ec7f&originHeight=196&originWidth=937&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=100464&status=done&style=none&taskId=ua7f8bbd0-7822-4907-8c9a-bd01dc2227b&title=&width=749.6" srcset="/img/loading.gif" lazyload alt="image.png"><br>感知应用是否存活了：可能植物状态，虽然活着但是不能处理请求。<br>应用是否</strong>就绪**了：能响应请求，说明确实活的比较好。</p>
<h3 id="3-SpringBoot-事件驱动开发"><a href="#3-SpringBoot-事件驱动开发" class="headerlink" title="3. SpringBoot 事件驱动开发"></a>3. SpringBoot 事件驱动开发</h3><p><strong>应用启动过程生命周期事件感知（9大事件）</strong>、<strong>应用运行中事件感知（无数种）</strong>。</p>
<ul>
<li><strong>事件发布</strong>：ApplicationEventPublisherAware或注入：ApplicationEventMulticaster</li>
<li><strong>事件监听</strong>：组件 + @EventListener</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1682327167479-8f634931-f8ca-48fb-9566-c914f1795ff2.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_33,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23f2eeec&from=url&id=b4csj&originHeight=387&originWidth=1153&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload><br><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1682341921101-aa095a84-00cc-4815-b675-f4ed81cecf3b.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_22,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23fdfcfc&from=url&id=dk2IM&originHeight=489&originWidth=780&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload><br><strong>事件发布者</strong></p>
<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventPublisher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationEventPublisherAware</span> &#123;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 底层发送事件用的组件，SpringBoot会通过ApplicationEventPublisherAware接口自动注入给我们</span>
<span class="hljs-comment">     * 事件是广播出去的。所有监听这个事件的监听器都可以收到</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-title class_">ApplicationEventPublisher</span> applicationEventPublisher;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 所有事件都可以发</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">event</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">sendEvent</span>(<span class="hljs-params">ApplicationEvent event</span>) &#123;
        <span class="hljs-comment">//调用底层API发送事件</span>
        applicationEventPublisher.<span class="hljs-title function_">publishEvent</span>(event);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 会被自动调用，把真正发事件的底层组组件给我们注入进来</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> applicationEventPublisher event publisher to be used by this object</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setApplicationEventPublisher</span>(<span class="hljs-params">ApplicationEventPublisher applicationEventPublisher</span>) &#123;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">applicationEventPublisher</span> = applicationEventPublisher;
    &#125;
&#125;</code></pre></div>
<p><strong>事件订阅者</strong></p>
<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponService</span> &#123;

    <span class="hljs-meta">@Order</span>(<span class="hljs-number">1</span>)
    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onEvent</span>(<span class="hljs-params">LoginSuccessEvent loginSuccessEvent</span>)&#123;
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">&quot;===== CouponService ====感知到事件&quot;</span>+loginSuccessEvent);
        <span class="hljs-title class_">UserEntity</span> source = (<span class="hljs-title class_">UserEntity</span>) loginSuccessEvent.<span class="hljs-title function_">getSource</span>();
        <span class="hljs-title function_">sendCoupon</span>(source.<span class="hljs-title function_">getUsername</span>());
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">sendCoupon</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>)&#123;
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(username + <span class="hljs-string">&quot; 随机得到了一张优惠券&quot;</span>);
    &#125;
&#125;</code></pre></div>
<h1 id="2-自动配置原理"><a href="#2-自动配置原理" class="headerlink" title="**2. **自动配置原理"></a>**2. **自动配置原理</h1><h2 id="1-入门理解"><a href="#1-入门理解" class="headerlink" title="1. 入门理解"></a><strong>1. 入门理解</strong></h2><p><strong>应用关注的三大核心：场景、配置、组件</strong></p>
<h3 id="1-自动配置流程"><a href="#1-自动配置流程" class="headerlink" title="1. 自动配置流程"></a><strong>1. 自动配置流程</strong></h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/1613913/1681829645812-0f0cad01-66d4-42fc-8111-091e33a062c6.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_32,text_5bCa56GF6LC3IGF0Z3VpZ3UuY29t,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10#averageHue=%23cfe1c6&from=url&id=B0IdI&originHeight=602&originWidth=1113&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload>**</p>
<ol>
<li><strong>导入starter</strong></li>
<li><strong>依赖导入autoconfigure</strong></li>
<li><strong>寻找类路径下 META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports文件</strong></li>
<li><strong>启动，加载所有 自动配置类xxxAutoConfiguration</strong><ol>
<li><strong>给容器中配置功能组件</strong></li>
<li><strong>组件参数绑定到 属性类中。xxxProperties</strong></li>
<li><strong>属性类和配置文件前缀项绑定</strong></li>
<li><strong>@Contional派生的条件注解进行判断是否组件生效</strong></li>
</ol>
</li>
<li><strong>效果：</strong><ol>
<li><strong>修改配置文件，修改底层参数</strong></li>
<li><strong>所有场景自动配置好直接使用</strong></li>
<li><strong>可以注入SpringBoot配置好的组件随时使用</strong></li>
</ol>
</li>
</ol>
<h3 id="2-SPI机制"><a href="#2-SPI机制" class="headerlink" title="2. SPI机制"></a>2. SPI机制</h3><ul>
<li><strong>Java中的SPI（Service Provider Interface）是一种软件设计模式，用于在应用程序中动态地发现和加载组件。SPI的思想</strong>是，定义一个接口或抽象类，然后通过在classpath中定义实现该接口的类来实现对组件的动态发现和加载。</li>
<li>SPI的主要目的是解决在应用程序中使用可插拔组件的问题。例如，一个应用程序可能需要使用不同的日志框架或数据库连接池，但是这些组件的选择可能取决于运行时的条件。通过使用SPI，应用程序可以在运行时发现并加载适当的组件，而无需在代码中硬编码这些组件的实现类。</li>
<li>在Java中，<strong>SPI</strong>的实现方式是通过在META-INF&#x2F;services目录下创建一个以服务接口全限定名为名字的文件，文件中包含实现该服务接口的类的全限定名。当应用程序启动时，Java的SPI机制会自动扫描classpath中的这些文件，并根据文件中指定的类名来加载实现类。</li>
<li>通过使用SPI，应用程序可以实现更灵活、可扩展的架构，同时也可以避免硬编码依赖关系和增加代码的可维护性。</li>
</ul>
<p>以上回答来自ChatGPT-3.5<br>在SpringBoot中，META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports<br>作业：写一段java的spi机制代码</p>
<h3 id="3-功能开关"><a href="#3-功能开关" class="headerlink" title="3. 功能开关"></a>3. 功能开关</h3><ul>
<li>自动配置：全部都配置好，什么都不用管。 自动批量导入<ul>
<li>项目一启动，spi文件中指定的所有都加载。</li>
</ul>
</li>
<li>@EnableXxxx：手动控制哪些功能的开启； 手动导入。<ul>
<li>开启xxx功能</li>
</ul>
</li>
</ul>
<h2 id="2-进阶理解"><a href="#2-进阶理解" class="headerlink" title="2. 进阶理解"></a><strong>2. 进阶理解</strong></h2><h3 id="1-SpringBootApplication"><a href="#1-SpringBootApplication" class="headerlink" title="1. @SpringBootApplication"></a><strong>1. @SpringBootApplication</strong></h3><h4 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration"></a><strong>@SpringBootConfiguration</strong></h4><p><strong>就是： @Configuration ，容器中的组件，配置类。spring ioc启动就会加载创建这个类对象</strong></p>
<h4 id="EnableAutoConfiguration：开启自动配置"><a href="#EnableAutoConfiguration：开启自动配置" class="headerlink" title="@EnableAutoConfiguration：开启自动配置"></a><strong>@EnableAutoConfiguration：开启自动配置</strong></h4><p><strong>开启自动配置</strong></p>
<h5 id="AutoConfigurationPackage：扫描主程序包：加载自己的组件"><a href="#AutoConfigurationPackage：扫描主程序包：加载自己的组件" class="headerlink" title="@AutoConfigurationPackage：扫描主程序包：加载自己的组件"></a><strong>@AutoConfigurationPackage：扫描主程序包：加载自己的组件</strong></h5><ul>
<li><strong>利用 @Import(AutoConfigurationPackages.Registrar.class) 想要给容器中导入组件。</strong></li>
<li><strong>把主程序所在的包的所有组件导入进来。</strong></li>
<li><strong>为什么SpringBoot默认只扫描主程序所在的包及其子包</strong></li>
</ul>
<p>**</p>
<h5 id="Import-AutoConfigurationImportSelector-class-：加载所有自动配置类：加载starter导入的组件"><a href="#Import-AutoConfigurationImportSelector-class-：加载所有自动配置类：加载starter导入的组件" class="headerlink" title="@Import(AutoConfigurationImportSelector.class)：加载所有自动配置类：加载starter导入的组件"></a><strong>@Import(AutoConfigurationImportSelector.class)：加载所有自动配置类：加载starter导入的组件</strong></h5><div class="code-wrapper"><pre><code class="hljs arduino">List&lt;<span class="hljs-type">String</span>&gt; configurations = ImportCandidates.<span class="hljs-built_in">load</span>(AutoConfiguration.<span class="hljs-keyword">class</span>, <span class="hljs-built_in">getBeanClassLoader</span>())
	.<span class="hljs-built_in">getCandidates</span>();</code></pre></div>
<p>**扫描SPI文件：META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</p>
<p>**</p>
<h4 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a><strong>@ComponentScan</strong></h4><p><strong>组件扫描：排除一些组件（哪些不要）</strong><br><strong>排除前面已经扫描进来的配置类、和自动配置类。</strong></p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@ComponentScan</span>(excludeFilters = &#123; <span class="hljs-variable">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
      <span class="hljs-variable">@Filter</span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</code></pre></div>
<h3 id="2-完整启动加载流程"><a href="#2-完整启动加载流程" class="headerlink" title="2. 完整启动加载流程"></a>2. 完整启动加载流程</h3><p>生命周期启动加载流程<br><img src="https://cdn.nlark.com/yuque/0/2023/svg/1613913/1682569555020-b6cbc750-3171-44c6-810f-1c59e590b792.svg#from=url&id=kMVFr&originHeight=794&originWidth=1453&originalType=binary&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p>
<h1 id="3-自定义starter"><a href="#3-自定义starter" class="headerlink" title="3. 自定义starter"></a><strong>3. 自定义starter</strong></h1><p><strong>场景：抽取聊天机器人场景，它可以打招呼。</strong><br><strong>效果：任何项目导入此starter都具有打招呼功能，并且问候语中的人名需要可以在配置文件中修改</strong></p>
<ul>
<li><ol>
<li>创建自定义starter项目，引入spring-boot-starter基础依赖</li>
</ol>
</li>
<li><ol start="2">
<li>编写模块功能，引入模块所有需要的依赖。</li>
</ol>
</li>
<li><ol start="3">
<li>编写xxxAutoConfiguration自动配置类，帮其他项目导入这个模块需要的所有组件</li>
</ol>
</li>
<li><ol start="4">
<li>编写配置文件META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports指定启动需要加载的自动配置</li>
</ol>
</li>
</ul>
<h2 id="1-业务代码"><a href="#1-业务代码" class="headerlink" title="1. 业务代码"></a><strong>1. 业务代码</strong></h2><p>自定义配置有提示。导入以下依赖重启项目，再写配置文件就有提示**</p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">&quot;robot&quot;</span>)  <span class="hljs-comment">//此属性类和配置文件指定前缀绑定</span>
<span class="hljs-variable">@Component</span>
<span class="hljs-variable">@Data</span>
public class RobotProperties &#123;

    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">name</span>;
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">age</span>;
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">email</span>;
&#125;
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--        导入配置处理器，配置文件自定义的properties配置都会有提示--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<h2 id="2-基本抽取"><a href="#2-基本抽取" class="headerlink" title="2. 基本抽取"></a>2. 基本抽取</h2><ul>
<li>创建starter项目，把公共代码需要的所有依赖导入</li>
<li>把公共代码复制进来</li>
<li>自己写一个 RobotAutoConfiguration，给容器中导入这个场景需要的所有组件<ul>
<li>为什么这些组件默认不会扫描进去？</li>
<li><strong>starter所在的包和 引入它的项目的主程序所在的包不是父子层级</strong></li>
</ul>
</li>
<li>别人引用这个starter，直接导入这个 RobotAutoConfiguration,就能把这个场景的组件导入进来</li>
<li>功能生效。</li>
<li>测试编写配置文件</li>
</ul>
<h2 id="3-使用-EnableXxx机制"><a href="#3-使用-EnableXxx机制" class="headerlink" title="3. 使用@EnableXxx机制"></a><strong>3. 使用@EnableXxx机制</strong></h2><div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-variable">@Target</span>(&#123;ElementType.TYPE&#125;)
<span class="hljs-variable">@Documented</span>
<span class="hljs-variable">@Import</span>(RobotAutoConfiguration.class)
public <span class="hljs-variable">@interface</span> EnableRobot &#123;


&#125;</code></pre></div>
<p>****别人引入starter需要使用 @EnableRobot开启功能 **</p>
<h2 id="4-完全自动配置"><a href="#4-完全自动配置" class="headerlink" title="4. 完全自动配置"></a>4. 完全自动配置</h2><ul>
<li>依赖SpringBoot的SPI机制</li>
<li>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports 文件中编写好我们自动配置类的全类名即可</li>
<li>项目启动，自动加载我们的自动配置类</li>
</ul>
<h1 id="SpringBoot3-场景整合"><a href="#SpringBoot3-场景整合" class="headerlink" title="SpringBoot3-场景整合"></a>SpringBoot3-场景整合</h1><h2 id="0-云服务器"><a href="#0-云服务器" class="headerlink" title="0. 云服务器"></a>0. 云服务器</h2><ul>
<li><a target="_blank" rel="noopener" href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=50sid5bu&utm_source=50sid5bu"><strong>阿里云</strong></a><strong>、</strong><a target="_blank" rel="noopener" href="https://curl.qcloud.com/iyFTRSJb"><strong>腾讯云</strong></a><strong>、</strong><a target="_blank" rel="noopener" href="https://activity.huaweicloud.com/discount_area_v5/index.html?fromacct=d1a6f32e-d6d0-4702-9213-eafe022a0708&utm_source=bGVpZmVuZ3lhbmc==&utm_medium=cps&utm_campaign=201905"><strong>华为云</strong></a>** 服务器开通； 按量付费，省钱省心**</li>
<li><strong>安装以下组件</strong></li>
<li><input disabled="" type="checkbox"> <strong>docker</strong></li>
<li><input disabled="" type="checkbox"> <strong>redis</strong></li>
<li><input disabled="" type="checkbox"> <strong>kafka</strong></li>
<li><input disabled="" type="checkbox"> <strong>prometheus</strong></li>
<li><input disabled="" type="checkbox"> <strong>grafana</strong></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kingToolbox/WindTerm/releases/download/2.5.0/WindTerm_2.5.0_Windows_Portable_x86_64.zip"><strong>https://github.com/kingToolbox/WindTerm/releases/download/2.5.0/WindTerm_2.5.0_Windows_Portable_x86_64.zip</strong></a>** 下载windterm**</li>
</ul>
<p><strong>重要：开通云服务器以后，请一定在安全组设置规则，放行端口</strong></p>
<h2 id="1-Docker安装"><a href="#1-Docker安装" class="headerlink" title="1. Docker安装"></a>1. Docker安装</h2><p>还不会docker的同学，参考【云原生实战（10~25集）】快速入门<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13Q4y1C7hS?p=10">https://www.bilibili.com/video/BV13Q4y1C7hS?p=10</a></p>
<div class="code-wrapper"><pre><code class="hljs vim">sudo yum install -<span class="hljs-keyword">y</span> yum-utils

sudo yum-config-manager \
    --<span class="hljs-built_in">add</span>-repo \
    https://download.docker.<span class="hljs-keyword">com</span>/linux/centos/docker-<span class="hljs-keyword">ce</span>.repo

sudo yum install docker-<span class="hljs-keyword">ce</span> docker-<span class="hljs-keyword">ce</span>-cli containerd.io docker-buildx-plugin docker-compose-plugin

sudo systemctl enable docker --now

#测试工作
docker <span class="hljs-keyword">ps</span>
#  批量安装所有软件
docker compose</code></pre></div>
<p><strong>创建 &#x2F;prod 文件夹，准备以下文件</strong></p>
<h2 id="2-prometheus-yml"><a href="#2-prometheus-yml" class="headerlink" title="2. prometheus.yml"></a>2. prometheus.yml</h2><div class="code-wrapper"><pre><code class="hljs nestedtext"><span class="hljs-attribute">global</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">scrape_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">15s</span>
  <span class="hljs-attribute">evaluation_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">15s</span>

<span class="hljs-attribute">scrape_configs</span><span class="hljs-punctuation">:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;prometheus&#x27;</span>
    <span class="hljs-attribute">static_configs</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">targets: [&#x27;localhost:9090&#x27;]</span>

  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;redis&#x27;</span>
    <span class="hljs-attribute">static_configs</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">targets: [&#x27;redis:6379&#x27;]</span>

  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;kafka&#x27;</span>
    <span class="hljs-attribute">static_configs</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">targets: [&#x27;kafka:9092&#x27;]</span></code></pre></div>
<h2 id="3-docker-compose-yml"><a href="#3-docker-compose-yml" class="headerlink" title="3. docker-compose.yml"></a>3. docker-compose.yml</h2><div class="code-wrapper"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;3.9&#x27;</span>

<span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">redis</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">redis:latest</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">redis</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;6379:6379&quot;</span>
    <span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-attribute">zookeeper</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">bitnami/zookeeper:latest</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">ZOOKEEPER_CLIENT_PORT</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2181</span>
      <span class="hljs-attribute">ZOOKEEPER_TICK_TIME</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2000</span>
    <span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-attribute">kafka</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">bitnami/kafka:3.4.0</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">kafka</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span>
    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9092:9092&quot;</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">ALLOW_PLAINTEXT_LISTENER</span><span class="hljs-punctuation">:</span> <span class="hljs-string">yes</span>
      <span class="hljs-attribute">KAFKA_CFG_ZOOKEEPER_CONNECT</span><span class="hljs-punctuation">:</span> <span class="hljs-string">zookeeper:2181</span>
      <span class="hljs-attribute">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1</span>
    <span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>
  
  <span class="hljs-attribute">kafka-ui</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">provectuslabs/kafka-ui:latest</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string"> kafka-ui</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span>
    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">kafka</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8080:8080&quot;</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">KAFKA_CLUSTERS_0_NAME</span><span class="hljs-punctuation">:</span> <span class="hljs-string">dev</span>
      <span class="hljs-attribute">KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS</span><span class="hljs-punctuation">:</span> <span class="hljs-string">kafka:9092</span>
    <span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-attribute">prometheus</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">prom/prometheus:latest</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">prometheus</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span>
    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./prometheus.yml:/etc/prometheus/prometheus.yml</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9090:9090&quot;</span>
    <span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-attribute">grafana</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">grafana/grafana:latest</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">grafana</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span>
    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">prometheus</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3000:3000&quot;</span>
    <span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

<span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">backend</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">backend</span></code></pre></div>
<h2 id="4-启动环境"><a href="#4-启动环境" class="headerlink" title="4. 启动环境"></a>4. 启动环境</h2><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> compose -f docker-compose.yml up -d</code></pre></div>
<h2 id="5-验证"><a href="#5-验证" class="headerlink" title="5. 验证:"></a>5. 验证:</h2><p>如果通过浏览器验证没有通过的话，原因可能是没有配置安全组：例如<strong>Kafka-ui通过浏览器无法访问！</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1692062258198-3076f00d-7f1c-4d16-b118-d5602186ac58.png#averageHue=%23fcfcfc&clientId=uac0c1727-261a-4&from=paste&height=75&id=ucb808ef1&originHeight=94&originWidth=1264&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=7142&status=done&style=none&taskId=u66261308-30e0-4c55-9da2-3ed8eed8757&title=&width=1011.2" srcset="/img/loading.gif" lazyload alt="image.png">添加安全组8080，这里的来源是：可以设置为 0.0.0.0&#x2F;0，表示允许来自任何 IP 地址的流量，或者您可以指定特定的 IP 地址范围或单个 IP 地址。</p>
<ul>
<li><strong>Redis：你的ip:6379</strong><ul>
<li><strong>填写表单，下载官方可视化工具：</strong></li>
<li><a target="_blank" rel="noopener" href="https://redis.com/redis-enterprise/redis-insight/#insight-form"><strong>https://redis.com/redis-enterprise/redis-insight/#insight-form</strong></a></li>
</ul>
</li>
<li><strong>Kafka：你的ip:9092</strong><ul>
<li><strong>idea安装大数据插件</strong></li>
</ul>
</li>
<li><strong>Prometheus：你的ip:9090</strong><ul>
<li><strong>直接浏览器访问</strong></li>
</ul>
</li>
<li><strong>Grafana：你的ip:3000</strong><ul>
<li><strong>直接浏览器访问</strong></li>
</ul>
</li>
</ul>
<h2 id="Docker-10-25"><a href="#Docker-10-25" class="headerlink" title="Docker:(10-25)"></a>Docker:(10-25)</h2><h3 id="Docker基本概念"><a href="#Docker基本概念" class="headerlink" title="Docker基本概念"></a>Docker基本概念</h3><h4 id="1、解决的问题"><a href="#1、解决的问题" class="headerlink" title="1、解决的问题:"></a>1、解决的问题:</h4><p><strong>1、统一标准</strong><br>应用构建<br> Java、C++、JavaScript<br>打成软件包<br>.exe<br>docker build …. 镜像<br><strong>应用分享:</strong><br>所有软件的镜像放到一个指定地方 docker hub<br>安卓，应用市场应用运行统一标准的镜像docker run<br>…….<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1692069227456-eaaf5b70-3097-4576-b385-7518d3348588.png#averageHue=%23f0f1ed&clientId=uac0c1727-261a-4&from=paste&height=274&id=u3bdf5779&originHeight=343&originWidth=651&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=89111&status=done&style=none&taskId=u3784a1e0-8b8e-4304-81c3-2a5c657fe94&title=&width=520.8" srcset="/img/loading.gif" lazyload alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1692069318112-64c8ca5e-79f7-41e5-9c62-bf61b0757143.png#averageHue=%23efefe8&clientId=uac0c1727-261a-4&from=paste&height=285&id=uff9e6b90&originHeight=356&originWidth=671&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=83511&status=done&style=none&taskId=ue0c0164f-30fd-418f-ad07-ab8dfe21483&title=&width=536.8" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="2、资源隔离"><a href="#2、资源隔离" class="headerlink" title="2、资源隔离"></a>2、资源隔离</h4><ul>
<li>cpu、memory资源隔离与限制</li>
<li>访问设备隔离与限制</li>
<li>网络隔离与限制</li>
<li>用户、用户组隔离限制</li>
<li>……</li>
</ul>
<h3 id="2、架构"><a href="#2、架构" class="headerlink" title="2、架构"></a>2、架构</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/svg/28066124/1692064439987-d4ad84f3-0582-4676-9c49-39734e7ef6f4.svg#clientId=uac0c1727-261a-4&from=paste&height=422&id=uc0bf46e6&originHeight=527&originWidth=1009&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=187350&status=done&style=none&taskId=u62a00463-37f0-4bac-9d79-bc88a76f6e2&title=&width=807.2" srcset="/img/loading.gif" lazyload alt="architecture.svg"></p>
<ul>
<li>Docker_Host：<ul>
<li>安装Docker的主机</li>
</ul>
</li>
<li>Docker Daemon：<ul>
<li>运行在Docker主机上的Docker后台进程</li>
</ul>
</li>
<li>Client：<ul>
<li>操作Docker主机的客户端（命令行、UI等）</li>
</ul>
</li>
<li>Registry：<ul>
<li>镜像仓库</li>
<li>Docker Hub</li>
</ul>
</li>
<li>Images：<ul>
<li>镜像，带环境打包好的程序，可以直接启动运行</li>
</ul>
</li>
<li>Containers：<ul>
<li>容器，由镜像启动起来正在运行中的程序</li>
</ul>
</li>
</ul>
<p>交互逻辑<br>装好<strong>Docker</strong>，然后去 <strong>软件市场(doucker hub)</strong> 寻找<strong>镜像</strong>，下载并运行，查看<strong>容器</strong>状态日志等排错</p>
<h3 id="3、安装"><a href="#3、安装" class="headerlink" title="3、安装"></a>3、安装</h3><h4 id="1、centos下安装docker"><a href="#1、centos下安装docker" class="headerlink" title="1、centos下安装docker"></a>1、centos下安装docker</h4><p>其他系统参照如下文档<br><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<h4 id="1、移除以前docker相关包"><a href="#1、移除以前docker相关包" class="headerlink" title="1、移除以前docker相关包"></a>1、移除以前docker相关包</h4><div class="code-wrapper"><pre><code class="hljs livescript">sudo yum remove docker <span class="hljs-string">\</span>
                  docker-client <span class="hljs-string">\</span>
                  docker-client-latest <span class="hljs-string">\</span>
                  docker-common <span class="hljs-string">\</span>
                  docker-latest <span class="hljs-string">\</span>
                  docker-latest-logrotate <span class="hljs-string">\</span>
                  docker-logrotate <span class="hljs-string">\</span>
                  docker-engine</code></pre></div>
<h4 id="2、配置yum源并且添加镜像仓库："><a href="#2、配置yum源并且添加镜像仓库：" class="headerlink" title="2、配置yum源并且添加镜像仓库："></a>2、配置yum源并且添加镜像仓库：</h4><div class="code-wrapper"><pre><code class="hljs vim">sudo yum install -<span class="hljs-keyword">y</span> yum-utils
sudo yum-config-manager \
--<span class="hljs-built_in">add</span>-repo \
http://mirrors.aliyun.<span class="hljs-keyword">com</span>/docker-<span class="hljs-keyword">ce</span>/linux/centos/docker-<span class="hljs-keyword">ce</span>.repo
</code></pre></div>
<h4 id="3、安装docker"><a href="#3、安装docker" class="headerlink" title="3、安装docker"></a>3、安装docker</h4><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> yum install -y docker-ce docker-ce-cli containerd.io


<span class="hljs-comment">#以下是在安装k8s的时候使用</span>
<span class="hljs-attribute">yum</span> install -y docker-ce-<span class="hljs-number">20</span>.<span class="hljs-number">10</span>.<span class="hljs-number">7</span> docker-ce-cli-<span class="hljs-number">20</span>.<span class="hljs-number">10</span>.<span class="hljs-number">7</span>  containerd.io-<span class="hljs-number">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">6</span></code></pre></div>
<h4 id="4、启动"><a href="#4、启动" class="headerlink" title="4、启动"></a>4、启动</h4><div class="code-wrapper"><pre><code class="hljs pgsql">systemctl <span class="hljs-keyword">enable</span> docker <span class="hljs-comment">--now</span></code></pre></div>
<h4 id="5、配置加速"><a href="#5、配置加速" class="headerlink" title="5、配置加速"></a>5、配置加速</h4><p>这里额外添加了docker的生产环境核心配置cgroup：<br>其中仓库加速镜像可以去阿里云的：容器镜像服务-&gt;	镜像加速器中选择加速地址替换下面的加速地址也就是registry-mirrors；</p>
<div class="code-wrapper"><pre><code class="hljs bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/docker
sudo <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span>
&#123;
  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://82m9ar63.mirror.aliyuncs.com&quot;</span>],
  <span class="hljs-string">&quot;exec-opts&quot;</span>: [<span class="hljs-string">&quot;native.cgroupdriver=systemd&quot;</span>],
  <span class="hljs-string">&quot;log-driver&quot;</span>: <span class="hljs-string">&quot;json-file&quot;</span>,
  <span class="hljs-string">&quot;log-opts&quot;</span>: &#123;
    <span class="hljs-string">&quot;max-size&quot;</span>: <span class="hljs-string">&quot;100m&quot;</span>
  &#125;,
  <span class="hljs-string">&quot;storage-driver&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span>
&#125;
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker</code></pre></div>
<h4 id="6-镜像和容器的区别"><a href="#6-镜像和容器的区别" class="headerlink" title="6.镜像和容器的区别"></a>6.镜像和容器的区别</h4><h3 id="Docker命令实战"><a href="#Docker命令实战" class="headerlink" title="Docker命令实战"></a>Docker命令实战</h3><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1692071527786-0d52ba68-3e36-4c18-b8eb-96a6ab5a7d03.png#averageHue=%23e3e2e1&clientId=uac0c1727-261a-4&from=paste&height=478&id=u8ac5de6b&originHeight=597&originWidth=1066&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=235950&status=done&style=none&taskId=u6a7c6476-c964-4a45-bda6-bab61e7b3ce&title=&width=852.8" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="基础实战"><a href="#基础实战" class="headerlink" title="基础实战"></a>基础实战</h4><h5 id="1、找镜像"><a href="#1、找镜像" class="headerlink" title="1、找镜像"></a>1、找镜像</h5><p>去<a target="_blank" rel="noopener" href="http://hub.docker.com/">docker hub</a>，找到nginx镜像</p>
<div class="code-wrapper"><pre><code class="hljs clean">docker pull nginx  #下载最新版

镜像名:版本名（标签）

docker pull nginx:<span class="hljs-number">1.20</span><span class="hljs-number">.1</span>


docker pull redis  #下载最新
docker pull redis:<span class="hljs-number">6.2</span><span class="hljs-number">.4</span>

## 下载来的镜像都在本地
docker images  #查看所有镜像
##删除镜像
docker rmi redis
##删除中的redis为
redis = redis:latest
docker rmi 镜像名:版本号/镜像id
##每个镜像都有一个id,可以根据id删除镜像
##如果要删除的镜像真正使用，
</code></pre></div>
<p>Nginx（发音为 “engine-x”）是一个用于 HTTP、HTTPS、SMTP、POP3 和 IMAP 协议的开源反向代理服务器，以及负载均衡器、HTTP 缓存和 Web 服务器（原始服务器）。 nginx 项目一开始就非常注重高并发、高性能和低内存占用。它是根据 2 条款 BSD 类许可证获得许可的，并且可以在 Linux、BSD 变体、Mac OS X、Solaris、AIX、HP-UX 以及其他 *nix 版本上运行。它还具有适用于 Microsoft Windows 的概念验证端口。</p>
<h5 id="docker删除："><a href="#docker删除：" class="headerlink" title="docker删除："></a>docker删除：</h5><p>docker rm 和docker rmi的区别</p>
<ul>
<li>docker rm 用于删除容器，而 docker rmi 用于删除镜像。</li>
<li>docker rm 可以删除正在运行的容器，而 docker rmi 只能删除未被使用的镜像。</li>
<li>删除容器可以使用容器 ID 或容器名称，而删除镜像可以使用镜像 ID 或镜像标签。</li>
</ul>
<p>如何批量删除运行中的容器<br>docker rm -f $(docker ps -q)这里的docker ps -q是列出正在运行的容器，$()是将括号里面执行结果当做参数传递给docker rm 命令。<br>要删除多个镜像，可以将它们列在一个命令中<br>docker rmi image1:tag image2:tag image3:tag<br>要删除多个容器，你可以使用以下命令：<br>docker rm container1 container2 container3 …</p>
<h5 id="2、启动容器"><a href="#2、启动容器" class="headerlink" title="2、启动容器"></a>2、启动容器</h5><p>启动nginx应用容器，并映射88端口，测试的访问</p>
<div class="code-wrapper"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> [OPTIONS] IMAGE [COMMAND] [ARG<span class="hljs-built_in">..</span>.]

【docker <span class="hljs-built_in">run</span>  设置项   镜像名  】 镜像启动运行的命令（镜像里面默认有的
，一般不会写）

<span class="hljs-comment"># -d：后台运行</span>
<span class="hljs-comment"># --restart=always: 开机自启</span>
docker <span class="hljs-built_in">run</span> <span class="hljs-attribute">--name</span>=mynginx   -d  <span class="hljs-attribute">--restart</span>=always -p  88:80  nginx
<span class="hljs-comment">##--name：给启动的镜像生成的容器起一个名字（启动后通过docker ps可以查看启动的容器</span>
其中有个names属性，这里的--name就是设置names属性的，
<span class="hljs-comment">##-d:是后台启动也就是不在当前的终端启动，而是在后台启动。如果不选择这个</span>
就会在当前的终端启动，且占据着当前的终端，无法在当前的终端使用其他命令。
<span class="hljs-comment">##88：80就是端口映射，其中的88是主机的端口，80是容器的端口。</span>
<span class="hljs-comment"># 查看正在运行的容器</span>
docker ps
<span class="hljs-comment"># 查看所有，包括停止运行的容器</span>
docker ps -a
<span class="hljs-comment"># 删除停止的容器（要指定容器的id/名字）</span>
docker rm  容器id/名字
docker rm -f mynginx   #强制删除正在运行中的

<span class="hljs-comment">#停止容器</span>
docker stop 容器id/名字
<span class="hljs-comment">#再次启动</span>
docker start 容器id/名字

<span class="hljs-comment">#应用开机自启</span>
docker update 容器id/名字 <span class="hljs-attribute">--restart</span>=always</code></pre></div>
<h5 id="端口映射："><a href="#端口映射：" class="headerlink" title="端口映射："></a>端口映射：</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693661640773-7d47d1c1-5dc0-43aa-844b-46ebc764ac6e.png#averageHue=%236faab3&clientId=u199a9dfb-f232-4&from=paste&height=270&id=u0a4fc328&originHeight=337&originWidth=609&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=37379&status=done&style=none&taskId=u205d8096-4b14-4c4a-8abc-bbf708f17d8&title=&width=487.2" srcset="/img/loading.gif" lazyload alt="image.png"></h5><p>每个容器相当于一个小的Linux,每个容器都可以设置自己的端口，但是主机也有个端口88.端口映射就是后面我们通过公网ip访问88端口的时候实际上是访问nginx容器的80端口。其中容器启动的时候设置了端口映射可以通过docker ps命名查看到的<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693661968373-5247f323-5162-4d5b-88d6-e5a4021ff1d5.png#averageHue=%23202969&clientId=u199a9dfb-f232-4&from=paste&height=65&id=u215928cb&originHeight=81&originWidth=1155&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=105387&status=done&style=none&taskId=ubeac012b-f2a1-4f31-addf-172b56a0f42&title=&width=924" srcset="/img/loading.gif" lazyload alt="image.png"><br>这里就可以通过公网ip，端口88(注意不要添加http)访问80的nginx.<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693662068364-ed63640f-d323-413e-b3ca-8822b1ab1c30.png#averageHue=%23f6f5f4&clientId=u199a9dfb-f232-4&from=paste&height=286&id=uad59c2ba&originHeight=358&originWidth=806&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=38541&status=done&style=none&taskId=u6fedb865-c35a-4f6e-bafa-ebce95595a8&title=&width=644.8" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h5 id="3、修改容器内容（可以去dockpub官网查看相关容器的用法）"><a href="#3、修改容器内容（可以去dockpub官网查看相关容器的用法）" class="headerlink" title="3、修改容器内容（可以去dockpub官网查看相关容器的用法）"></a>3、修改容器内容（可以去dockpub官网查看相关容器的用法）</h5><p>修改默认的index.html 页面</p>
<h6 id="1、进容器内部修改"><a href="#1、进容器内部修改" class="headerlink" title="1、进容器内部修改"></a>1、进容器内部修改</h6><div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 进入容器内部的系统，修改容器内容</span>
docker <span class="hljs-built_in">exec</span> -it 容器<span class="hljs-built_in">id</span>  /bin/bash
<span class="hljs-comment">##容器相当于一个小的linux这里是进入小linux中的shell当然这里也可以选择</span>
/bin/sh，</code></pre></div>
<h6 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693662555584-0f50aa80-013f-4ef2-b825-2cc4e08f0746.png#averageHue=%231f2869&clientId=u199a9dfb-f232-4&from=paste&height=54&id=u3c41def4&originHeight=68&originWidth=1285&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=95065&status=done&style=none&taskId=uf2b7db52-7049-40c2-8a43-6e9f0820f09&title=&width=1028" srcset="/img/loading.gif" lazyload alt="image.png"></h6><p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693664468867-2975cbcf-a97d-48d0-83a8-dfff635bd638.png#averageHue=%23223071&clientId=u199a9dfb-f232-4&from=paste&height=233&id=uc54b05ff&originHeight=291&originWidth=1427&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=497796&status=done&style=none&taskId=uf5b39572-2572-4c63-b16e-7e914595699&title=&width=1141.6" srcset="/img/loading.gif" lazyload alt="image.png"><br>再次登录的结果：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693664502030-7539f9e6-9251-4553-9953-92cc83e59f6f.png#averageHue=%23e5e4e3&clientId=u199a9dfb-f232-4&from=paste&height=72&id=u98dda7c1&originHeight=90&originWidth=353&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=4561&status=done&style=none&taskId=u58eca5aa-3888-4200-b270-af1659e196d&title=&width=282.4" srcset="/img/loading.gif" lazyload alt="image.png"><br>使用exit就退出容器。</p>
<h6 id="2、挂载数据到外部修改"><a href="#2、挂载数据到外部修改" class="headerlink" title="2、挂载数据到外部修改"></a>2、挂载数据到外部修改</h6><div class="code-wrapper"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> <span class="hljs-attribute">--name</span>=mynginx   \
-d  <span class="hljs-attribute">--restart</span>=always \
-p  88:80 -v /data/html:/usr/share/nginx/html:ro  \
nginx

<span class="hljs-comment"># 修改页面只需要去 主机的 /data/html</span></code></pre></div>
<h6 id="4、提交改变"><a href="#4、提交改变" class="headerlink" title="4、提交改变"></a>4、提交改变</h6><p>将自己修改好的镜像提交</p>
<div class="code-wrapper"><pre><code class="hljs stylus">docker commit <span class="hljs-selector-attr">[OPTIONS]</span> CONTAINER <span class="hljs-selector-attr">[REPOSITORY[:TAG]</span>]

docker commit -<span class="hljs-selector-tag">a</span> <span class="hljs-string">&quot;leifengyang&quot;</span>  -m <span class="hljs-string">&quot;首页变化&quot;</span> <span class="hljs-number">341</span>d81f7504f guignginx:v1.<span class="hljs-number">0</span>
##这个命令有以下几个部分：

-<span class="hljs-selector-tag">a</span> <span class="hljs-string">&quot;leifengyang&quot;</span>：指定作者信息为 <span class="hljs-string">&quot;leifengyang&quot;</span>，表示创建镜像的作者。
-m <span class="hljs-string">&quot;首页变化&quot;</span>：指定提交消息为 <span class="hljs-string">&quot;首页变化&quot;</span>，用于描述这个镜像的变化
或修改。
<span class="hljs-number">341</span>d81f7504f：容器的 ID，表示要基于此容器创建新的镜像。
guignginx:v1.<span class="hljs-number">0</span>：新镜像的名称和标签，这里将创建一个名为 <span class="hljs-string">&quot;guignginx&quot;</span>
，标签为 <span class="hljs-string">&quot;v1.0&quot;</span> 的镜像。
执行该命令后，Docker 将根据容器的当前状态创建一个新的镜像，并将其命
名为 <span class="hljs-string">&quot;guignginx:v1.0&quot;</span>，包含了您在容器中所做的更改。</code></pre></div>
<p>提交改变后，如果后面删除了原来的镜像，想要运行新的镜像的时候，如果用<br>docker run –name&#x3D;mynginx   -d  –restart&#x3D;always -p  88:80  nginx命令<br>运行镜像时，运行的是默认镜像。这个时候可以运行刚刚提交的镜像<br>docker run –name&#x3D;mynginx   -d  –restart&#x3D;always -p  88:80  guignginx:v1.0<br>这样就可以运行和刚刚删除的容器一样的容器而不必重新在新的容器上修改。</p>
<h6 id="镜像保存："><a href="#镜像保存：" class="headerlink" title="镜像保存："></a>镜像保存：</h6><p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693666166503-76847856-5dbd-41c1-b985-d573593d50ee.png#averageHue=%2319191a&clientId=u199a9dfb-f232-4&from=paste&height=198&id=u4444ecb0&originHeight=247&originWidth=855&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=88985&status=done&style=none&taskId=u432223cc-3ccb-4a43-bafa-c67f0b00a05&title=&width=684" srcset="/img/loading.gif" lazyload alt="image.png">	</p>
<h6 id="1、镜像传输"><a href="#1、镜像传输" class="headerlink" title="1、镜像传输"></a>1、镜像传输</h6><p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693666351488-fcc58253-ce49-485b-a0dd-b0f91e801603.png#averageHue=%231a1a1b&clientId=u199a9dfb-f232-4&from=paste&height=387&id=u19a7bd17&originHeight=484&originWidth=951&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=212480&status=done&style=none&taskId=u8e036015-3d49-43b5-9c69-60df8df3dc8&title=&width=760.8" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<div class="code-wrapper"><pre><code class="hljs gauss"><span class="hljs-meta"># 将镜像保存成压缩包</span>
docker <span class="hljs-keyword">save</span> -o abc.tar guignginx:v1<span class="hljs-number">.0</span>

<span class="hljs-meta"># 别的机器加载这个镜像</span>
docker <span class="hljs-keyword">load</span> -i abc.tar
<span class="hljs-meta">#-i 表示输入文件（input file），指定要加载的镜像存储文件的路径。</span>
abc.tar 是一个镜像存储文件，通过该命令，Docker 将读取该文件并加载其
中的镜像到本地 Docker 引擎中。


<span class="hljs-meta"># 离线安装</span></code></pre></div>
<h6 id="5、推送远程仓库"><a href="#5、推送远程仓库" class="headerlink" title="5、推送远程仓库"></a>5、推送远程仓库</h6><p>推送镜像到docker hub；应用市场（前提要注册，然后自己创建一个仓库）</p>
<div class="code-wrapper"><pre><code class="hljs maxima">docker tag <span class="hljs-built_in">local</span>-<span class="hljs-built_in">image</span>:tagname <span class="hljs-built_in">new</span>-repo:tagname
docker <span class="hljs-built_in">push</span> <span class="hljs-built_in">new</span>-repo:tagname</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 把旧镜像的名字，改成仓库要求的新版名字</span>
docker tag guignginx:v1.0 leifengyang/guignginx:v1.0
<span class="hljs-comment">#</span>
通过执行该命令，Docker 将为镜像 guignginx:v1.0 创建一个新的标签
leifengyang/guignginx:v1.0。这个操作不会创建新的镜像副本，
只是为现有镜像添加了一个新的标签。这样，您可以通过两个不同的标签来
引用同一个镜像。
<span class="hljs-comment"># 登录到docker hub，只需要登录一次，下次启动服务器的时(没有退出）不需要登录直接</span>
push
docker login       


docker <span class="hljs-built_in">logout</span>（推送完成镜像后退出）

<span class="hljs-comment"># 推送</span>
docker push leifengyang/guignginx:v1.0


<span class="hljs-comment"># 别的机器下载</span>

docker pull leifengyang/guignginx:v1.0</code></pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693668015733-b27ce633-6a8d-4fbe-bb30-53fe273d574d.png#averageHue=%232c3d7e&clientId=u199a9dfb-f232-4&from=paste&height=370&id=u06e55159&originHeight=462&originWidth=1240&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=692661&status=done&style=none&taskId=uf8fbd6a9-51b2-4511-9175-91e09c11c57&title=&width=992" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h6 id="6、补充"><a href="#6、补充" class="headerlink" title="6、补充"></a>6、补充</h6><div class="code-wrapper"><pre><code class="hljs awk">docker logs 容器名/id   排错

docker exec -it 容器id <span class="hljs-regexp">/bin/</span>bash


<span class="hljs-comment"># docker 经常修改nginx配置文件</span>
docker run -d -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> \
-v <span class="hljs-regexp">/data/</span>html:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html:ro \
-v <span class="hljs-regexp">/data/</span>conf<span class="hljs-regexp">/nginx.conf:/</span>etc<span class="hljs-regexp">/nginx/</span>nginx.conf \
--name mynginx-<span class="hljs-number">02</span> \
nginx
<span class="hljs-comment">#-v /data/html:/usr/share/nginx/html:ro：将主机的 /data/html </span>
目录挂载到容器内的 <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html 目录，并设置为只读模式 (ro)。这样，容器内的 Nginx 将使用主机上的 HTML 文件。
-v <span class="hljs-regexp">/data/</span>conf<span class="hljs-regexp">/nginx.conf:/</span>etc<span class="hljs-regexp">/nginx/</span>nginx.conf：
将主机的 <span class="hljs-regexp">/data/</span>conf/nginx.conf 文件挂载到容器内的
<span class="hljs-regexp">/etc/</span>nginx/nginx.conf 文件，用于替换容器内的 Nginx 配置文件。
--name mynginx-<span class="hljs-number">02</span>：指定容器的名称为 mynginx-<span class="hljs-number">02</span>。
nginx：要运行的镜像名称。


<span class="hljs-comment">#把容器指定位置的东西复制出来 </span>
docker cp <span class="hljs-number">5</span>eff66eec7e1:<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf  /</span>data<span class="hljs-regexp">/conf/</span>nginx.conf
<span class="hljs-comment">#把外面的内容复制到容器里面</span>
docker cp  <span class="hljs-regexp">/data/</span>conf<span class="hljs-regexp">/nginx.conf  5eff66eec7e1:/</span>etc<span class="hljs-regexp">/nginx/</span>nginx.conf</code></pre></div>
<h3 id="进阶实战"><a href="#进阶实战" class="headerlink" title="进阶实战"></a>进阶实战</h3><h4 id="1、编写自己的应用"><a href="#1、编写自己的应用" class="headerlink" title="1、编写自己的应用"></a>1、编写自己的应用</h4><p>编写一个HelloWorld应用<br><a target="_blank" rel="noopener" href="https://start.spring.io/">https://start.spring.io/</a></p>
<p>示例代码： <a target="_blank" rel="noopener" href="https://gitee.com/leifengyang/java-demo.git">https://gitee.com/leifengyang/java-demo.git</a></p>
<h5 id="2、将应用打包成镜像"><a href="#2、将应用打包成镜像" class="headerlink" title="2、将应用打包成镜像"></a>2、将应用打包成镜像</h5><p>编写Dockerfile将自己的应用打包镜像</p>
<h5 id="1、以前"><a href="#1、以前" class="headerlink" title="1、以前"></a>1、以前</h5><p>Java为例</p>
<ul>
<li>SpringBoot打包成可执行jar</li>
<li>把jar包上传给服务</li>
<li>服务器运行java -jar</li>
</ul>
<h5 id="2、现在"><a href="#2、现在" class="headerlink" title="2、现在"></a>2、现在</h5><p>所有机器都安装Docker，任何应用都是镜像，所有机器都可以运行</p>
<h5 id="3、怎么打包-Dockerfile"><a href="#3、怎么打包-Dockerfile" class="headerlink" title="3、怎么打包-Dockerfile"></a>3、怎么打包-Dockerfile</h5><div class="code-wrapper"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span>-jdk-slim
<span class="hljs-keyword">LABEL</span><span class="language-bash"> maintainer=leifengyang</span>

<span class="hljs-keyword">COPY</span><span class="language-bash"> target/*.jar   /app.jar</span>

<span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-jar&quot;</span>,<span class="hljs-string">&quot;/app.jar&quot;</span>]</span></code></pre></div>
<div class="code-wrapper"><pre><code class="hljs mipsasm">docker <span class="hljs-keyword">build </span>-t <span class="hljs-keyword">java-demo:v1.0 </span>.</code></pre></div>
<p>思考：<br>每个应用每次打包，都需要本地编译、再上传服务器、再进行docker构建，如果有1000个应用要打包镜像怎么办？有没有更好的方式？</p>
<h5 id="3、启动容器"><a href="#3、启动容器" class="headerlink" title="3、启动容器"></a>3、启动容器</h5><p>启动应用容器</p>
<div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -d -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> --name myjava-app java-demo:v1.<span class="hljs-number">0</span></code></pre></div>
<p>分享镜像</p>
<div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># 登录docker hub</span>
<span class="hljs-attribute">docker</span> login

<span class="hljs-comment">#给旧镜像起名</span>
<span class="hljs-attribute">docker</span> tag java-demo:v1.<span class="hljs-number">0</span>  leifengyang/java-demo:v1.<span class="hljs-number">0</span>

<span class="hljs-comment"># 推送到docker hub</span>
<span class="hljs-attribute">docker</span> push leifengyang/java-demo:v1.<span class="hljs-number">0</span>

<span class="hljs-comment"># 别的机器</span>
<span class="hljs-attribute">docker</span> pull leifengyang/java-demo:v1.<span class="hljs-number">0</span>

<span class="hljs-comment"># 别的机器运行</span>
<span class="hljs-attribute">docker</span> run -d -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> --name myjava-app java-demo:v1.<span class="hljs-number">0</span></code></pre></div>
<h5 id="4、部署中间件"><a href="#4、部署中间件" class="headerlink" title="4、部署中间件"></a>4、部署中间件</h5><p><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693720409476-cdc02b96-0977-43bb-8468-a5e95524479e.png#averageHue=%2382bec8&clientId=ubd7ce99a-c7e7-4&from=paste&height=362&id=XUcBO&originHeight=452&originWidth=909&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=112189&status=done&style=none&taskId=u246d6b70-14f7-4ec4-86d9-7f461209255&title=&width=727.2" srcset="/img/loading.gif" lazyload alt="image.png"><br>部署一个Redis+应用，尝试应用操作Redis产生数据</p>
<div class="code-wrapper"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="language-bash"> [OPTIONS] IMAGE [COMMAND] [ARG...]</span>

<span class="hljs-comment">#redis使用自定义配置文件启动</span>

docker <span class="hljs-keyword">run</span><span class="language-bash"> -v /data/redis/redis.conf:/etc/redis/redis.conf \</span>
<span class="language-bash">-v /data/redis/data:/data \</span>
<span class="language-bash">-d --name myredis \</span>
<span class="language-bash">-p 6379:6379 \</span>
<span class="language-bash">redis:latest  redis-server /etc/redis/redis.conf</span>

</code></pre></div>
<p>Redis配置密码：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/28066124/1693721336317-8222233b-4a16-424e-aa2f-c6ddb6ad2f6c.png#averageHue=%23151516&clientId=ubd7ce99a-c7e7-4&from=paste&height=190&id=u6e8c45ae&originHeight=237&originWidth=583&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=35158&status=done&style=none&taskId=u26f9ab92-c709-4582-88b0-ec1e8978e04&title=&width=466.4" srcset="/img/loading.gif" lazyload alt="image.png"><br>连接Redis:<br>测试使用redis:</p>
<h2 id="1、NoSQL"><a href="#1、NoSQL" class="headerlink" title="1、NoSQL"></a>1、NoSQL</h2><h3 id="Redis整合"><a href="#Redis整合" class="headerlink" title="Redis整合"></a>Redis整合</h3><p>**Redis不会的同学：参照 阳哥-《Redis7》 **<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13R4y1v7sP?p=1"><strong>https://www.bilibili.com/video/BV13R4y1v7sP?p=1</strong></a><br>**HashMap： key：value</p>
<p>**</p>
<h2 id="1-场景整合"><a href="#1-场景整合" class="headerlink" title="1. 场景整合"></a><strong>1. 场景整合</strong></h2><p><strong>依赖导入</strong></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<p>配置</p>
<div class="code-wrapper"><pre><code class="hljs haskell"><span class="hljs-title">spring</span>.<span class="hljs-class"><span class="hljs-keyword">data</span>.redis.host=192.168.200.100</span>
<span class="hljs-title">spring</span>.<span class="hljs-class"><span class="hljs-keyword">data</span>.redis.password=<span class="hljs-type">Lfy123</span>!@!</span></code></pre></div>
<p><strong>测试</strong></p>
<div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@Autowired</span>
StringRedisTemplate redisTemplate;

<span class="hljs-variable">@Test</span>
void <span class="hljs-built_in">redisTest</span>()&#123;
    <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;1234&quot;</span>);
    <span class="hljs-selector-tag">Assertions</span><span class="hljs-selector-class">.assertEquals</span>(<span class="hljs-string">&quot;1234&quot;</span>,redisTemplate.<span class="hljs-built_in">opsForValue</span>().<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;a&quot;</span>));
&#125;</code></pre></div>
<h2 id="2-自动配置原理-1"><a href="#2-自动配置原理-1" class="headerlink" title="2. 自动配置原理"></a><strong>2. 自动配置原理</strong></h2><ol>
<li>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports中导入了<code>RedisAutoConfiguration</code>、RedisReactiveAutoConfiguration和RedisRepositoriesAutoConfiguration。所有属性绑定在<code>RedisProperties</code>中</li>
<li>RedisReactiveAutoConfiguration属于响应式编程，不用管。RedisRepositoriesAutoConfiguration属于 JPA 操作，也不用管</li>
<li>RedisAutoConfiguration 配置了以下组件<ol>
<li>LettuceConnectionConfiguration： 给容器中注入了连接工厂LettuceConnectionFactory，和操作 redis 的客户端DefaultClientResources。</li>
<li><code>RedisTemplate&lt;Object, Object&gt;</code>： 可给 redis 中存储任意对象，会使用 jdk 默认序列化方式。</li>
<li><code>StringRedisTemplate</code>： 给 redis 中存储字符串，如果要存对象，需要开发人员自己进行序列化。key-value都是字符串进行操作··,如果key和value中有一个是实体对象可以将对象转化为json数据（字符串）来进行操作、，</li>
</ol>
</li>
</ol>
<h2 id="3-定制化"><a href="#3-定制化" class="headerlink" title="3. 定制化"></a>3. 定制化</h2><div class="code-wrapper"><pre><code class="hljs pgsql">@<span class="hljs-keyword">Configuration</span>
<span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> AppRedisConfiguration &#123;


    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 允许Object类型的key-value，都可以被转为json进行存储。</span>
<span class="hljs-comment">     * @param redisConnectionFactory 自动配置好了连接工厂</span>
<span class="hljs-comment">     * @return</span>
<span class="hljs-comment">     */</span>
    @Bean
    <span class="hljs-built_in">public</span> RedisTemplate&lt;<span class="hljs-keyword">Object</span>, <span class="hljs-keyword">Object</span>&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) &#123;
        RedisTemplate&lt;<span class="hljs-keyword">Object</span>, <span class="hljs-keyword">Object</span>&gt; template = <span class="hljs-built_in">new</span> RedisTemplate&lt;&gt;();
        <span class="hljs-keyword">template</span>.setConnectionFactory(redisConnectionFactory);
        //把对象转为<span class="hljs-type">json</span>字符串的序列化工具
        <span class="hljs-keyword">template</span>.setDefaultSerializer(<span class="hljs-built_in">new</span> GenericJackson2JsonRedisSerializer());
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">template</span>;
    &#125;
&#125;</code></pre></div>
<h3 id="2-redis客户端"><a href="#2-redis客户端" class="headerlink" title="2. redis客户端"></a><strong>2. redis客户端</strong></h3><blockquote>
<p><strong>RedisTemplate、StringRedisTemplate： 操作redis的工具类</strong></p>
<ul>
<li><strong>要从redis的连接工厂获取链接才能操作redis</strong></li>
<li><strong>Redis客户端</strong><ul>
<li><strong>Lettuce： 默认</strong></li>
<li><strong>Jedis：可以使用以下切换</strong></li>
</ul>
</li>
</ul>
</blockquote>
<div class="code-wrapper"><pre><code class="hljs xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.lettuce<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lettuce-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--        切换 jedis 作为操作redis的底层客户端--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
<h3 id="3-配置参考"><a href="#3-配置参考" class="headerlink" title="3. 配置参考"></a><strong>3. 配置参考</strong></h3><div class="code-wrapper"><pre><code class="hljs stylus">spring<span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span>.host=<span class="hljs-number">8.130</span>.<span class="hljs-number">74.183</span>
spring<span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span>.port=<span class="hljs-number">6379</span>
<span class="hljs-selector-id">#spring</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span>.client-type=lettuce

#设置lettuce的底层参数
<span class="hljs-selector-id">#spring</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span><span class="hljs-selector-class">.lettuce</span><span class="hljs-selector-class">.pool</span>.enabled=true
<span class="hljs-selector-id">#spring</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span><span class="hljs-selector-class">.lettuce</span><span class="hljs-selector-class">.pool</span>.max-active=<span class="hljs-number">8</span>

spring<span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span>.client-type=jedis
spring<span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span><span class="hljs-selector-class">.jedis</span><span class="hljs-selector-class">.pool</span>.enabled=true
spring<span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span><span class="hljs-selector-class">.jedis</span><span class="hljs-selector-class">.pool</span>.max-active=<span class="hljs-number">8</span></code></pre></div>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p><strong>1.</strong></p>
<h2 id="消息服务："><a href="#消息服务：" class="headerlink" title="消息服务："></a>消息服务：</h2><h2 id="1-docker安装kafka（没学完）"><a href="#1-docker安装kafka（没学完）" class="headerlink" title="1.docker安装kafka（没学完）"></a>1.docker安装kafka（没学完）</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/y393016244/article/details/126405864">Docker安装Kafka教程（超详细）_乾坤鸟的博客-CSDN博客</a><br>docker network create app-tier –driver bridge</p>
<div class="code-wrapper"><pre><code class="hljs livecodeserver">使用命令 docker network <span class="hljs-built_in">create</span> app-tier <span class="hljs-comment">--driver bridge 可以创建一个</span>
名为 <span class="hljs-string">&quot;app-tier&quot;</span> 的 Docker 网络，并使用桥接（bridge）驱动程序。

这个命令会创建一个桥接网络，桥接网络是 Docker 中默认的网络驱动程序。
桥接网络用于连接运行在同一 Docker 主机上的多个容器，使它们能够使用容
器名称作为主机名进行通信。

通过创建 <span class="hljs-string">&quot;app-tier&quot;</span> 网络，您可以启动容器并将它们连接到该网络，以便
实现容器之间的通信。同一网络内的容器可以使用它们的容器名称作为主机名
来相互访问。</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -d --name kafka-server \
    --network app-tier \
    -p 9092:9092 \
    -e <span class="hljs-attribute">ALLOW_PLAINTEXT_LISTENER</span>=<span class="hljs-literal">yes</span> \
    -e <span class="hljs-attribute">KAFKA_CFG_ZOOKEEPER_CONNECT</span>=zookeeper-server:2181 \
    -e <span class="hljs-attribute">KAFKA_CFG_ADVERTISED_LISTENERS</span>=PLAINTEXT://8.130.50.249:9092\
    bitnami/kafka:latest
</code></pre></div>
<p>2.安装kafkaUi<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42987796/article/details/129799473">【docker】docker安装带ui界面的kafka_docker ui 安装_努力的gopher的博客-CSDN博客</a></p>
<div class="code-wrapper"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2&quot;</span>

<span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">zookeeper</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">docker.io/bitnami/zookeeper:3.8</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;22181:2181&quot;</span>
    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;zookeeper_data:/bitnami&quot;</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ALLOW_ANONYMOUS_LOGIN=yes</span>
  <span class="hljs-attribute">kafka</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">kafka1</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">docker.io/bitnami/kafka:3.4</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9192:9092&quot;</span>
    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;kafka_data:/bitnami&quot;</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ALLOW_PLAINTEXT_LISTENER=yes</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://8.130.50.249:9192</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE=true</span>
    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span>

  <span class="hljs-attribute">kafka-ui</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">provectuslabs/kafka-ui:latest</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">kafka-ui</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">10010:8080</span>
    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CLUSTERS_0_NAME=local</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka1:9092</span>

<span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">zookeeper_data</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">driver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">local</span>
  <span class="hljs-attribute">kafka_data</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">driver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">local</span>

</code></pre></div>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/springboot2/" class="category-chain-item">springboot2</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/springboot2/" class="print-no-link">#springboot2</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Springboot学习笔记</div>
      <div>http://www.bojiboqi.fun/2024/01/26/Springboot_/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>山麋一笑</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年1月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/01/26/Vue_/" title="Vue学习笔记">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Vue学习笔记</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/01/26/%E6%9D%82%E8%AE%B0%EF%BC%9A/" title="杂记">
                        <span class="hidden-mobile">杂记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"NkSNF5NG3Uup8tDgwIfBlJ9d-gzGzoHsz","appKey":"Y2GZN9C0SLdOpVG4hMb1TEJM","path":"window.location.pathname","placeholder":"如有错误还望指正","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"https://nksnf5ng.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
  



</div>



  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/DynamicLine.js"></script>
<script src="/js/custom.js"></script>
<script src="/js/yinhua.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>

<!-- hexo injector body_end start --><script src="/js/backgroundize.js"></script>
  <link defer rel="stylesheet" href="/css/backgroundize.css" />
  <!-- hexo injector body_end end --></body>
</html>
