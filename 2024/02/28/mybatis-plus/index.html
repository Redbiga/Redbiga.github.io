<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>mybatisPlus | 山麋一笑</title><meta name="author" content="山麋一笑"><meta name="copyright" content="山麋一笑"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="前言： 采用的是黑马的mybatisPlus教程! mybatis教程！ 使用的springboot3和JDK17完成的！和黑马的有点区别！ 知识点： 1.Hutool 是一个由 Java 编写的强大、完善且易用的 Java 工具类库，它封装了很多常用的 Java 方法，包括但不限于日期时间处理、字符串处理、文件操作、网络请求、加密解密、数据验证、反射工具等。通过引入 hutool-all 依">
<meta property="og:type" content="article">
<meta property="og:title" content="mybatisPlus">
<meta property="og:url" content="http://www.bojiboqi.fun/2024/02/28/mybatis-plus/index.html">
<meta property="og:site_name" content="山麋一笑">
<meta property="og:description" content="前言： 采用的是黑马的mybatisPlus教程! mybatis教程！ 使用的springboot3和JDK17完成的！和黑马的有点区别！ 知识点： 1.Hutool 是一个由 Java 编写的强大、完善且易用的 Java 工具类库，它封装了很多常用的 Java 方法，包括但不限于日期时间处理、字符串处理、文件操作、网络请求、加密解密、数据验证、反射工具等。通过引入 hutool-all 依">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.dmoe.cc/random.php?5386">
<meta property="article:published_time" content="2024-02-28T13:02:28.412Z">
<meta property="article:modified_time" content="2024-02-28T10:44:05.307Z">
<meta property="article:author" content="山麋一笑">
<meta property="article:tag" content="mybatis">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.dmoe.cc/random.php?5386"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.bojiboqi.fun/2024/02/28/mybatis-plus/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'mybatisPlus',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-28 18:44:05'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href='/css/footer.css'><link rel="stylesheet" href='/css/wave.css'><link rel="stylesheet" href='/css/universe.css'><link rel="stylesheet" href='/css/custom.css'><link rel="stylesheet" href="/css/transpancy.css"><link rel="stylesheet" href="/css/runtime.css"><link rel="stylesheet" href="/css/darkRead.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/gh/zhheo/Post-Abstract-AI@0.15.2/tianli_gpt.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="山麋一笑" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">56</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-list"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://www.dmoe.cc/random.php?5386')"><nav id="nav"><span id="blog-info"><a href="/" title="山麋一笑"><span class="site-name">山麋一笑</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-list"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">mybatisPlus</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-02-28T13:02:28.412Z" title="发表于 2024-02-28 21:02:28">2024-02-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-02-28T10:44:05.307Z" title="更新于 2024-02-28 18:44:05">2024-02-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/springboot3/">springboot3</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>54分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="mybatisPlus"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"> <meta name="referrer" content="no-referrer">
<h2 id="前言：">前言：</h2>
<p>采用的是黑马的mybatisPlus教程!<br>
<a target="_blank" rel="noopener" href="https://b11et3un53m.feishu.cn/wiki/PsyawI04ei2FQykqfcPcmd7Dnsc">mybatis教程！</a><br>
使用的springboot3和JDK17完成的！和黑马的有点区别！</p>
<h2 id="知识点：">知识点：</h2>
<p>1.Hutool 是一个由 Java 编写的强大、完善且易用的 Java 工具类库，它封装了很多常用的 Java 方法，包括但不限于日期时间处理、字符串处理、文件操作、网络请求、加密解密、数据验证、反射工具等。通过引入 hutool-all 依赖，开发者可以方便地在项目中使用 Hutool 提供的各种便捷工具方法，以减少重复造轮子的工作，提高开发效率<br>
2.@RequiredArgsConstructor 是 Lombok 库中的一个注解，它能够自动生成构造方法。当类中包含 final 或者非 null 的不可变字段时，Lombok 会为这些字段生成一个构造器，确保在创建对象实例时必须为这些字段提供值。<br>
3.接口中可以有default修饰的方法！default修饰的方法为默认方法可以不用重写！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer money)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">super</span>.getById(id);</span><br><span class="line">        <span class="comment">// 2.判断用户状态</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span> || user.getStatus() == UserStatus.FROZEN) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户状态异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.判断用户余额</span></span><br><span class="line">        <span class="keyword">if</span> (user.getBalance() &lt; money) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.扣减余额</span></span><br><span class="line">        baseMapper.deductMoneyById(id, money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 上面是mybatisPlus中的代码片段；其中的IUserService接口继承了IService接口，IService中</span></span><br><span class="line"><span class="comment">// 有一个default修饰的getById方法，我们可以super.getById(id);调用该方法实现查询效果！</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String username; <span class="comment">// final 字段或 @NonNull 注解的字段</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lombok 会自动生成以下构造方法：</span></span><br><span class="line">    <span class="comment">// public User(String username, int age) &#123;</span></span><br><span class="line">    <span class="comment">//     this.username = username;</span></span><br><span class="line">    <span class="comment">//     this.age = age;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，由于 username 和 age 都是 final 字段，@RequiredArgsConstructor 会生成一个构造方法，要求在创建 User 类的新实例时必须传入这两个参数的值。这样可以确保这些关键字段在对象初始化时就具有有效的值，有助于防止 NullPointerException 等问题的发生。<br>
3.@RequestParam 和@PathVariable的区别：<br>
@RequestParam从请求中提取查询参数，也就是从url后面的？开始的数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;根据id集合查询用户&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryUserByIds</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;z List&lt;Long&gt; ids)</span></span></span><br><span class="line"><span class="params">// <span class="meta">@RequestParam(&quot;ids&quot;)</span>注解处理的是请求路径后面的参数：</span></span><br><span class="line"><span class="params">// http://localhost:<span class="number">8080</span>/users?ids=<span class="number">1</span>,<span class="number">2</span></span></span><br></pre></td></tr></table></figure>
<p>@PathVariable是以路径中某段为参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;根据id查询用户&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserVO <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long userId)</span></span><br><span class="line"><span class="comment">// http://localhost:8080/users/1</span></span><br></pre></td></tr></table></figure>
<p>4.主键，外键，虚拟外键：<br>
<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dgp-zjz/p/16470132.html">https://www.cnblogs.com/dgp-zjz/p/16470132.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">主键：用来保证数据完整性</span><br><span class="line"> </span><br><span class="line">外键：用来和其他表建立联系用的</span><br><span class="line"> </span><br><span class="line">索引：是提高查询排序的速度</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主键：主键只能有一个</span><br><span class="line">外键：一个表可以有多个外键</span><br><span class="line">索引：一个表可以有多个唯一索引</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PRIMARY KEY设置主键 (&#x27;设置的主键字段&#x27;),</span><br><span class="line">KEY `自定义KEY名` (`定义外键字段名`),</span><br><span class="line">CONSTRAINT限制 `自定义KEY名` FOREIGN KEY外键 (`自定外键字段名`) REFERENCES 引用 `引用表` (`引用字段设为外键`));</span><br></pre></td></tr></table></figure>
<p>外键和主键建立了关系，那么外键所在的表中数据和主键表有关联关系就无法删除外键中的数据的！<br>
虚拟外键表示的是表之间有逻辑上的关联关系！其实际上并没有实际的强制性约束！<br>
5.mybatis-plus 开启与关闭 SQL 日志打印<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/jiangchao858/article/details/115676371">mybatis-plus 开启与关闭 SQL 日志打印_mybatis plus 开启sql记录-CSDN博客</a><br>
<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Mybatis&amp;spm=1001.2101.3001.7020">Mybatis</a>-plus 需要通过下面的方式开启控制台 SQL 日志打印：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  configuration:</span><br><span class="line">    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>6.DTO(Data Transfer Object）是数据传输对象！一般用来映射传输过程中的数据的！<br>
7.@Date  :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用@Data注解可以简化Java类的编写，减少样板代码，并提高代码的可读性和可维护性。当在类级别上使用@Data注解时，Lombok会自动为该类的所有非静态字段生成以下方法：</span><br><span class="line">Getter方法：自动生成所有非静态字段的对应getter方法。</span><br><span class="line">Setter方法：自动生成所有非静态字段的对应setter方法。</span><br><span class="line">toString()方法：生成一个包含所有字段的字符串表示，方便调试和日志输出。</span><br><span class="line">equals()方法：自动生成基于所有字段的相等比较方法。</span><br><span class="line">hashCode()方法：自动生成基于所有字段的散列码计算方法。</span><br></pre></td></tr></table></figure>
<h2 id="MyBatis-Plus的特性">MyBatis Plus的特性:</h2>
<ul>
<li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
<li><strong>损耗小</strong>：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li>
<li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求</li>
<li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li><strong>支持主键自动生成</strong>：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li>
<li><strong>支持 ActiveRecord 模式</strong>：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li>
<li><strong>支持自定义全局通用操作</strong>：支持全局通用方法注入（ Write once, use anywhere ）</li>
<li><strong>内置代码生成器</strong>：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li>
<li><strong>内置分页插件</strong>：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li>
<li><strong>分页插件支持多种数据库</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer 等多种数据库</li>
<li><strong>内置性能分析插件</strong>：可输出 SQL 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li>
<li><strong>内置全局拦截插件</strong>：提供全表 delete 、 update 操作智能分析阻断，也可自定义拦截规则，预防误操作.</li>
</ul>
<h2 id="快速入门">快速入门:</h2>
<h4 id="引入依赖：">引入依赖：</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--由于springboot3和mybatisplus兼容性的问题这里引入的依赖最好是这样的！  --&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="注意：">注意：</h4>
<p>mapper接口要继承BaseMapper<User> 这里的User对应查询结果的类型！同时要注意在启动类上添加组件@Mapper注解 不然spring扫描不到Mapper接口类就无法注入到容器中了！当然也可以在Mapper接口上添加@Mapper 注解  ；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MybatisPlus就是根据PO实体的信息来推断出表的信息，从而生成SQL的。默认情况下：</span><br><span class="line">- MybatisPlus会把PO实体的类名驼峰转下划线作为表名</span><br><span class="line">- MybatisPlus会把PO实体的所有变量名驼峰转下划线作为表的字段名，并根据变量类型推断字段类型</span><br><span class="line">- MybatisPlus会把名为id的字段作为主键</span><br></pre></td></tr></table></figure>
<h4 id="常见注解：">常见注解：</h4>
<h5 id="TableName：">@TableName：</h5>
<ul>
<li>描述：表名注解，标识实体类对应的表</li>
<li>使用位置：实体类</li>
</ul>
<p>TableName注解除了指定表名以外，还可以指定很多其它属性：</p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>类型</strong></th>
<th><strong>必须指定</strong></th>
<th><strong>默认值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>String</td>
<td>否</td>
<td>“”</td>
<td>表名</td>
</tr>
<tr>
<td>schema</td>
<td>String</td>
<td>否</td>
<td>“”</td>
<td>schema</td>
</tr>
<tr>
<td>keepGlobalPrefix</td>
<td>boolean</td>
<td>否</td>
<td>false</td>
<td>是否保持使用全局的 tablePrefix 的值（当全局 tablePrefix 生效时）</td>
</tr>
<tr>
<td>resultMap</td>
<td>String</td>
<td>否</td>
<td>“”</td>
<td>xml 中 resultMap 的 id（用于满足特定类型的实体类对象绑定）</td>
</tr>
<tr>
<td>autoResultMap</td>
<td>boolean</td>
<td>否</td>
<td>false</td>
<td>是否自动构建 resultMap 并使用（如果设置 resultMap 则不会进行 resultMap 的自动构建与注入）</td>
</tr>
<tr>
<td>excludeProperty</td>
<td>String[]</td>
<td>否</td>
<td>{}</td>
<td>需要排除的属性名 @since 3.3.1</td>
</tr>
</tbody>
</table>
<h5 id="TableId：">@TableId：</h5>
<ul>
<li>描述：主键注解，标识实体类中的主键字段</li>
<li>使用位置：实体类的主键字段</li>
</ul>
<p>TableId注解支持两个属性：</p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>类型</strong></th>
<th><strong>必须指定</strong></th>
<th><strong>默认值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>String</td>
<td>否</td>
<td>“”</td>
<td>表名</td>
</tr>
<tr>
<td>type</td>
<td>Enum</td>
<td>否</td>
<td>IdType.NONE</td>
<td>指定主键类型</td>
</tr>
</tbody>
</table>
<p>IdType支持的类型有：</p>
<table>
<thead>
<tr>
<th><strong>值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>AUTO</td>
<td>数据库 ID 自增</td>
</tr>
<tr>
<td>NONE</td>
<td>无状态，该类型为未设置主键类型（注解里等于跟随全局，全局里约等于 INPUT）</td>
</tr>
<tr>
<td>INPUT</td>
<td>insert 前自行 set 主键值</td>
</tr>
<tr>
<td>ASSIGN_ID</td>
<td>分配 ID(主键类型为 Number(Long 和 Integer)或 String)(since 3.3.0),使用接口IdentifierGenerator的方法nextId(默认实现类为DefaultIdentifierGenerator雪花算法)</td>
</tr>
<tr>
<td>ASSIGN_UUID</td>
<td>分配 UUID,主键类型为 String(since 3.3.0),使用接口IdentifierGenerator的方法nextUUID(默认 default 方法)</td>
</tr>
<tr>
<td><s>ID_WORKER</s></td>
<td>分布式全局唯一 ID 长整型类型(please use ASSIGN_ID)</td>
</tr>
<tr>
<td><s>UUID</s></td>
<td>32 位 UUID 字符串(please use ASSIGN_UUID)</td>
</tr>
<tr>
<td><s>ID_WORKER_STR</s></td>
<td>分布式全局唯一 ID 字符串类型(please use ASSIGN_ID)</td>
</tr>
</tbody>
</table>
<p>这里比较常见的有三种：</p>
<ul>
<li>AUTO：利用数据库的id自增长</li>
<li>INPUT：手动生成id</li>
<li>ASSIGN_ID：雪花算法生成Long类型的全局唯一id，这是默认的ID策略</li>
</ul>
<h5 id="TableField：">@TableField：</h5>
<p>描述：普通字段注解<br>
一般情况下我们并不需要给字段添加@TableField注解，一些特殊情况除外：</p>
<ul>
<li>成员变量名与数据库字段名不一致</li>
<li>成员变量是以isXXX命名，按照JavaBean的规范，MybatisPlus识别字段时会把is去除，这就导致与数据库不符。</li>
<li>成员变量名与数据库一致，但是与数据库的关键字冲突。使用@TableField注解给字段名添加转义字符：``</li>
</ul>
<h4 id="常见配置：">常见配置：</h4>
<p>大多数的配置都有默认值，因此我们都无需配置。但还有一些是没有默认值的，例如:</p>
<ul>
<li>实体类的别名扫描包</li>
<li>全局id类型</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  type-aliases-package: com.itheima.mp.domain.po</span><br><span class="line">  global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      id-type: auto # 全局id类型为自增长</span><br></pre></td></tr></table></figure>
<p>需要注意的是，MyBatisPlus也支持手写SQL的，而mapper文件的读取地址可以自己配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  mapper-locations: &quot;classpath*:/mapper/**/*.xml&quot; # Mapper.xml文件地址，当前这个是默认值。</span><br></pre></td></tr></table></figure>
<p>可以看到默认值是classpath*:/mapper/**/*.xml，也就是说我们只要把mapper.xml文件放置这个目录下就一定会被加载。<br>
xml书写样式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mp.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM user WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的resuletType需要在spring的mybatis-plus配置中配置如下配置才能使用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  mapper-locations: &quot;classpath*:/mapper/**/*.xml&quot; # Mapper.xml文件地址，当前这个是默认值。</span><br><span class="line">  type-aliases-package: com.example.mp.po</span><br><span class="line"><span class="comment">&lt;!-- mapper-locations该配置是让resultType可以直接使用类名，而不是全类名</span></span><br><span class="line"><span class="comment">mapper-locations是为了定位mapper.xml文件的位置</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="核心功能：">核心功能：</h2>
<h4 id="QueryWrapper：">QueryWrapper：</h4>
<p>无论是修改、删除、查询，都可以使用QueryWrapper来构建查询条件。接下来看一些例子： <strong>查询</strong>：查询出名字中带o的，存款大于等于1000元的人。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.构建查询条件 where name like &quot;%o%&quot; AND balance &gt;= 1000</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;()</span><br><span class="line">    .select(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;balance&quot;</span>)</span><br><span class="line">    .like(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;o&quot;</span>)</span><br><span class="line">    .ge(<span class="string">&quot;balance&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// 2.查询数据</span></span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Wrapper是包装的意思；上面使用的select表示是一个select语句的包装！上面采用的是链式编程；</span></span><br><span class="line"><span class="comment">// .like对应sql语句中的like关键字！ge对应的是大于和等于！</span></span><br></pre></td></tr></table></figure>
<p><strong>更新</strong>：更新用户名为jack的用户的余额为2000，代码如下：：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateByQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.构建查询条件 where name = &quot;Jack&quot;</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.更新数据，user中非null字段都会作为set语句</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setBalance(<span class="number">2000</span>);</span><br><span class="line">    userMapper.update(user, wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="UpdateWrapper：">UpdateWrapper：</h4>
<p>基于BaseMapper中的update方法更新时只能直接赋值，对于一些复杂的需求就难以实现。 例如：更新id为1,2,4的用户的余额，扣200，对应的SQL应该是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE user SET balance = balance - 200 WHERE id in (1, 2, 4)</span><br></pre></td></tr></table></figure>
<p>SET的赋值结果是基于字段现有值的，这个时候就要利用UpdateWrapper中的setSql功能了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testUpdateWrapper() &#123;</span><br><span class="line">    List&lt;Long&gt; ids = List.of(1L, 2L, 4L);</span><br><span class="line">    // 1.生成SQL</span><br><span class="line">    UpdateWrapper&lt;User&gt; wrapper = new UpdateWrapper&lt;User&gt;()</span><br><span class="line">            .setSql(&quot;balance = balance - 200&quot;) // SET balance = balance - 200</span><br><span class="line">            .in(&quot;id&quot;, ids); // WHERE id in (1, 2, 4)</span><br><span class="line">        // 2.更新，注意第一个参数可以给null，也就是不填更新字段和数据，</span><br><span class="line">    // 而是基于UpdateWrapper中的setSQL来更新</span><br><span class="line">    userMapper.update(null, wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="LambdaQueryWrapper：">LambdaQueryWrapper：</h4>
<p>无论是QueryWrapper还是UpdateWrapper在构造条件的时候都需要写死字段名称，会出现字符串魔法值。这在编程规范中显然是不推荐的。 那怎么样才能不写字段名，又能知道字段名呢？<br>
其中一种办法是基于变量的gettter方法结合反射技术。因此我们只要将条件对应的字段的getter方法传递给MybatisPlus，它就能计算出对应的变量名了。而传递方法可以使用JDK8中的方法引用和Lambda表达式。 因此MybatisPlus又提供了一套基于Lambda的Wrapper，包含两个：</p>
<ul>
<li>LambdaQueryWrapper</li>
<li>LambdaUpdateWrapper</li>
</ul>
<p>分别对应QueryWrapper和UpdateWrapper<br>
其使用方式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testLambdaQueryWrapper() &#123;</span><br><span class="line">    // 1.构建条件 WHERE username LIKE &quot;%o%&quot; AND balance &gt;= 1000</span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.lambda()</span><br><span class="line">            .select(User::getId, User::getUsername, User::getInfo, User::getBalance)</span><br><span class="line">            .like(User::getUsername, &quot;o&quot;)</span><br><span class="line">            .ge(User::getBalance, 1000);</span><br><span class="line">    // 2.查询</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义SQL：">自定义SQL：</h2>
<h4 id="基本用法：">基本用法：</h4>
<p>以当前案例来说，我们可以这样写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testCustomWrapper() &#123;</span><br><span class="line">    // 1.准备自定义查询条件</span><br><span class="line">    List&lt;Long&gt; ids = List.of(1L, 2L, 4L);</span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;User&gt;().in(&quot;id&quot;, ids);</span><br><span class="line"></span><br><span class="line">    // 2.调用mapper的自定义方法，直接传递Wrapper</span><br><span class="line">    userMapper.deductBalanceByIds(200, wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在UserMapper中自定义SQL：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.mapper;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line">import com.itheima.mp.domain.po.User;</span><br><span class="line">import org.apache.ibatis.annotations.Param;</span><br><span class="line">import org.apache.ibatis.annotations.Update;</span><br><span class="line">import org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line">public interface UserMapper extends BaseMapper&lt;User&gt; &#123;</span><br><span class="line">    @Select(&quot;UPDATE user SET balance = balance - #&#123;money&#125; $&#123;ew.customSqlSegment&#125;&quot;)</span><br><span class="line">    void deductBalanceByIds(@Param(&quot;money&quot;) int money, @Param(&quot;ew&quot;) QueryWrapper&lt;User&gt; wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="多表关联：">多表关联：</h4>
<p>理论上来讲MyBatisPlus是不支持多表查询的，不过我们可以利用Wrapper中自定义条件结合自定义SQL来实现多表查询的效果。 例如，我们要查询出所有收货地址在北京的并且用户id在1、2、4之中的用户 要是自己基于mybatis实现SQL，大概是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;queryUserByIdAndAddr&quot; resultType=&quot;com.itheima.mp.domain.po.User&quot;&gt;</span><br><span class="line">      SELECT *</span><br><span class="line">      FROM user u</span><br><span class="line">      INNER JOIN address a ON u.id = a.user_id</span><br><span class="line">      WHERE u.id</span><br><span class="line">      &lt;foreach collection=&quot;ids&quot; separator=&quot;,&quot; item=&quot;id&quot; open=&quot;IN (&quot; close=&quot;)&quot;&gt;</span><br><span class="line">          #&#123;id&#125;</span><br><span class="line">      &lt;/foreach&gt;</span><br><span class="line">      AND a.city = #&#123;city&#125;</span><br><span class="line">  &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>可以看出其中最复杂的就是WHERE条件的编写，如果业务复杂一些，这里的SQL会更变态。<br>
但是基于自定义SQL结合Wrapper的玩法，我们就可以利用Wrapper来构建查询条件，然后手写SELECT及FROM部分，实现多表查询。<br>
查询条件这样来构建：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testCustomJoinWrapper() &#123;</span><br><span class="line">    // 1.准备自定义查询条件</span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;User&gt;()</span><br><span class="line">            .in(&quot;u.id&quot;, List.of(1L, 2L, 4L))</span><br><span class="line">            .eq(&quot;a.city&quot;, &quot;北京&quot;);</span><br><span class="line"></span><br><span class="line">    // 2.调用mapper的自定义方法</span><br><span class="line">    List&lt;User&gt; users = userMapper.queryUserByWrapper(wrapper);</span><br><span class="line"></span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在UserMapper中自定义方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Select(&quot;SELECT u.* FROM user u INNER JOIN address a ON u.id = a.user_id $&#123;ew.customSqlSegment&#125;&quot;)</span><br><span class="line">List&lt;User&gt; queryUserByWrapper(@Param(&quot;ew&quot;)QueryWrapper&lt;User&gt; wrapper);</span><br></pre></td></tr></table></figure>
<p>当然，也可以在UserMapper.xml中写SQL：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;queryUserByIdAndAddr&quot; resultType=&quot;com.itheima.mp.domain.po.User&quot;&gt;</span><br><span class="line">    SELECT * FROM user u INNER JOIN address a ON u.id = a.user_id $&#123;ew.customSqlSegment&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Service接口：">Service接口：</h2>
<p>MybatisPlus不仅提供了BaseMapper，还提供了通用的Service接口及默认实现，封装了一些常用的service模板方法。 通用接口为IService，默认实现为ServiceImpl，其中封装的方法可以分为以下几类：</p>
<ul>
<li>save：新增</li>
<li>remove：删除</li>
<li>update：更新</li>
<li>get：查询单个结果</li>
<li>list：查询集合结果</li>
<li>count：计数</li>
<li>page：分页查询</li>
</ul>
<h4 id="CRUD：">CRUD：</h4>
<p>我们先俩看下基本的CRUD接口。 <strong>新增</strong>：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705901761781-cd483668-f2f2-4e2e-9107-9b3c1e65c8f3.png#averageHue=%23f9f8f5&amp;clientId=ue5cba3c3-0ee1-4&amp;from=paste&amp;id=u3498b97f&amp;originHeight=291&amp;originWidth=890&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u859b1b5c-be7d-4bf6-88b6-e2c4b7549cb&amp;title=" alt=""></p>
<ul>
<li>save是新增单个元素</li>
<li>saveBatch是批量新增</li>
<li>saveOrUpdate是根据id判断，如果数据存在就更新，不存在则新增</li>
<li>saveOrUpdateBatch是批量的新增或修改</li>
</ul>
<p><strong>删除：</strong><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705901761807-7b419342-257a-443d-a087-4178259ba765.png#averageHue=%23f9f7f2&amp;clientId=ue5cba3c3-0ee1-4&amp;from=paste&amp;id=u67a1f4d5&amp;originHeight=409&amp;originWidth=913&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u09c5315b-cd84-42e9-a3e7-c3f07669fa8&amp;title=" alt=""></p>
<ul>
<li>removeById：根据id删除</li>
<li>removeByIds：根据id批量删除</li>
<li>removeByMap：根据Map中的键值对为条件删除</li>
<li>remove(Wrapper<T>)：根据Wrapper条件删除</li>
<li><s>removeBatchByIds</s>：暂不支持</li>
</ul>
<p><strong>修改：</strong><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705901761834-e548c4a8-f6e7-4111-a4ad-23fb41d62502.png#averageHue=%23faf6f2&amp;clientId=ue5cba3c3-0ee1-4&amp;from=paste&amp;id=ua1459dfb&amp;originHeight=444&amp;originWidth=931&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u8a5e5127-d5df-434b-94c5-a9fdf3fe20d&amp;title=" alt=""></p>
<ul>
<li>updateById：根据id修改</li>
<li>update(Wrapper<T>)：根据UpdateWrapper修改，Wrapper中包含set和where部分</li>
<li>update(T，Wrapper<T>)：按照T内的数据修改与Wrapper匹配到的数据</li>
<li>updateBatchById：根据id批量修改</li>
</ul>
<p><strong>Get：</strong><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705901761918-9986dfba-97fa-4d47-9cfa-f116723710ec.png#averageHue=%23f9f3f1&amp;clientId=ue5cba3c3-0ee1-4&amp;from=paste&amp;id=ua23839c7&amp;originHeight=287&amp;originWidth=897&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ue708b657-e910-4553-bffa-bd944058cd2&amp;title=" alt=""></p>
<ul>
<li>getById：根据id查询1条数据</li>
<li>getOne(Wrapper<T>)：根据Wrapper查询1条数据</li>
<li>getBaseMapper：获取Service内的BaseMapper实现，某些时候需要直接调用Mapper内的自定义SQL时可以用这个方法获取到Mapper</li>
</ul>
<p><strong>List：</strong><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705901761862-198d733d-3b92-46d6-8467-649a229dd802.png#averageHue=%23f9f5f2&amp;clientId=ue5cba3c3-0ee1-4&amp;from=paste&amp;id=u27975eb9&amp;originHeight=375&amp;originWidth=919&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ud8364a94-27a9-47ab-a8d6-a24c82c60e9&amp;title=" alt=""></p>
<ul>
<li>listByIds：根据id批量查询</li>
<li>list(Wrapper<T>)：根据Wrapper条件查询多条数据</li>
<li>list()：查询所有</li>
</ul>
<p><strong>Count</strong>：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705901762451-7759b2ce-c219-4a44-bdcf-363e1d09a656.png#averageHue=%23dbc789&amp;clientId=ue5cba3c3-0ee1-4&amp;from=paste&amp;id=uee4df41f&amp;originHeight=134&amp;originWidth=775&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ud373cd64-264c-4314-a3d2-6c85025dc95&amp;title=" alt=""></p>
<ul>
<li>count()：统计所有数量</li>
<li>count(Wrapper<T>)：统计符合Wrapper条件的数据数量</li>
</ul>
<p><strong>getBaseMapper</strong>： 当我们在service中要调用Mapper中自定义SQL时，就必须获取service对应的Mapper，就可以通过这个方法：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705901762655-114bb9d6-350b-492a-9c6c-b68f5224a2d2.png#averageHue=%23f4f4f1&amp;clientId=ue5cba3c3-0ee1-4&amp;from=paste&amp;id=u91305962&amp;originHeight=124&amp;originWidth=529&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=uce5abd52-11e2-436a-a76f-fae5d7bf134&amp;title=" alt=""></p>
<h3 id="基本用法"><strong>基本用法</strong></h3>
<p>由于Service中经常需要定义与业务有关的自定义方法，因此我们不能直接使用IService，而是自定义Service接口，然后继承IService以拓展方法。同时，让自定义的Service实现类继承ServiceImpl，这样就不用自己实现IService中的接口了。<br>
首先，定义IUserService，继承IService：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.service;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line">import com.itheima.mp.domain.po.User;</span><br><span class="line"></span><br><span class="line">public interface IUserService extends IService&lt;User&gt; &#123;</span><br><span class="line">    // 拓展自定义方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，编写UserServiceImpl类，继承ServiceImpl，实现UserService：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.service.impl;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line">import com.itheima.mp.domain.po.User;</span><br><span class="line">import com.itheima.mp.domain.po.service.IUserService;</span><br><span class="line">import com.itheima.mp.mapper.UserMapper;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements IUserService</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="项目结构如下：">项目结构如下：</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705918523933-50ecb3ce-9a82-4e92-8af8-516cbcc11a97.png#averageHue=%23f9fbf8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u6a26501b&amp;originHeight=558&amp;originWidth=875&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u8ba7e3f5-2848-400a-9ab3-6115c4fc29b&amp;title=" alt=""><br>
接下来，我们快速实现下面4个接口：</p>
<table>
<thead>
<tr>
<th><strong>编号</strong></th>
<th><strong>接口</strong></th>
<th><strong>请求方式</strong></th>
<th><strong>请求路径</strong></th>
<th><strong>请求参数</strong></th>
<th><strong>返回值</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>新增用户</td>
<td>POST</td>
<td>/users</td>
<td>用户表单实体</td>
<td>无</td>
</tr>
<tr>
<td>2</td>
<td>删除用户</td>
<td>DELETE</td>
<td>/users/{id}</td>
<td>用户id</td>
<td>无</td>
</tr>
<tr>
<td>3</td>
<td>根据id查询用户</td>
<td>GET</td>
<td>/users/{id}</td>
<td>用户id</td>
<td>用户VO</td>
</tr>
<tr>
<td>4</td>
<td>根据id批量查询</td>
<td>GET</td>
<td>/users</td>
<td>用户id集合</td>
<td>用户VO集合</td>
</tr>
</tbody>
</table>
<p>首先，我们在项目中引入几个依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--swagger--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;knife4j-openapi2-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--web--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>然后需要配置swagger信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">knife4j:</span><br><span class="line">  enable: true</span><br><span class="line">  openapi:</span><br><span class="line">    title: 用户管理接口文档</span><br><span class="line">    description: &quot;用户管理接口文档&quot;</span><br><span class="line">    email: zhanghuyi@itcast.cn</span><br><span class="line">    concat: 虎哥</span><br><span class="line">    url: https://www.itcast.cn</span><br><span class="line">    version: v1.0.0</span><br><span class="line">    group:</span><br><span class="line">      default:</span><br><span class="line">        group-name: default</span><br><span class="line">        api-rule: package</span><br><span class="line">        api-rule-resources:</span><br><span class="line">          - com.itheima.mp.controller</span><br></pre></td></tr></table></figure>
<p>然后，接口需要两个实体：</p>
<ul>
<li>UserFormDTO：代表新增时的用户表单</li>
<li>UserVO：代表查询的返回结果</li>
</ul>
<p>首先是UserFormDTO：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.dto;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line">import com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler;</span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;用户表单实体&quot;)</span><br><span class="line">public class UserFormDTO &#123;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;id&quot;)</span><br><span class="line">    private Long id;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;用户名&quot;)</span><br><span class="line">    private String username;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;密码&quot;)</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;注册手机号&quot;)</span><br><span class="line">    private String phone;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;详细信息，JSON风格&quot;)</span><br><span class="line">    private String info;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;账户余额&quot;)</span><br><span class="line">    private Integer balance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后是UserVO：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.vo;</span><br><span class="line"></span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;用户VO实体&quot;)</span><br><span class="line">public class UserVO &#123;</span><br><span class="line">    </span><br><span class="line">    @ApiModelProperty(&quot;用户id&quot;)</span><br><span class="line">    private Long id;</span><br><span class="line">    </span><br><span class="line">    @ApiModelProperty(&quot;用户名&quot;)</span><br><span class="line">    private String username;</span><br><span class="line">    </span><br><span class="line">    @ApiModelProperty(&quot;详细信息&quot;)</span><br><span class="line">    private String info;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;使用状态（1正常 2冻结）&quot;)</span><br><span class="line">    private Integer status;</span><br><span class="line">    </span><br><span class="line">    @ApiModelProperty(&quot;账户余额&quot;)</span><br><span class="line">    private Integer balance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，按照Restful风格编写Controller接口方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.controller;</span><br><span class="line"></span><br><span class="line">import cn.hutool.core.bean.BeanUtil;</span><br><span class="line">import com.itheima.mp.domain.dto.UserFormDTO;</span><br><span class="line">import com.itheima.mp.domain.po.User;</span><br><span class="line">import com.itheima.mp.domain.vo.UserVO;</span><br><span class="line">import com.itheima.mp.service.IUserService;</span><br><span class="line">import io.swagger.annotations.Api;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Api(tags = &quot;用户管理接口&quot;)</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;users&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    private final IUserService userService;</span><br><span class="line"></span><br><span class="line">    @PostMapping</span><br><span class="line">    @ApiOperation(&quot;新增用户&quot;)</span><br><span class="line">    public void saveUser(@RequestBody UserFormDTO userFormDTO)&#123;</span><br><span class="line">        // 1.转换DTO为PO</span><br><span class="line">        User user = BeanUtil.copyProperties(userFormDTO, User.class);</span><br><span class="line">        // 2.新增</span><br><span class="line">        userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    @ApiOperation(&quot;删除用户&quot;)</span><br><span class="line">    public void removeUserById(@PathVariable(&quot;id&quot;) Long userId)&#123;</span><br><span class="line">        userService.removeById(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    @ApiOperation(&quot;根据id查询用户&quot;)</span><br><span class="line">    public UserVO queryUserById(@PathVariable(&quot;id&quot;) Long userId)&#123;</span><br><span class="line">        // 1.查询用户</span><br><span class="line">        User user = userService.getById(userId);</span><br><span class="line">        // 2.处理vo</span><br><span class="line">        return BeanUtil.copyProperties(user, UserVO.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping</span><br><span class="line">    @ApiOperation(&quot;根据id集合查询用户&quot;)</span><br><span class="line">    public List&lt;UserVO&gt; queryUserByIds(@RequestParam(&quot;ids&quot;) List&lt;Long&gt; ids)&#123;</span><br><span class="line">        // 1.查询用户</span><br><span class="line">        List&lt;User&gt; users = userService.listByIds(ids);</span><br><span class="line">        // 2.处理vo</span><br><span class="line">        return BeanUtil.copyToList(users, UserVO.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到上述接口都直接在controller即可实现，无需编写任何service代码，非常方便。<br>
不过，一些带有业务逻辑的接口则需要在service中自定义实现了。例如下面的需求：</p>
<ul>
<li>根据id扣减用户余额</li>
</ul>
<p>这看起来是个简单修改功能，只要修改用户余额即可。但这个业务包含一些业务逻辑处理：</p>
<ul>
<li>判断用户状态是否正常</li>
<li>判断用户余额是否充足</li>
</ul>
<p>这些业务逻辑都要在service层来做，另外更新余额需要自定义SQL，要在mapper中来实现。因此，我们除了要编写controller以外，具体的业务还要在service和mapper中编写。<br>
首先在UserController中定义一个方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@PutMapping(&quot;&#123;id&#125;/deduction/&#123;money&#125;&quot;)</span><br><span class="line">@ApiOperation(&quot;扣减用户余额&quot;)</span><br><span class="line">public void deductBalance(@PathVariable(&quot;id&quot;) Long id, @PathVariable(&quot;money&quot;)Integer money)&#123;</span><br><span class="line">    userService.deductBalance(id, money);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后是UserService接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.service;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line">import com.itheima.mp.domain.po.User;</span><br><span class="line"></span><br><span class="line">public interface IUserService extends IService&lt;User&gt; &#123;</span><br><span class="line">    void deductBalance(Long id, Integer money);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后是UserServiceImpl实现类：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.service.impl;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line">import com.itheima.mp.domain.po.User;</span><br><span class="line">import com.itheima.mp.mapper.UserMapper;</span><br><span class="line">import com.itheima.mp.service.IUserService;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements IUserService &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void deductBalance(Long id, Integer money) &#123;</span><br><span class="line">        // 1.查询用户</span><br><span class="line">        User user = getById(id);</span><br><span class="line">        // 2.判断用户状态</span><br><span class="line">        if (user == null || user.getStatus() == 2) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;用户状态异常&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        // 3.判断用户余额</span><br><span class="line">        if (user.getBalance() &lt; money) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;用户余额不足&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        // 4.扣减余额</span><br><span class="line">        baseMapper.deductMoneyById(id, money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后是mapper：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Update(&quot;UPDATE user SET balance = balance - #&#123;money&#125; WHERE id = #&#123;id&#125;&quot;)</span><br><span class="line">void deductMoneyById(@Param(&quot;id&quot;) Long id, @Param(&quot;money&quot;) Integer money);</span><br></pre></td></tr></table></figure>
<h3 id="2-3-3-Lambda"><strong>2.3.3.Lambda</strong></h3>
<p>IService中还提供了Lambda功能来简化我们的复杂查询及更新功能。我们通过两个案例来学习一下。<br>
案例一：实现一个根据复杂条件查询用户的接口，查询条件如下：</p>
<ul>
<li>name：用户名关键字，可以为空</li>
<li>status：用户状态，可以为空</li>
<li>minBalance：最小余额，可以为空</li>
<li>maxBalance：最大余额，可以为空</li>
</ul>
<p>可以理解成一个用户的后台管理界面，管理员可以自己选择条件来筛选用户，因此上述条件不一定存在，需要做判断。<br>
我们首先需要定义一个查询条件实体，UserQuery实体：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.query;</span><br><span class="line"></span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;用户查询条件实体&quot;)</span><br><span class="line">public class UserQuery &#123;</span><br><span class="line">    @ApiModelProperty(&quot;用户名关键字&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    @ApiModelProperty(&quot;用户状态：1-正常，2-冻结&quot;)</span><br><span class="line">    private Integer status;</span><br><span class="line">    @ApiModelProperty(&quot;余额最小值&quot;)</span><br><span class="line">    private Integer minBalance;</span><br><span class="line">    @ApiModelProperty(&quot;余额最大值&quot;)</span><br><span class="line">    private Integer maxBalance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来我们在UserController中定义一个controller方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/list&quot;)</span><br><span class="line">@ApiOperation(&quot;根据id集合查询用户&quot;)</span><br><span class="line">public List&lt;UserVO&gt; queryUsers(UserQuery query)&#123;</span><br><span class="line">    // 1.组织条件</span><br><span class="line">    String username = query.getName();</span><br><span class="line">    Integer status = query.getStatus();</span><br><span class="line">    Integer minBalance = query.getMinBalance();</span><br><span class="line">    Integer maxBalance = query.getMaxBalance();</span><br><span class="line">    LambdaQueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;User&gt;().lambda()</span><br><span class="line">            .like(username != null, User::getUsername, username)</span><br><span class="line">            .eq(status != null, User::getStatus, status)</span><br><span class="line">            .ge(minBalance != null, User::getBalance, minBalance)</span><br><span class="line">            .le(maxBalance != null, User::getBalance, maxBalance);</span><br><span class="line">    // 2.查询用户</span><br><span class="line">    List&lt;User&gt; users = userService.list(wrapper);</span><br><span class="line">    // 3.处理vo</span><br><span class="line">    return BeanUtil.copyToList(users, UserVO.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在组织查询条件的时候，我们加入了 username != null 这样的参数，意思就是当条件成立时才会添加这个查询条件，类似Mybatis的mapper.xml文件中的<if>标签。这样就实现了动态查询条件效果了。<br>
不过，上述条件构建的代码太麻烦了。 因此Service中对LambdaQueryWrapper和LambdaUpdateWrapper的用法进一步做了简化。我们无需自己通过new的方式来创建Wrapper，而是直接调用lambdaQuery和lambdaUpdate方法：<br>
基于Lambda查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/list&quot;)</span><br><span class="line">@ApiOperation(&quot;根据id集合查询用户&quot;)</span><br><span class="line">public List&lt;UserVO&gt; queryUsers(UserQuery query)&#123;</span><br><span class="line">    // 1.组织条件</span><br><span class="line">    String username = query.getName();</span><br><span class="line">    Integer status = query.getStatus();</span><br><span class="line">    Integer minBalance = query.getMinBalance();</span><br><span class="line">    Integer maxBalance = query.getMaxBalance();</span><br><span class="line">    // 2.查询用户</span><br><span class="line">    List&lt;User&gt; users = userService.lambdaQuery()</span><br><span class="line">            .like(username != null, User::getUsername, username)</span><br><span class="line">            .eq(status != null, User::getStatus, status)</span><br><span class="line">            .ge(minBalance != null, User::getBalance, minBalance)</span><br><span class="line">            .le(maxBalance != null, User::getBalance, maxBalance)</span><br><span class="line">            .list();</span><br><span class="line">    // 3.处理vo</span><br><span class="line">    return BeanUtil.copyToList(users, UserVO.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现lambdaQuery方法中除了可以构建条件，还需要在链式编程的最后添加一个list()，这是在告诉MP我们的调用结果需要是一个list集合。这里不仅可以用list()，可选的方法有：</p>
<ul>
<li>.one()：最多1个结果</li>
<li>.list()：返回集合结果</li>
<li>.count()：返回计数结果</li>
</ul>
<p>MybatisPlus会根据链式编程的最后一个方法来判断最终的返回结果。<br>
与lambdaQuery方法类似，IService中的lambdaUpdate方法可以非常方便的实现复杂更新业务。<br>
例如下面的需求：<br>
需求：改造根据id修改用户余额的接口，要求如下</p>
<ul>
<li>如果扣减后余额为0，则将用户status修改为冻结状态（2）</li>
</ul>
<p>也就是说我们在扣减用户余额时，需要对用户剩余余额做出判断，如果发现剩余余额为0，则应该将status修改为2，这就是说update语句的set部分是动态的。<br>
实现如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">@Transactional</span><br><span class="line">public void deductBalance(Long id, Integer money) &#123;</span><br><span class="line">    // 1.查询用户</span><br><span class="line">    User user = getById(id);</span><br><span class="line">    // 2.校验用户状态</span><br><span class="line">    if (user == null || user.getStatus() == 2) &#123;</span><br><span class="line">        throw new RuntimeException(&quot;用户状态异常！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 3.校验余额是否充足</span><br><span class="line">    if (user.getBalance() &lt; money) &#123;</span><br><span class="line">        throw new RuntimeException(&quot;用户余额不足！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 4.扣减余额 update tb_user set balance = balance - ?</span><br><span class="line">    int remainBalance = user.getBalance() - money;</span><br><span class="line">    lambdaUpdate()</span><br><span class="line">            .set(User::getBalance, remainBalance) // 更新余额</span><br><span class="line">            .set(remainBalance == 0, User::getStatus, 2) // 动态判断，是否更新status</span><br><span class="line">            .eq(User::getId, id)</span><br><span class="line">            .eq(User::getBalance, user.getBalance()) // 乐观锁</span><br><span class="line">            .update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-4-批量新增"><strong>2.3.4.批量新增</strong></h3>
<p>IService中的批量新增功能使用起来非常方便，但有一点注意事项，我们先来测试一下。 首先我们测试逐条插入数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testSaveOneByOne() &#123;</span><br><span class="line">    long b = System.currentTimeMillis();</span><br><span class="line">    for (int i = 1; i &lt;= 100000; i++) &#123;</span><br><span class="line">        userService.save(buildUser(i));</span><br><span class="line">    &#125;</span><br><span class="line">    long e = System.currentTimeMillis();</span><br><span class="line">    System.out.println(&quot;耗时：&quot; + (e - b));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private User buildUser(int i) &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    user.setUsername(&quot;user_&quot; + i);</span><br><span class="line">    user.setPassword(&quot;123&quot;);</span><br><span class="line">    user.setPhone(&quot;&quot; + (18688190000L + i));</span><br><span class="line">    user.setBalance(2000);</span><br><span class="line">    user.setInfo(&quot;&#123;\&quot;age\&quot;: 24, \&quot;intro\&quot;: \&quot;英文老师\&quot;, \&quot;gender\&quot;: \&quot;female\&quot;&#125;&quot;);</span><br><span class="line">    user.setCreateTime(LocalDateTime.now());</span><br><span class="line">    user.setUpdateTime(user.getCreateTime());</span><br><span class="line">    return user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果如下：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705918577491-79c47877-5315-47bf-986f-b40df37aea6c.png#averageHue=%23f6f8f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u700a36e1&amp;originHeight=303&amp;originWidth=1525&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=uc2e4f0cd-5997-4672-8194-d029834d05f&amp;title=" alt=""><br>
可以看到速度非常慢。<br>
然后再试试MybatisPlus的批处理：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testSaveBatch() &#123;</span><br><span class="line">    // 准备10万条数据</span><br><span class="line">    List&lt;User&gt; list = new ArrayList&lt;&gt;(1000);</span><br><span class="line">    long b = System.currentTimeMillis();</span><br><span class="line">    for (int i = 1; i &lt;= 100000; i++) &#123;</span><br><span class="line">        list.add(buildUser(i));</span><br><span class="line">        // 每1000条批量插入一次</span><br><span class="line">        if (i % 1000 == 0) &#123;</span><br><span class="line">            userService.saveBatch(list);</span><br><span class="line">            list.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    long e = System.currentTimeMillis();</span><br><span class="line">    System.out.println(&quot;耗时：&quot; + (e - b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行最终耗时如下：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705918577541-ae31e891-bb24-4ac0-a50f-d225b65174cd.png#averageHue=%23f6f8f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u11a679bf&amp;originHeight=305&amp;originWidth=1528&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u34d7fc95-cce8-4391-9aa3-cb3a5a64452&amp;title=" alt=""><br>
可以看到使用了批处理以后，比逐条新增效率提高了10倍左右，性能还是不错的。<br>
不过，我们简单查看一下MybatisPlus源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Transactional(rollbackFor = Exception.class)</span><br><span class="line">@Override</span><br><span class="line">public boolean saveBatch(Collection&lt;T&gt; entityList, int batchSize) &#123;</span><br><span class="line">    String sqlStatement = getSqlStatement(SqlMethod.INSERT_ONE);</span><br><span class="line">    return executeBatch(entityList, batchSize, (sqlSession, entity) -&gt; sqlSession.insert(sqlStatement, entity));</span><br><span class="line">&#125;</span><br><span class="line">// ...SqlHelper</span><br><span class="line">public static &lt;E&gt; boolean executeBatch(Class&lt;?&gt; entityClass, Log log, Collection&lt;E&gt; list, int batchSize, BiConsumer&lt;SqlSession, E&gt; consumer) &#123;</span><br><span class="line">    Assert.isFalse(batchSize &lt; 1, &quot;batchSize must not be less than one&quot;);</span><br><span class="line">    return !CollectionUtils.isEmpty(list) &amp;&amp; executeBatch(entityClass, log, sqlSession -&gt; &#123;</span><br><span class="line">        int size = list.size();</span><br><span class="line">        int idxLimit = Math.min(batchSize, size);</span><br><span class="line">        int i = 1;</span><br><span class="line">        for (E element : list) &#123;</span><br><span class="line">            consumer.accept(sqlSession, element);</span><br><span class="line">            if (i == idxLimit) &#123;</span><br><span class="line">                sqlSession.flushStatements();</span><br><span class="line">                idxLimit = Math.min(idxLimit + batchSize, size);</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现其实MybatisPlus的批处理是基于PrepareStatement的预编译模式，然后批量提交，最终在数据库执行时还是会有多条insert语句，逐条插入数据。SQL类似这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Preparing: INSERT INTO user ( username, password, phone, info, balance, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ? )</span><br><span class="line">Parameters: user_1, 123, 18688190001, &quot;&quot;, 2000, 2023-07-01, 2023-07-01</span><br><span class="line">Parameters: user_2, 123, 18688190002, &quot;&quot;, 2000, 2023-07-01, 2023-07-01</span><br><span class="line">Parameters: user_3, 123, 18688190003, &quot;&quot;, 2000, 2023-07-01, 2023-07-01</span><br></pre></td></tr></table></figure>
<p>而如果想要得到最佳性能，最好是将多条SQL合并为一条，像这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO user ( username, password, phone, info, balance, create_time, update_time )</span><br><span class="line">VALUES </span><br><span class="line">(user_1, 123, 18688190001, &quot;&quot;, 2000, 2023-07-01, 2023-07-01),</span><br><span class="line">(user_2, 123, 18688190002, &quot;&quot;, 2000, 2023-07-01, 2023-07-01),</span><br><span class="line">(user_3, 123, 18688190003, &quot;&quot;, 2000, 2023-07-01, 2023-07-01),</span><br><span class="line">(user_4, 123, 18688190004, &quot;&quot;, 2000, 2023-07-01, 2023-07-01);</span><br></pre></td></tr></table></figure>
<p>该怎么做呢？<br>
MySQL的客户端连接参数中有这样的一个参数：rewriteBatchedStatements。顾名思义，就是重写批处理的statement语句。参考文档：<br>
<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-performance-extensions.html#cj-conn-prop_rewriteBatchedStatements">https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-performance-extensions.html#cj-conn-prop_rewriteBatchedStatements</a><br>
这个参数的默认值是false，我们需要修改连接参数，将其配置为true<br>
修改项目中的application.yml文件，在jdbc的url后面添加参数&amp;rewriteBatchedStatements=true:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    username: root</span><br><span class="line">    password: MySQL123</span><br></pre></td></tr></table></figure>
<p>再次测试插入10万条数据，可以发现速度有非常明显的提升：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705918577520-0196506b-bff1-45dc-8c7a-fac4dc56a512.png#averageHue=%23f6f9f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u8a36e49b&amp;originHeight=338&amp;originWidth=1450&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ua6f0112b-2d06-4e96-bc5e-c12e199f055&amp;title=" alt=""><br>
在ClientPreparedStatement的executeBatchInternal中，有判断rewriteBatchedStatements值是否为true并重写SQL的功能：<br>
最终，SQL被重写了：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705918589951-a039f0bf-7969-47b9-bae6-54aba517d7d1.png#averageHue=%23f4f4f3&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=ud31f44f4&amp;originHeight=820&amp;originWidth=1438&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=uebc23129-0353-41c2-a242-d2d48624d16&amp;title=" alt=""></p>
<h2 id="3-扩展功能：">3.扩展功能：</h2>
<p>在使用MybatisPlus以后，基础的Mapper、Service、PO代码相对固定，重复编写也比较麻烦。因此MybatisPlus官方提供了代码生成器根据数据库表结构生成PO、Mapper、Service等相关代码。只不过代码生成器同样要编码使用，也很麻烦。<br>
这里推荐大家使用一款MybatisPlus的插件，它可以基于图形化界面完成MybatisPlus的代码生成，非常简单。</p>
<h2 id="3-1-代码生成"><strong>3.1.代码生成</strong></h2>
<p>在使用MybatisPlus以后，基础的Mapper、Service、PO代码相对固定，重复编写也比较麻烦。因此MybatisPlus官方提供了代码生成器根据数据库表结构生成PO、Mapper、Service等相关代码。只不过代码生成器同样要编码使用，也很麻烦。<br>
这里推荐大家使用一款MybatisPlus的插件，它可以基于图形化界面完成MybatisPlus的代码生成，非常简单。</p>
<h3 id="3-1-1-安装插件"><strong>3.1.1.安装插件</strong></h3>
<p>在Idea的plugins市场中搜索并安装MyBatisPlus插件：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705925803243-c463bddd-90b6-4f00-82f9-07248f3be296.png#averageHue=%23f6f5f5&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u10f22e01&amp;originHeight=766&amp;originWidth=1507&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u774fac4c-a63b-4b5d-b790-d376bfa45ec&amp;title=" alt=""><br>
然后重启你的Idea即可使用。</p>
<h3 id="3-1-2-使用"><strong>3.1.2.使用</strong></h3>
<p>刚好数据库中还有一张address表尚未生成对应的实体和mapper等基础代码。我们利用插件生成一下。 首先需要配置数据库地址，在Idea顶部菜单中，找到other，选择Config Database：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705925803207-e850f164-0ed0-424c-900f-3fedb6538a55.png#averageHue=%23d9ceb7&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u1a5ced54&amp;originHeight=236&amp;originWidth=1221&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ue1f50f4e-facf-40db-a0b7-ba521b9bba9&amp;title=" alt=""><br>
在弹出的窗口中填写数据库连接的基本信息：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705925803342-1dfc56be-849e-4f50-bca8-ab9a57c51b8d.png#averageHue=%23f4f4f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u901ce6ea&amp;originHeight=393&amp;originWidth=629&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u3bc246b2-fd70-4532-bbfc-a70f583f4fd&amp;title=" alt=""><br>
点击OK保存。<br>
然后再次点击Idea顶部菜单中的other，然后选择Code Generator:<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705925803246-a0166ea0-af7e-4fcb-a752-12fe9b94dc51.png#averageHue=%23d7cbb2&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u11e4b452&amp;originHeight=190&amp;originWidth=1109&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u82c0dc6d-49f5-4b79-9b08-722b1889191&amp;title=" alt=""><br>
在弹出的表单中填写信息：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705925803280-c0d3829d-83a0-42ce-a02e-3e145b64069f.png#averageHue=%23f3e9e8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u553b6e7b&amp;originHeight=606&amp;originWidth=1376&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u13c55ac9-9403-4bec-9fb6-9d460c8fffc&amp;title=" alt=""><br>
最终，代码自动生成到指定的位置了：但是要注意上面的代码生成的mapper文件缺少@Mapper注解的！</p>
<h2 id="3-2-静态工具"><strong>3.2.静态工具</strong></h2>
<p>有的时候Service之间也会相互调用，为了避免出现循环依赖问题，MybatisPlus提供一个静态工具类：Db，其中的一些静态方法与IService中方法签名基本一致，也可以帮助我们实现CRUD功能：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705925805432-f717e42a-c354-420b-9431-ce96c43cec8f.png#averageHue=%23fbf9f8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=ud46ade48&amp;originHeight=899&amp;originWidth=1028&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=uf48cddd7-fed5-4b09-8ce7-d6e314ca6ae&amp;title=" alt=""><br>
示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testDbGet() &#123;</span><br><span class="line">    User user = Db.getById(1L, User.class);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">void testDbList() &#123;</span><br><span class="line">    // 利用Db实现复杂条件查询</span><br><span class="line">    List&lt;User&gt; list = Db.lambdaQuery(User.class)</span><br><span class="line">            .like(User::getUsername, &quot;o&quot;)</span><br><span class="line">            .ge(User::getBalance, 1000)</span><br><span class="line">            .list();</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">void testDbUpdate() &#123;</span><br><span class="line">    Db.lambdaUpdate(User.class)</span><br><span class="line">            .set(User::getBalance, 2000)</span><br><span class="line">            .eq(User::getUsername, &quot;Rose&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需求：改造根据id用户查询的接口，查询用户的同时返回用户收货地址列表<br>
首先，我们要添加一个收货地址的VO对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.vo;</span><br><span class="line"></span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;收货地址VO&quot;)</span><br><span class="line">public class AddressVO&#123;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;id&quot;)</span><br><span class="line">    private Long id;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;用户ID&quot;)</span><br><span class="line">    private Long userId;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;省&quot;)</span><br><span class="line">    private String province;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;市&quot;)</span><br><span class="line">    private String city;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;县/区&quot;)</span><br><span class="line">    private String town;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;手机&quot;)</span><br><span class="line">    private String mobile;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;详细地址&quot;)</span><br><span class="line">    private String street;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;联系人&quot;)</span><br><span class="line">    private String contact;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;是否是默认 1默认 0否&quot;)</span><br><span class="line">    private Boolean isDefault;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;备注&quot;)</span><br><span class="line">    private String notes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，改造原来的UserVO，添加一个地址属性：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705925806370-0ff19fa7-2686-4d7f-ba8e-449c203787f9.png#averageHue=%23f6f9f3&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u9a4dd936&amp;originHeight=804&amp;originWidth=929&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u3f51cddc-ab65-46fc-aa76-8fe5e8c0efc&amp;title=" alt=""><br>
接下来，修改UserController中根据id查询用户的业务接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">@ApiOperation(&quot;根据id查询用户&quot;)</span><br><span class="line">public UserVO queryUserById(@PathVariable(&quot;id&quot;) Long userId)&#123;</span><br><span class="line">    // 基于自定义service方法查询</span><br><span class="line">    return userService.queryUserAndAddressById(userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于查询业务复杂，所以要在service层来实现。首先在IUserService中定义方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.service;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line">import com.itheima.mp.domain.po.User;</span><br><span class="line">import com.itheima.mp.domain.vo.UserVO;</span><br><span class="line"></span><br><span class="line">public interface IUserService extends IService&lt;User&gt; &#123;</span><br><span class="line">    void deduct(Long id, Integer money);</span><br><span class="line"></span><br><span class="line">    UserVO queryUserAndAddressById(Long userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，在UserServiceImpl中实现该方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public UserVO queryUserAndAddressById(Long userId) &#123;</span><br><span class="line">    // 1.查询用户</span><br><span class="line">    User user = getById(userId);</span><br><span class="line">    if (user == null) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    // 2.查询收货地址</span><br><span class="line">    List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class)</span><br><span class="line">            .eq(Address::getUserId, userId)</span><br><span class="line">            .list();</span><br><span class="line">    // 3.处理vo</span><br><span class="line">    UserVO userVO = BeanUtil.copyProperties(user, UserVO.class);</span><br><span class="line">    userVO.setAddresses(BeanUtil.copyToList(addresses, AddressVO.class));</span><br><span class="line">    return userVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在查询地址时，我们采用了Db的静态方法，因此避免了注入AddressService，减少了循环依赖的风险。<br>
（如果AdressService需要查询User的时候，如果采用注入各自的Service就会产生循环依赖的问题了）<br>
再来实现一个功能：</p>
<ul>
<li>根据id批量查询用户，并查询出用户对应的所有地址</li>
</ul>
<h2 id="3-3-逻辑删除"><strong>3.3.逻辑删除</strong></h2>
<p>对于一些比较重要的数据，我们往往会采用逻辑删除的方案，即：</p>
<ul>
<li>在表中添加一个字段标记数据是否被删除</li>
<li>当删除数据时把标记置为true</li>
<li>查询时过滤掉标记为true的数据</li>
</ul>
<p>一旦采用了逻辑删除，所有的查询和删除逻辑都要跟着变化，非常麻烦。<br>
为了解决这个问题，MybatisPlus就添加了对逻辑删除的支持。<br>
<strong>注意</strong>，只有MybatisPlus生成的SQL语句才支持自动的逻辑删除，自定义SQL需要自己手动处理逻辑删除。<br>
例如，我们给address表添加一个逻辑删除字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table address add deleted bit default b&#x27;0&#x27; null comment &#x27;逻辑删除&#x27;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ADD deleted bit: 在表&quot;address&quot;中添加一个名为&quot;deleted&quot;的列，数据类型为bit。</span><br><span class="line">Bit数据类型用于存储0或1的布尔值。</span><br><span class="line">DEFAULT b&#x27;0&#x27;: 设置&quot;deleted&quot;列的默认值为二进制表示的0，即false。</span><br><span class="line">当插入新记录时，如果未提供&quot;deleted&quot;列的值，将自动使用默认值0。</span><br><span class="line">NULL: 指定&quot;deleted&quot;列允许为空值。这表示在插入新记录时，可以将&quot;deleted&quot;列设置为NULL，</span><br><span class="line">表示未知或未设置。</span><br></pre></td></tr></table></figure>
<p>然后给Address实体添加deleted字段：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705929828756-e0994712-53c6-4b5a-bee4-9b834c96b6cc.png#averageHue=%23f6f8f3&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u60328773&amp;originHeight=482&amp;originWidth=856&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u2cad5426-4646-46fd-bd0e-0af0591c6f8&amp;title=" alt=""><br>
接下来，我们要在application.yml中配置逻辑删除字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      logic-delete-field: deleted # 全局逻辑删除的实体字段名(since 3.3.0,配置后可以忽略不配置步骤2)</span><br><span class="line">      logic-delete-value: 1 # 逻辑已删除值(默认为 1)</span><br><span class="line">      logic-not-delete-value: 0 # 逻辑未删除值(默认为 0)</span><br></pre></td></tr></table></figure>
<p>测试： 首先，我们执行一个删除操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testDeleteByLogic() &#123;</span><br><span class="line">    // 删除方法与以前没有区别</span><br><span class="line">    addressService.removeById(59L);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法与普通删除一模一样，但是底层的SQL逻辑变了：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705929828740-fd1337a1-66af-4424-9b11-e048d081e91b.png#averageHue=%23f9fcf7&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=uc0061475&amp;originHeight=387&amp;originWidth=1347&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=uc5e559a3-b475-4939-8e40-34d7b5e5a77&amp;title=" alt=""><br>
查询一下试试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testQuery() &#123;</span><br><span class="line">    List&lt;Address&gt; list = addressService.list();</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>会发现id为59的确实没有查询出来，而且SQL中也对逻辑删除字段做了判断：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705929828967-15c00aed-218b-4c65-87c3-00e4accf5dc6.png#averageHue=%23f9fcf7&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u337c364c&amp;originHeight=560&amp;originWidth=1328&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u7b0c1730-31af-4f6a-9ee3-8419cf75303&amp;title=" alt=""><br>
综上， 开启了逻辑删除功能以后，我们就可以像普通删除一样做CRUD，基本不用考虑代码逻辑问题。还是非常方便的。<br>
<strong>注意</strong>： 逻辑删除本身也有自己的问题，比如：</p>
<ul>
<li>会导致数据库表垃圾数据越来越多，从而影响查询效率</li>
<li>SQL中全都需要对逻辑删除字段做判断，影响查询效率</li>
</ul>
<p>因此，我不太推荐采用逻辑删除功能，如果数据不能删除，可以采用把数据迁移到其它表的办法。</p>
<h2 id="3-3-通用枚举"><strong>3.3.通用枚举</strong></h2>
<p>User类中有一个用户状态字段：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978249509-aa2d04fe-4b98-4ac9-980f-5fa85c7d6b50.png#averageHue=%23f5f7f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=ub07561b7&amp;originHeight=432&amp;originWidth=688&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u8666f78e-7686-4c6e-81c7-da8a49a01fc&amp;title=" alt=""><br>
像这种字段我们一般会定义一个枚举，做业务判断的时候就可以直接基于枚举做比较。但是我们数据库采用的是int类型，对应的PO也是Integer。因此业务操作时必须手动把枚举与Integer转换，非常麻烦。<br>
因此，MybatisPlus提供了一个处理枚举的类型转换器，可以帮我们<strong>把枚举类型与数据库类型自动转换</strong>。</p>
<h3 id="3-3-1-定义枚举"><strong>3.3.1.定义枚举</strong></h3>
<p>我们定义一个用户状态的枚举：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978249556-e6a77e68-d8e7-4491-893d-62acee59bfe6.png#averageHue=%23f9fbf8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=ufe2f95ae&amp;originHeight=499&amp;originWidth=915&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ub92043d0-5495-4ccf-be03-817c41feb25&amp;title=" alt=""><br>
代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.enums;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.EnumValue;</span><br><span class="line">import lombok.Getter;</span><br><span class="line"></span><br><span class="line">@Getter</span><br><span class="line">public enum UserStatus &#123;</span><br><span class="line">    NORMAL(1, &quot;正常&quot;),</span><br><span class="line">    FREEZE(2, &quot;冻结&quot;)</span><br><span class="line">    ;</span><br><span class="line">    private final int value;</span><br><span class="line">    private final String desc;</span><br><span class="line"></span><br><span class="line">    UserStatus(int value, String desc) &#123;</span><br><span class="line">        this.value = value;</span><br><span class="line">        this.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后把User类中的status字段改为UserStatus 类型：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978249521-ed97e27c-6924-4aa2-8be3-86de331de227.png#averageHue=%23f6f7f2&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u61339fb0&amp;originHeight=422&amp;originWidth=714&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u1c8fd25d-379b-450f-9b37-a94dd7f887e&amp;title=" alt=""><br>
要让MybatisPlus处理枚举与数据库类型自动转换，我们必须告诉MybatisPlus，枚举中的哪个字段的值作为数据库值。 MybatisPlus提供了@EnumValue注解来标记枚举属性：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978322926-f9cac0e4-9432-423d-9c15-bc8e780b2ad8.png#averageHue=%23f8fbf6&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u998367e5&amp;originHeight=518&amp;originWidth=635&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ub0d8a87b-4703-4ada-a444-3a91345589e&amp;title=" alt=""><br>
上面的@Enumvalue修饰的属性，表示该属性对应的是数据库中的字段！然后数据库查询出来的值会自动转换为对应的枚举类型！<br>
枚举类也是一种类，只是它是一种比较特殊的类，因此它一样可以使用属性和方法。<br>
枚举类通常应该设计成不可变类，也就说它的属性值不应该允许改变，这样会更安全，而且代码更加简洁。为此，我们应该将枚举类的属性都使用private final修饰。<br>
一旦为枚举类显式定义了带参数的构造器，则列出枚举值时也必须对应地传入参数。<br>
上面的枚举属性是一种类似方法的值,必须含有构造方法！</p>
<h3 id="3-3-2-配置枚举处理器"><strong>3.3.2.配置枚举处理器</strong></h3>
<p>在application.yaml文件中添加配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  configuration:</span><br><span class="line">    default-enum-type-handler: com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler</span><br></pre></td></tr></table></figure>
<h3 id="3-3-3-测试"><strong>3.3.3.测试</strong></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testService() &#123;</span><br><span class="line">    List&lt;User&gt; list = userService.list();</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终，查询出的User类的status字段会是枚举类型：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978322948-63901170-fb58-44aa-8ead-e3f718a83e42.png#averageHue=%23f7faf3&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u5b431e2c&amp;originHeight=337&amp;originWidth=758&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=uc2b81bb7-1a6c-4d0f-8f77-81fa6d06e08&amp;title=" alt=""><br>
同时，为了使页面查询结果也是枚举格式，我们需要修改UserVO中的status属性：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978322908-020fb44c-2198-4d67-838c-2dbe552d3e29.png#averageHue=%23f6f8f1&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u900af5c6&amp;originHeight=488&amp;originWidth=1256&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u85d7767a-5cdd-43a0-8f9f-81884259c1b&amp;title=" alt=""><br>
并且，在UserStatus枚举中通过@JsonValue注解标记JSON序列化时展示的字段：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978322910-47a9761a-b929-4a31-a381-e5e106aa8c46.png#averageHue=%23f6f9f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=uf8aa82ad&amp;originHeight=491&amp;originWidth=1199&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u254bda76-28e1-4176-9676-49b08313b9a&amp;title=" alt=""><br>
最后，在页面查询，结果如下：<br>
如果上面的枚举类没有用@JsonValue  修饰的话，那么前端查询的时候返回的是枚举类型的字符串，也就是返回的是NORMAL或者其他的！如果添加了该注解修饰返回给前端的值就是枚举属性中的desc部分！<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978322928-bfcd70d6-c8cb-4006-83fa-96ec1a7bfe84.png#averageHue=%23b1b0aa&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=ub21689de&amp;originHeight=764&amp;originWidth=1752&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ud60dc59f-3df9-4430-85a3-cb56404fa2f&amp;title=" alt=""></p>
<h2 id="3-4-JSON类型处理器"><strong>3.4.JSON类型处理器</strong></h2>
<p>数据库的user表中有一个info字段，是JSON类型：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978323486-e2b7191e-8602-4502-abc1-093453bbb30f.png#averageHue=%23f7f6f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u634e6503&amp;originHeight=304&amp;originWidth=761&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u3f92d5cc-eb85-4d7e-8c03-c0ea7202ed1&amp;title=" alt=""><br>
格式像这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;age&quot;: 20, &quot;intro&quot;: &quot;佛系青年&quot;, &quot;gender&quot;: &quot;male&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>而目前User实体类中却是String类型：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978323508-679d8806-0c1f-458b-b9b8-1738c6d07b55.png#averageHue=%23f5f8f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=uee0b7401&amp;originHeight=384&amp;originWidth=814&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u0ca78c3a-2df7-45c6-8dbc-4c28f87d205&amp;title=" alt=""><br>
这样一来，我们要读取info中的属性时就非常不方便。如果要方便获取，info的类型最好是一个Map或者实体类。<br>
而一旦我们把info改为对象类型，就需要在写入数据库时手动转为String，再读取数据库时，手动转换为对象，这会非常麻烦。<br>
因此MybatisPlus提供了很多特殊类型字段的类型处理器，解决特殊字段类型与数据库类型转换的问题。例如处理JSON就可以使用JacksonTypeHandler处理器。<br>
接下来，我们就来看看这个处理器该如何使用。</p>
<h3 id="3-4-1-定义实体"><strong>3.4.1.定义实体</strong></h3>
<p>首先，我们定义一个单独实体类来与info字段的属性匹配：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978323584-9c4d490e-b0af-4e55-a95a-5c471ce3804e.png#averageHue=%23f9fbf8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u98815d56&amp;originHeight=437&amp;originWidth=860&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u7eb18b57-145c-478a-b26c-150b875da44&amp;title=" alt=""><br>
代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.po;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class UserInfo &#123;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private String intro;</span><br><span class="line">    private String gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-使用类型处理器"><strong>3.4.2.使用类型处理器</strong></h3>
<p>接下来，将User类的info字段修改为UserInfo类型，并声明类型处理器：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978323692-de784ab0-b4d2-422d-b25c-ba041423cb52.png#averageHue=%23f6f8f4&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=uc328c190&amp;originHeight=383&amp;originWidth=978&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u0dbfe6ed-814e-4893-843e-efc5903b0e0&amp;title=" alt=""><br>
测试可以发现，所有数据都正确封装到UserInfo当中了：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978324097-a9bb9dfe-60b6-4a97-92d5-aae0c01e1c9a.png#averageHue=%23f9fbf6&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=ue9d7303b&amp;originHeight=345&amp;originWidth=1034&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u94a9f33f-ce94-45f6-9d93-58f8cfa15b2&amp;title=" alt=""><br>
同时，为了让页面返回的结果也以对象格式返回，我们要修改UserVO中的info字段：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978324170-549eb331-de5d-4f45-bb15-cef0f3591856.png#averageHue=%23f5f7f0&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=uc69a9dc2&amp;originHeight=383&amp;originWidth=945&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=uf5214c5c-5d51-4903-b322-46aa93c75d4&amp;title=" alt=""><br>
此时，在页面查询结果如下：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978324181-87b36754-e3eb-41a0-a756-52a23712e354.png#averageHue=%23b9b9b1&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=uccac1623&amp;originHeight=755&amp;originWidth=1722&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u19c62568-d3b6-4f9d-a17d-d3ce4f6642b&amp;title=" alt=""></p>
<h2 id="3-5-配置加密（选学）"><s><strong>3.5.配置加密（选学）</strong></s></h2>
<p>目前我们配置文件中的很多参数都是明文，如果开发人员发生流动，很容易导致敏感信息的泄露。所以MybatisPlus支持配置文件的加密和解密功能。<br>
我们以数据库的用户名和密码为例。</p>
<h3 id="3-5-1-生成秘钥"><strong>3.5.1.生成秘钥</strong></h3>
<p>首先，我们利用AES工具生成一个随机秘钥，然后对用户名、密码加密：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.toolkit.AES;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line">class MpDemoApplicationTests &#123;</span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        // 生成 16 位随机 AES 密钥</span><br><span class="line">        String randomKey = AES.generateRandomKey();</span><br><span class="line">        System.out.println(&quot;randomKey = &quot; + randomKey);</span><br><span class="line"></span><br><span class="line">        // 利用密钥对用户名加密</span><br><span class="line">        String username = AES.encrypt(&quot;root&quot;, randomKey);</span><br><span class="line">        System.out.println(&quot;username = &quot; + username);</span><br><span class="line"></span><br><span class="line">        // 利用密钥对用户名加密</span><br><span class="line">        String password = AES.encrypt(&quot;MySQL123&quot;, randomKey);</span><br><span class="line">        System.out.println(&quot;password = &quot; + password);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">randomKey = 6234633a66fb399f</span><br><span class="line">username = px2bAbnUfiY8K/IgsKvscg==</span><br><span class="line">password = FGvCSEaOuga3ulDAsxw68Q==</span><br></pre></td></tr></table></figure>
<h3 id="3-5-2-修改配置"><strong>3.5.2.修改配置</strong></h3>
<p>修改application.yaml文件，把jdbc的用户名、密码修改为刚刚加密生成的密文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    username: mpw:QWWVnk1Oal3258x5rVhaeQ== # 密文要以 mpw:开头</span><br><span class="line">    password: mpw:EUFmeH3cNAzdRGdOQcabWg== # 密文要以 mpw:开头</span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-测试"><strong>3.5.3.测试</strong></h3>
<p>在启动项目的时候，需要把刚才生成的秘钥添加到启动参数中，像这样：<br>
–mpw.key=6234633a66fb399f<br>
单元测试的时候不能添加启动参数，所以要在测试类的注解上配置：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705978324367-3cf813ab-499d-4dd1-9c88-bcd8cfbff7d7.png#averageHue=%23f5f7f3&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u801e8006&amp;originHeight=486&amp;originWidth=1089&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ub52ae623-c40f-4e91-a659-422267810fb&amp;title=" alt=""><br>
然后随意运行一个单元测试，可以发现数据库查询正常。<br>
注意：如果是springboot项目启动的时候，我们需要在程序启动的时候添加程序实参：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705980172566-7324763d-c5bc-4a83-a25d-d01a67bc22f9.png#averageHue=%232f3136&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;height=486&amp;id=uc3036a07&amp;originHeight=608&amp;originWidth=940&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=47414&amp;status=done&amp;style=none&amp;taskId=u76007036-4392-4644-b0cc-ec8d7d6b2c7&amp;title=&amp;width=752" alt="image.png"></p>
<h1><strong>4.插件功能</strong></h1>
<p>MybatisPlus提供了很多的插件功能，进一步拓展其功能。目前已有的插件有：</p>
<ul>
<li>PaginationInnerInterceptor：自动分页</li>
<li>TenantLineInnerInterceptor：多租户</li>
<li>DynamicTableNameInnerInterceptor：动态表名</li>
<li>OptimisticLockerInnerInterceptor：乐观锁</li>
<li>IllegalSQLInnerInterceptor：sql 性能规范</li>
<li>BlockAttackInnerInterceptor：防止全表更新与删除</li>
</ul>
<p><strong>注意：</strong> 使用多个分页插件的时候需要注意插件定义顺序，建议使用顺序如下：</p>
<ul>
<li>多租户,动态表名</li>
<li>分页,乐观锁</li>
<li>sql 性能规范,防止全表更新与删除</li>
</ul>
<p>这里我们以分页插件为里来学习插件的用法。</p>
<h2 id="4-1-分页插件"><strong>4.1.分页插件</strong></h2>
<p>在未引入分页插件的情况下，MybatisPlus是不支持分页功能的，IService和BaseMapper中的分页方法都无法正常起效。 所以，我们必须配置分页插件。</p>
<h3 id="4-1-1-配置分页插件"><strong>4.1.1.配置分页插件</strong></h3>
<p>在项目中新建一个配置类：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705980258700-4c8de4e9-4dc7-455b-b608-e924034c14ac.png#averageHue=%23f9fbf8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=PaeBj&amp;originHeight=405&amp;originWidth=896&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u367f4c69-5009-432f-9107-ad4c148b8e4&amp;title=" alt=""><br>
其代码如下：<br>
注意不要忘记了下面的@Configuration注解：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.config;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class MybatisConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public MybatisPlusInterceptor mybatisPlusInterceptor() &#123;</span><br><span class="line">        // 初始化核心插件</span><br><span class="line">        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();</span><br><span class="line">        // 添加分页插件</span><br><span class="line">        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        return interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-1-2-分页API"><strong>4.1.2.分页API</strong></h3>
<p>编写一个分页查询的测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testPageQuery() &#123;</span><br><span class="line">    // 1.分页查询，new Page()的两个参数分别是：页码、每页大小</span><br><span class="line">    Page&lt;User&gt; p = userService.page(new Page&lt;&gt;(3, 2));</span><br><span class="line">    // 2.总条数</span><br><span class="line">    System.out.println(&quot;total = &quot; + p.getTotal());</span><br><span class="line">    // 3.总页数</span><br><span class="line">    System.out.println(&quot;pages = &quot; + p.getPages());</span><br><span class="line">    // 4.数据</span><br><span class="line">    List&lt;User&gt; records = p.getRecords();</span><br><span class="line">    records.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行的SQL如下：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705982335825-7802f5fa-5a4e-4d72-88d1-5e1e6dea399f.png#averageHue=%2326282c&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;height=478&amp;id=uc760cf8c&amp;originHeight=598&amp;originWidth=1338&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=425307&amp;status=done&amp;style=none&amp;taskId=u506701e7-7820-4a5e-bc4a-0c08fa0289f&amp;title=&amp;width=1070.4" alt="image.png"><br>
这里用到了分页参数，Page，即可以支持分页参数，也可以支持排序参数。常见的API如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    void testPageQueryOrder() &#123;</span><br><span class="line">        int pageNo = 3, pageSize = 2;</span><br><span class="line">// 分页参数</span><br><span class="line">        Page&lt;User&gt; page = Page.of(pageNo, pageSize);</span><br><span class="line">// 排序参数, 通过OrderItem来指定</span><br><span class="line">        page.addOrder(OrderItem.asc(&quot;balance&quot;));</span><br><span class="line"></span><br><span class="line">        Page&lt;User&gt; p=userService.page(page);</span><br><span class="line">        List&lt;User&gt; records = p.getRecords();</span><br><span class="line">        records.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-2-通用分页实体"><strong>4.2.通用分页实体</strong></h2>
<p>现在要实现一个用户分页查询的接口，接口规范如下：</p>
<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>请求方式</td>
<td>GET</td>
</tr>
<tr>
<td>请求路径</td>
<td>/users/page</td>
</tr>
<tr>
<td>请求参数</td>
<td>```</td>
</tr>
<tr>
<td>{</td>
<td></td>
</tr>
</tbody>
</table>
<pre><code>&quot;pageNo&quot;: 1,
&quot;pageSize&quot;: 5,
&quot;sortBy&quot;: &quot;balance&quot;,
&quot;isAsc&quot;: false,
&quot;name&quot;: &quot;o&quot;,
&quot;status&quot;: 1
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> |</span><br><span class="line">| 返回值 | ```</span><br><span class="line">&#123;</span><br><span class="line">    &quot;total&quot;: 100006,</span><br><span class="line">    &quot;pages&quot;: 50003,</span><br><span class="line">    &quot;list&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 1685100878975279298,</span><br><span class="line">            &quot;username&quot;: &quot;user_9****&quot;,</span><br><span class="line">            &quot;info&quot;: &#123;</span><br><span class="line">                &quot;age&quot;: 24,</span><br><span class="line">                &quot;intro&quot;: &quot;英文老师&quot;,</span><br><span class="line">                &quot;gender&quot;: &quot;female&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;status&quot;: &quot;正常&quot;,</span><br><span class="line">            &quot;balance&quot;: 2000</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>|<br>
| 特殊说明 |</p>
<ul>
<li>如果排序字段为空，默认按照更新时间排序</li>
<li>排序字段不为空，则按照排序字段排序<br>
|</li>
</ul>
<p>这里需要定义3个实体：</p>
<ul>
<li>UserQuery：分页查询条件的实体，包含分页、排序参数、过滤条件</li>
<li>PageDTO：分页结果实体，包含总条数、总页数、当前页数据</li>
<li>UserVO：用户页面视图实体</li>
</ul>
<h3 id="4-2-1-实体"><strong>4.2.1.实体</strong></h3>
<p>由于UserQuery之前已经定义过了，并且其中已经包含了过滤条件，具体代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.query;</span><br><span class="line"></span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;用户查询条件实体&quot;)</span><br><span class="line">public class UserQuery &#123;</span><br><span class="line">    @ApiModelProperty(&quot;用户名关键字&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    @ApiModelProperty(&quot;用户状态：1-正常，2-冻结&quot;)</span><br><span class="line">    private Integer status;</span><br><span class="line">    @ApiModelProperty(&quot;余额最小值&quot;)</span><br><span class="line">    private Integer minBalance;</span><br><span class="line">    @ApiModelProperty(&quot;余额最大值&quot;)</span><br><span class="line">    private Integer maxBalance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中缺少的仅仅是分页条件，而分页条件不仅仅用户分页查询需要，以后其它业务也都有分页查询的需求。因此建议将分页查询条件单独定义为一个PageQuery实体：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705982946365-213d9c2d-1007-4676-a0f3-006903863076.png#averageHue=%23f9fbf8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=ubdfd514f&amp;originHeight=530&amp;originWidth=842&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u97557790-4a94-4a71-80e3-e0413c41d19&amp;title=" alt=""><br>
PageQuery是前端提交的查询参数，一般包含四个属性：</p>
<ul>
<li>pageNo：页码</li>
<li>pageSize：每页数据条数</li>
<li>sortBy：排序字段</li>
<li>isAsc：是否升序</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;分页查询实体&quot;)</span><br><span class="line">public class PageQuery &#123;</span><br><span class="line">    @ApiModelProperty(&quot;页码&quot;)</span><br><span class="line">    private Long pageNo;</span><br><span class="line">    @ApiModelProperty(&quot;页码&quot;)</span><br><span class="line">    private Long pageSize;</span><br><span class="line">    @ApiModelProperty(&quot;排序字段&quot;)</span><br><span class="line">    private String sortBy;</span><br><span class="line">    @ApiModelProperty(&quot;是否升序&quot;)</span><br><span class="line">    private Boolean isAsc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，让我们的UserQuery继承这个实体：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.query;</span><br><span class="line"></span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line">@EqualsAndHashCode(callSuper = true)</span><br><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;用户查询条件实体&quot;)</span><br><span class="line">public class UserQuery extends PageQuery &#123;</span><br><span class="line">    @ApiModelProperty(&quot;用户名关键字&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    @ApiModelProperty(&quot;用户状态：1-正常，2-冻结&quot;)</span><br><span class="line">    private Integer status;</span><br><span class="line">    @ApiModelProperty(&quot;余额最小值&quot;)</span><br><span class="line">    private Integer minBalance;</span><br><span class="line">    @ApiModelProperty(&quot;余额最大值&quot;)</span><br><span class="line">    private Integer maxBalance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回值的用户实体沿用之前定一个UserVO实体：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705982946305-c7813c4d-6144-4982-8eb9-7807479b450a.png#averageHue=%23f9fbf8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=ubef00504&amp;originHeight=440&amp;originWidth=834&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ud2c5b538-2586-42eb-84af-ab2a2ddfbc8&amp;title=" alt=""><br>
最后，则是分页实体PageDTO:<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705982946275-20df474d-bf03-421c-b42e-bfff8fa44fe3.png#averageHue=%23f9fbf8&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u4bb1d438&amp;originHeight=499&amp;originWidth=900&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ub99d7679-e884-4ccd-a3f2-a09fc3b6ae7&amp;title=" alt=""><br>
代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.dto;</span><br><span class="line"></span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;分页结果&quot;)</span><br><span class="line">public class PageDTO&lt;T&gt; &#123;</span><br><span class="line">    @ApiModelProperty(&quot;总条数&quot;)</span><br><span class="line">    private Long total;</span><br><span class="line">    @ApiModelProperty(&quot;总页数&quot;)</span><br><span class="line">    private Long pages;</span><br><span class="line">    @ApiModelProperty(&quot;集合&quot;)</span><br><span class="line">    private List&lt;T&gt; list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-开发接口"><strong>4.2.2.开发接口</strong></h3>
<p>我们在UserController中定义分页查询用户的接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.controller;</span><br><span class="line"></span><br><span class="line">import com.itheima.mp.domain.dto.PageDTO;</span><br><span class="line">import com.itheima.mp.domain.query.PageQuery;</span><br><span class="line">import com.itheima.mp.domain.vo.UserVO;</span><br><span class="line">import com.itheima.mp.service.UserService;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;users&quot;)</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    private final UserService userService;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/page&quot;)</span><br><span class="line">    public PageDTO&lt;UserVO&gt; queryUsersPage(UserQuery query)&#123;</span><br><span class="line">        return userService.queryUsersPage(query);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 。。。 略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在IUserService中创建queryUsersPage方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PageDTO&lt;UserVO&gt; queryUsersPage(PageQuery query);</span><br></pre></td></tr></table></figure>
<p>接下来，在UserServiceImpl中实现该方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public PageDTO&lt;UserVO&gt; queryUsersPage(PageQuery query) &#123;</span><br><span class="line">    // 1.构建条件</span><br><span class="line">    // 1.1.分页条件</span><br><span class="line">    Page&lt;User&gt; page = Page.of(query.getPageNo(), query.getPageSize());</span><br><span class="line">    // 1.2.排序条件</span><br><span class="line">    if (query.getSortBy() != null) &#123;</span><br><span class="line">        page.addOrder(new OrderItem(query.getSortBy(), query.getIsAsc()));</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        // 默认按照更新时间排序</span><br><span class="line">        page.addOrder(new OrderItem(&quot;update_time&quot;, false));</span><br><span class="line">    &#125;</span><br><span class="line">    // 2.查询</span><br><span class="line">    page(page);</span><br><span class="line">    // 3.数据非空校验</span><br><span class="line">    List&lt;User&gt; records = page.getRecords();</span><br><span class="line">    if (records == null || records.size() &lt;= 0) &#123;</span><br><span class="line">        // 无数据，返回空结果</span><br><span class="line">        return new PageDTO&lt;&gt;(page.getTotal(), page.getPages(), Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    // 4.有数据，转换</span><br><span class="line">    List&lt;UserVO&gt; list = BeanUtil.copyToList(records, UserVO.class);</span><br><span class="line">    // 5.封装返回</span><br><span class="line">    return new PageDTO&lt;UserVO&gt;(page.getTotal(), page.getPages(), list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动项目，在页面查看：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705982946491-8d9ec7ae-8722-4dfa-84b5-ec4396913351.png#averageHue=%23f8f8fe&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u72a864c9&amp;originHeight=748&amp;originWidth=749&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u955da69a-cdfd-4edd-9af0-c589a53b0d4&amp;title=" alt=""></p>
<h3 id="4-2-3-改造PageQuery实体"><strong>4.2.3.改造PageQuery实体</strong></h3>
<p>在刚才的代码中，从PageQuery到MybatisPlus的Page之间转换的过程还是比较麻烦的。<br>
我们完全可以在PageQuery这个实体中定义一个工具方法，简化开发。 像这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.query;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.metadata.OrderItem;</span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class PageQuery &#123;</span><br><span class="line">    private Integer pageNo;</span><br><span class="line">    private Integer pageSize;</span><br><span class="line">    private String sortBy;</span><br><span class="line">    private Boolean isAsc;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt;  Page&lt;T&gt; toMpPage(OrderItem ... orders)&#123;</span><br><span class="line">        // 1.分页条件</span><br><span class="line">        Page&lt;T&gt; p = Page.of(pageNo, pageSize);</span><br><span class="line">        // 2.排序条件</span><br><span class="line">        // 2.1.先看前端有没有传排序字段</span><br><span class="line">        if (sortBy != null) &#123;</span><br><span class="line">            p.addOrder(new OrderItem(sortBy, isAsc));</span><br><span class="line">            return p;</span><br><span class="line">        &#125;</span><br><span class="line">        // 2.2.再看有没有手动指定排序字段</span><br><span class="line">        if(orders != null)&#123;</span><br><span class="line">            p.addOrder(orders);</span><br><span class="line">        &#125;</span><br><span class="line">        return p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Page&lt;T&gt; toMpPage(String defaultSortBy, boolean isAsc)&#123;</span><br><span class="line">        return this.toMpPage(new OrderItem(defaultSortBy, isAsc));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Page&lt;T&gt; toMpPageDefaultSortByCreateTimeDesc() &#123;</span><br><span class="line">        return toMpPage(&quot;create_time&quot;, false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Page&lt;T&gt; toMpPageDefaultSortByUpdateTimeDesc() &#123;</span><br><span class="line">        return toMpPage(&quot;update_time&quot;, false);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们在开发也时就可以省去对从PageQuery到Page的的转换：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 1.构建条件</span><br><span class="line">Page&lt;User&gt; page = query.toMpPageDefaultSortByCreateTimeDesc();</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-改造PageDTO实体"><strong>4.2.4.改造PageDTO实体</strong></h3>
<p>在查询出分页结果后，数据的非空校验，数据的vo转换都是模板代码，编写起来很麻烦。<br>
我们完全可以将其封装到PageDTO的工具方法中，简化整个过程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mp.domain.dto;</span><br><span class="line"></span><br><span class="line">import cn.hutool.core.bean.BeanUtil;</span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.function.Function;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class PageDTO&lt;V&gt; &#123;</span><br><span class="line">    private Long total;</span><br><span class="line">    private Long pages;</span><br><span class="line">    private List&lt;V&gt; list;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回空分页结果</span><br><span class="line">     * @param p MybatisPlus的分页结果</span><br><span class="line">     * @param &lt;V&gt; 目标VO类型</span><br><span class="line">     * @param &lt;P&gt; 原始PO类型</span><br><span class="line">     * @return VO的分页对象</span><br><span class="line">     */</span><br><span class="line">    public static &lt;V, P&gt; PageDTO&lt;V&gt; empty(Page&lt;P&gt; p)&#123;</span><br><span class="line">        return new PageDTO&lt;&gt;(p.getTotal(), p.getPages(), Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将MybatisPlus分页结果转为 VO分页结果</span><br><span class="line">     * @param p MybatisPlus的分页结果</span><br><span class="line">     * @param voClass 目标VO类型的字节码</span><br><span class="line">     * @param &lt;V&gt; 目标VO类型</span><br><span class="line">     * @param &lt;P&gt; 原始PO类型</span><br><span class="line">     * @return VO的分页对象</span><br><span class="line">     */</span><br><span class="line">    public static &lt;V, P&gt; PageDTO&lt;V&gt; of(Page&lt;P&gt; p, Class&lt;V&gt; voClass) &#123;</span><br><span class="line">        // 1.非空校验</span><br><span class="line">        List&lt;P&gt; records = p.getRecords();</span><br><span class="line">        if (records == null || records.size() &lt;= 0) &#123;</span><br><span class="line">            // 无数据，返回空结果</span><br><span class="line">            return empty(p);</span><br><span class="line">        &#125;</span><br><span class="line">        // 2.数据转换</span><br><span class="line">        List&lt;V&gt; vos = BeanUtil.copyToList(records, voClass);</span><br><span class="line">        // 3.封装返回</span><br><span class="line">        return new PageDTO&lt;&gt;(p.getTotal(), p.getPages(), vos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将MybatisPlus分页结果转为 VO分页结果，允许用户自定义PO到VO的转换方式</span><br><span class="line">     * @param p MybatisPlus的分页结果</span><br><span class="line">     * @param convertor PO到VO的转换函数</span><br><span class="line">     * @param &lt;V&gt; 目标VO类型</span><br><span class="line">     * @param &lt;P&gt; 原始PO类型</span><br><span class="line">     * @return VO的分页对象</span><br><span class="line">     */</span><br><span class="line">    public static &lt;V, P&gt; PageDTO&lt;V&gt; of(Page&lt;P&gt; p, Function&lt;P, V&gt; convertor) &#123;</span><br><span class="line">        // 1.非空校验</span><br><span class="line">        List&lt;P&gt; records = p.getRecords();</span><br><span class="line">        if (records == null || records.size() &lt;= 0) &#123;</span><br><span class="line">            // 无数据，返回空结果</span><br><span class="line">            return empty(p);</span><br><span class="line">        &#125;</span><br><span class="line">        // 2.数据转换</span><br><span class="line">        List&lt;V&gt; vos = records.stream().map(convertor).collect(Collectors.toList());</span><br><span class="line">        // 3.封装返回</span><br><span class="line">        return new PageDTO&lt;&gt;(p.getTotal(), p.getPages(), vos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终，业务层的代码可以简化为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public PageDTO&lt;UserVO&gt; queryUserByPage(PageQuery query) &#123;</span><br><span class="line">    // 1.构建条件</span><br><span class="line">    Page&lt;User&gt; page = query.toMpPageDefaultSortByCreateTimeDesc();</span><br><span class="line">    // 2.查询</span><br><span class="line">    page(page);</span><br><span class="line">    // 3.封装返回</span><br><span class="line">    return PageDTO.of(page, UserVO.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果是希望自定义PO到VO的转换过程，可以这样做：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public PageDTO&lt;UserVO&gt; queryUserByPage(PageQuery query) &#123;</span><br><span class="line">    // 1.构建条件</span><br><span class="line">    Page&lt;User&gt; page = query.toMpPageDefaultSortByCreateTimeDesc();</span><br><span class="line">    // 2.查询</span><br><span class="line">    page(page);</span><br><span class="line">    // 3.封装返回</span><br><span class="line">    return PageDTO.of(page, user -&gt; &#123;</span><br><span class="line">        // 拷贝属性到VO</span><br><span class="line">        UserVO vo = BeanUtil.copyProperties(user, UserVO.class);</span><br><span class="line">        // 用户名脱敏</span><br><span class="line">        String username = vo.getUsername();</span><br><span class="line">        vo.setUsername(username.substring(0, username.length() - 2) + &quot;**&quot;);</span><br><span class="line">        return vo;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终查询的结果如下：<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/28066124/1705982946301-b3ee830d-8b1f-4789-8e85-be8fef78530b.png#averageHue=%23f8f9fe&amp;clientId=uc58b97f9-a395-4&amp;from=paste&amp;id=u0b1f8043&amp;originHeight=761&amp;originWidth=891&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u3925a6d3-72fc-4a78-a25a-f6ea9571e4a&amp;title=" alt=""></p>
<h1></h1>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://www.bojiboqi.fun">山麋一笑</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://www.bojiboqi.fun/2024/02/28/mybatis-plus/">http://www.bojiboqi.fun/2024/02/28/mybatis-plus/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.bojiboqi.fun" target="_blank">山麋一笑</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mybatis/">mybatis</a><a class="post-meta__tags" href="/tags/spring/">spring</a></div><div class="post_share"><div class="social-share" data-image="https://www.dmoe.cc/random.php?5386" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/02/28/mybatisPlus%E5%A4%9A%E7%A7%9F%E6%88%B7%EF%BC%9A/" title="mybatisPlus多租户："><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.dmoe.cc/random.php?5620" onerror="onerror=null;src='/img/404.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">mybatisPlus多租户：</div></div></a></div><div class="next-post pull-right"><a href="/2024/02/28/Linux%E5%AD%A6%E4%B9%A0%E6%89%8E%E8%AE%B0%EF%BC%9A/" title="Linux学习扎记："><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.dmoe.cc/random.php?4324" onerror="onerror=null;src='/img/404.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux学习扎记：</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/02/28/mybits/" title="mybatis总结"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.dmoe.cc/random.php?8469" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-28</div><div class="title">mybatis总结</div></div></a></div><div><a href="/2024/02/28/mybatisPlus%E5%A4%9A%E7%A7%9F%E6%88%B7%EF%BC%9A/" title="mybatisPlus多租户："><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.dmoe.cc/random.php?5620" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-28</div><div class="title">mybatisPlus多租户：</div></div></a></div><div><a href="/2024/02/28/springboot2%E6%9D%82%E9%A1%B9%EF%BC%9A/" title="spring杂项"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.dmoe.cc/random.php?1467" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-28</div><div class="title">spring杂项</div></div></a></div><div><a href="/2024/02/28/springboot3%E7%BB%93%E5%90%88swagger3%E5%B9%B6%E5%AF%BC%E5%85%A5%E5%88%B0APIfox_/" title="spirngboot3整合swagger3"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.dmoe.cc/random.php?3644" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-28</div><div class="title">spirngboot3整合swagger3</div></div></a></div><div><a href="/2024/02/28/spring%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9A/" title="spring常见注解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.dmoe.cc/random.php?3176" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-28</div><div class="title">spring常见注解</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">前言：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">知识点：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis-Plus%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">MyBatis Plus的特性:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">4.</span> <span class="toc-text">快速入门:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96%EF%BC%9A"><span class="toc-number">4.0.1.</span> <span class="toc-text">引入依赖：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-number">4.0.2.</span> <span class="toc-text">注意：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%B3%A8%E8%A7%A3%EF%BC%9A"><span class="toc-number">4.0.3.</span> <span class="toc-text">常见注解：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#TableName%EF%BC%9A"><span class="toc-number">4.0.3.1.</span> <span class="toc-text">@TableName：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#TableId%EF%BC%9A"><span class="toc-number">4.0.3.2.</span> <span class="toc-text">@TableId：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#TableField%EF%BC%9A"><span class="toc-number">4.0.3.3.</span> <span class="toc-text">@TableField：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">4.0.4.</span> <span class="toc-text">常见配置：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">核心功能：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QueryWrapper%EF%BC%9A"><span class="toc-number">5.0.1.</span> <span class="toc-text">QueryWrapper：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UpdateWrapper%EF%BC%9A"><span class="toc-number">5.0.2.</span> <span class="toc-text">UpdateWrapper：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LambdaQueryWrapper%EF%BC%9A"><span class="toc-number">5.0.3.</span> <span class="toc-text">LambdaQueryWrapper：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89SQL%EF%BC%9A"><span class="toc-number">6.</span> <span class="toc-text">自定义SQL：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95%EF%BC%9A"><span class="toc-number">6.0.1.</span> <span class="toc-text">基本用法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%EF%BC%9A"><span class="toc-number">6.0.2.</span> <span class="toc-text">多表关联：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service%E6%8E%A5%E5%8F%A3%EF%BC%9A"><span class="toc-number">7.</span> <span class="toc-text">Service接口：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CRUD%EF%BC%9A"><span class="toc-number">7.0.1.</span> <span class="toc-text">CRUD：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">7.1.</span> <span class="toc-text">基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">7.2.</span> <span class="toc-text">项目结构如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-Lambda"><span class="toc-number">7.3.</span> <span class="toc-text">2.3.3.Lambda</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E6%89%B9%E9%87%8F%E6%96%B0%E5%A2%9E"><span class="toc-number">7.4.</span> <span class="toc-text">2.3.4.批量新增</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%EF%BC%9A"><span class="toc-number">8.</span> <span class="toc-text">3.扩展功能：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-number">9.</span> <span class="toc-text">3.1.代码生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="toc-number">9.1.</span> <span class="toc-text">3.1.1.安装插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E4%BD%BF%E7%94%A8"><span class="toc-number">9.2.</span> <span class="toc-text">3.1.2.使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E9%9D%99%E6%80%81%E5%B7%A5%E5%85%B7"><span class="toc-number">10.</span> <span class="toc-text">3.2.静态工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4"><span class="toc-number">11.</span> <span class="toc-text">3.3.逻辑删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E9%80%9A%E7%94%A8%E6%9E%9A%E4%B8%BE"><span class="toc-number">12.</span> <span class="toc-text">3.3.通用枚举</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E5%AE%9A%E4%B9%89%E6%9E%9A%E4%B8%BE"><span class="toc-number">12.1.</span> <span class="toc-text">3.3.1.定义枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E9%85%8D%E7%BD%AE%E6%9E%9A%E4%B8%BE%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">12.2.</span> <span class="toc-text">3.3.2.配置枚举处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-number">12.3.</span> <span class="toc-text">3.3.3.测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-JSON%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">13.</span> <span class="toc-text">3.4.JSON类型处理器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E5%AE%9A%E4%B9%89%E5%AE%9E%E4%BD%93"><span class="toc-number">13.1.</span> <span class="toc-text">3.4.1.定义实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E4%BD%BF%E7%94%A8%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">13.2.</span> <span class="toc-text">3.4.2.使用类型处理器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E9%85%8D%E7%BD%AE%E5%8A%A0%E5%AF%86%EF%BC%88%E9%80%89%E5%AD%A6%EF%BC%89"><span class="toc-number">14.</span> <span class="toc-text">3.5.配置加密（选学）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%E7%94%9F%E6%88%90%E7%A7%98%E9%92%A5"><span class="toc-number">14.1.</span> <span class="toc-text">3.5.1.生成秘钥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">14.2.</span> <span class="toc-text">3.5.2.修改配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-3-%E6%B5%8B%E8%AF%95"><span class="toc-number">14.3.</span> <span class="toc-text">3.5.3.测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number"></span> <span class="toc-text">4.插件功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">4.1.分页插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">4.1.1.配置分页插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E5%88%86%E9%A1%B5API"><span class="toc-number">1.2.</span> <span class="toc-text">4.1.2.分页API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E9%80%9A%E7%94%A8%E5%88%86%E9%A1%B5%E5%AE%9E%E4%BD%93"><span class="toc-number">2.</span> <span class="toc-text">4.2.通用分页实体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E5%AE%9E%E4%BD%93"><span class="toc-number">2.1.</span> <span class="toc-text">4.2.1.实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E5%BC%80%E5%8F%91%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.2.</span> <span class="toc-text">4.2.2.开发接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E6%94%B9%E9%80%A0PageQuery%E5%AE%9E%E4%BD%93"><span class="toc-number">2.3.</span> <span class="toc-text">4.2.3.改造PageQuery实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-%E6%94%B9%E9%80%A0PageDTO%E5%AE%9E%E4%BD%93"><span class="toc-number">2.4.</span> <span class="toc-text">4.2.4.改造PageDTO实体</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number"></span> <span class="toc-text"></span></a></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 山麋一笑</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><div id="runtime"></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-teal-alpha.vercel.app/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.29/dist/twikoo.all.min.js').then(init)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-teal-alpha.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
      
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script  src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><div class="aplayer no-destroy" data-id="2914905159" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="auto" data-autoplay="true" muted></div><script  async data-pjax="" defer="" src="/js/fish.js"></script><script async src="/js/universe.js"></script><canvas id="universe"></canvas><script async src="/js/diytitle.js"></script><script async src="/js/runtime.js"></script><script>let tianliGPT_postSelector = '\#post \#article-container';let tianliGPT_key = '92ec679de1bc42262c48';</script><script   defer src="https://cdn1.tianli0.top/gh/zhheo/Post-Abstract-AI@0.15.2/tianli_gpt.js"></script><script async src="/js/leaf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>